\section{postpro Module Reference}
\label{namespacepostpro}\index{postpro@{postpro}}


solver for the advection dispersion equation  


\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine, public {\bf make\+\_\+print} (behaviour, curtime, name)
\item 
subroutine, public {\bf write\+\_\+obs} ()
\item 
subroutine, public {\bf get\+\_\+ram\+\_\+use} ()
\begin{DoxyCompactList}\small\item\em this subroutine parses /proc/[P\+ID]/status file in order to get R\+AM consumption statistics, it works only under P\+O\+S\+IX systems \end{DoxyCompactList}\item 
subroutine, private {\bf print\+\_\+scilab} (ids, proc, quadpnt)
\item 
subroutine, private {\bf print\+\_\+pure} (ids, proc, quadpnt)
\item 
subroutine, private {\bf print\+\_\+gmsh} (ids, proc, quadpnt)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
solver for the advection dispersion equation 

\subsection{Function/\+Subroutine Documentation}
\index{postpro@{postpro}!get\+\_\+ram\+\_\+use@{get\+\_\+ram\+\_\+use}}
\index{get\+\_\+ram\+\_\+use@{get\+\_\+ram\+\_\+use}!postpro@{postpro}}
\subsubsection[{get\+\_\+ram\+\_\+use()}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public postpro\+::get\+\_\+ram\+\_\+use (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{namespacepostpro_ad7dbd8a9caed2ac75b253d6b46d098d2}


this subroutine parses /proc/[P\+ID]/status file in order to get R\+AM consumption statistics, it works only under P\+O\+S\+IX systems 



Definition at line 285 of file postpro.\+f90.



References core\+\_\+tools\+::find\+\_\+unit(), globals\+::terminal, and core\+\_\+tools\+::write\+\_\+log().



Referenced by main().


\begin{DoxyCode}
285     \textcolor{keywordtype}{use }typy
286     \textcolor{keywordtype}{use }globals
287     \textcolor{keywordtype}{use }core_tools
288     \textcolor{keywordtype}{integer} :: pid, fileid, i, ierr
289     \textcolor{keywordtype}{integer(kind=ikind)} :: bytes
290     \textcolor{keywordtype}{character(len=2)} :: byte\_unit
291     \textcolor{keywordtype}{character(len=7)} :: ch
292     \textcolor{keywordtype}{character(len=256)} :: filename, format
293 
294     pid = getpid()
295 
296     \textcolor{keyword}{call }find_unit(fileid)
297 
298 
299     i = 0
300     \textcolor{keywordflow}{do}
301       i = i + 1
302       \textcolor{keywordflow}{if} ((1.0*pid)/(10**i) < 1) \textcolor{keywordflow}{then}
303         \textcolor{keywordflow}{EXIT}
304 \textcolor{keywordflow}{      end if}
305 \textcolor{keywordflow}{    end do}
306 
307     \textcolor{keyword}{write}(unit=\textcolor{keyword}{format}, fmt=\textcolor{stringliteral}{"(a, I7, a)"}) \textcolor{stringliteral}{"(a, I"}, i, \textcolor{stringliteral}{", a)"}
308 
309 \textcolor{comment}{!     write(unit=format, fmt = *) "(I.", i, ")"}
310 
311     \textcolor{keyword}{write}(unit=filename, fmt=format) \textcolor{stringliteral}{"/proc/"}, pid, \textcolor{stringliteral}{"/status"}
312     
313     \textcolor{keyword}{open}(unit=fileid, file=filename, action=\textcolor{stringliteral}{"read"}, status=\textcolor{stringliteral}{"old"}, iostat=ierr)
314 
315     \textcolor{keywordflow}{if} (ierr /= 0) \textcolor{keywordflow}{then}
316       \textcolor{keyword}{write}(unit=terminal) \textcolor{stringliteral}{"WARNING! this is not POSIX system, unable to get RAM consumption"}
317       \textcolor{keywordflow}{RETURN}
318 \textcolor{keywordflow}{    end if}
319 
320     \textcolor{keywordflow}{do} 
321       \textcolor{keyword}{read}(unit=fileid, fmt=*, iostat=ierr) ch
322       \textcolor{keywordflow}{if} (ch == \textcolor{stringliteral}{"VmPeak:"}) \textcolor{keywordflow}{then}
323         backspace fileid
324         \textcolor{keywordflow}{EXIT}
325 \textcolor{keywordflow}{      end if}
326 
327       \textcolor{keywordflow}{if} (ierr /=0) \textcolor{keywordflow}{then}
328         print *, \textcolor{stringliteral}{"unable to fetch memory consumption from system files"}
329         \textcolor{keywordflow}{RETURN}
330 \textcolor{keywordflow}{      end if}
331 \textcolor{keywordflow}{    end do}
332 
333     \textcolor{keyword}{read}(unit=fileid, fmt=*) ch, bytes, byte\_unit
334 
335     \textcolor{keyword}{call }write_log(text=\textcolor{stringliteral}{"Peak RAM  consumption on image"}, int1=1\_ikind*this\_image(), text2=\textcolor{stringliteral}{"was:"}, int2=
      bytes, text3=byte\_unit)
336 
337     \textcolor{keywordflow}{do} 
338       \textcolor{keyword}{read}(unit=fileid, fmt=*) ch
339       \textcolor{keywordflow}{if} (ch == \textcolor{stringliteral}{"VmSwap:"}) \textcolor{keywordflow}{then}
340         backspace fileid
341         \textcolor{keywordflow}{EXIT}
342 \textcolor{keywordflow}{      end if}
343 
344       \textcolor{keywordflow}{if} (ierr /=0) \textcolor{keywordflow}{then}
345         print *, \textcolor{stringliteral}{"unable to fetch swap consumption from system files"}
346         \textcolor{keywordflow}{RETURN}
347 \textcolor{keywordflow}{      end if}
348 \textcolor{keywordflow}{    end do}
349 
350     \textcolor{keyword}{read}(unit=fileid, fmt=*) ch, bytes, byte\_unit
351 
352     \textcolor{keyword}{call }write_log(text=\textcolor{stringliteral}{"Peak SWAP consumption on image"}, int1=1\_ikind*this\_image(), text2=\textcolor{stringliteral}{"was:"}, int2=
      bytes, text3=byte\_unit)
353 
354 
355     \textcolor{keyword}{close}(fileid)
356 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=298pt]{namespacepostpro_ad7dbd8a9caed2ac75b253d6b46d098d2_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=229pt]{namespacepostpro_ad7dbd8a9caed2ac75b253d6b46d098d2_icgraph}
\end{center}
\end{figure}


\index{postpro@{postpro}!make\+\_\+print@{make\+\_\+print}}
\index{make\+\_\+print@{make\+\_\+print}!postpro@{postpro}}
\subsubsection[{make\+\_\+print(behaviour, curtime, name)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public postpro\+::make\+\_\+print (
\begin{DoxyParamCaption}
\item[{character(len=$\ast$), intent(in), optional}]{behaviour, }
\item[{real(kind=rkind), intent(in), optional}]{curtime, }
\item[{character(len=$\ast$), intent(in), optional}]{name}
\end{DoxyParamCaption}
)}\label{namespacepostpro_a21af39d8fdc38e6b736346450f99fece}


Definition at line 29 of file postpro.\+f90.



References globals\+::drutes\+\_\+config, core\+\_\+tools\+::find\+\_\+unit(), globals\+::observe\+\_\+info, pde\+\_\+objs\+::pde, globals\+::postpro\+\_\+dec, globals\+::postpro\+\_\+run, print\+\_\+gmsh(), print\+\_\+pure(), print\+\_\+scilab(), globals\+::time, core\+\_\+tools\+::write\+\_\+log(), and globals\+::www.



Referenced by fem\+::exitme(), re\+\_\+constitutive\+::intoverflow(), and fem\+::solve\+\_\+pde().


\begin{DoxyCode}
29       \textcolor{keywordtype}{use }typy
30       \textcolor{keywordtype}{use }globals
31       \textcolor{keywordtype}{use }global_objs
32       \textcolor{keywordtype}{use }core_tools
33       \textcolor{keywordtype}{use }geom_tools
34       \textcolor{keywordtype}{use }pde_objs
35       \textcolor{keywordtype}{use }debug_tools
36 
37       \textcolor{keywordtype}{character(len=*)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional}                :: behaviour
38       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional}                :: curtime
39       \textcolor{keywordtype}{character(len=*)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional}                :: name
40       \textcolor{keywordtype}{logical}                                               :: anime
41       \textcolor{keywordtype}{integer(kind=ikind)}                                   :: mode, no\_prints
42       \textcolor{keywordtype}{character(len=256)}, \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{allocatable}       :: filenames
43       \textcolor{keywordtype}{integer(kind=ikind)}                                   :: i, i\_err,\textcolor{comment}{ j, layer, proc, run}
44 \textcolor{comment}{      }\textcolor{keywordtype}{character(len=64)}                                     :: forma
45       \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{pointer}, \textcolor{keywordtype}{save}                :: ids
46       \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{target}, \textcolor{keywordtype}{save}    :: ids\_obs
47       \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{target}, \textcolor{keywordtype}{save}    :: ids\_anime
48       \textcolor{keywordtype}{character(len=5)}                                      :: extension
49       \textcolor{keywordtype}{character(len=15)}                                     :: prefix
50       \textcolor{keywordtype}{real(kind=rkind)}                                      :: distance,\textcolor{comment}{ avgval, val1, val2, val3, tmp, 
      flux}
51 \textcolor{comment}{      }\textcolor{keywordtype}{logical}, \textcolor{keywordtype}{save}                                         :: first\_run=\textcolor{comment}{.true.}
52 \textcolor{comment}{      }\textcolor{keywordtype}{type}(integpnt_str)                                    :: quadpnt
53       \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{save}                             :: anime\_run\textcolor{comment}{, anime\_dec}
54 \textcolor{comment}{      }\textcolor{keywordtype}{integer}                                               :: ierr
55 
56       \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(name)) \textcolor{keywordflow}{then}
57         \textcolor{keywordflow}{select case}(name)
58           \textcolor{keywordflow}{case}(\textcolor{stringliteral}{"obs"})
59             anime = .false.
60             mode = 0
61           \textcolor{keywordflow}{case}(\textcolor{stringliteral}{"avi"})
62             anime = .true.
63             mode = -1
64 \textcolor{keywordflow}{          case default}
65             print *, \textcolor{stringliteral}{"this is a BUG, contact developer, called from postpro::make\_print()"}
66             error stop
67 \textcolor{keywordflow}{        end select}
68       \textcolor{keywordflow}{else}
69         anime = .false.
70         mode = 0
71 \textcolor{keywordflow}{      end if}
72       
73 
74       \textcolor{keywordflow}{if} (drutes_config%dimen < 2  .or. www) \textcolor{keywordflow}{then}
75         extension = \textcolor{stringliteral}{".dat"}
76       \textcolor{keywordflow}{else} 
77         \textcolor{keywordflow}{select case}(observe_info%fmt)
78           \textcolor{keywordflow}{case}(\textcolor{stringliteral}{"pure"})
79             extension = \textcolor{stringliteral}{".dat"}
80           \textcolor{keywordflow}{case}(\textcolor{stringliteral}{"scil"})
81             extension = \textcolor{stringliteral}{".sci"}
82           \textcolor{keywordflow}{case}(\textcolor{stringliteral}{"gmsh"})
83             extension = \textcolor{stringliteral}{".msh"}
84 \textcolor{keywordflow}{        end select}
85 \textcolor{keywordflow}{      end if}
86           
87   
88       \textcolor{keyword}{call }write_log(\textcolor{stringliteral}{"making output files for observation time"})
89       
90 
91       
92       \textcolor{keywordflow}{if} (.not. anime) \textcolor{keywordflow}{then}
93         postpro_run = postpro_run + 1
94       \textcolor{keywordflow}{else}
95         \textcolor{keywordflow}{if} (first\_run) \textcolor{keywordflow}{then}
96           anime\_run = 0
97 \textcolor{keywordflow}{        end if}
98         anime\_run = anime\_run + 1
99 \textcolor{keywordflow}{      end if}
100 
101       
102       \textcolor{keywordflow}{if} (.not. anime) \textcolor{keywordflow}{then}
103         \textcolor{keywordflow}{do} 
104           \textcolor{keywordflow}{if} (postpro_run/(10**postpro_dec) < 1) \textcolor{keywordflow}{then}
105             \textcolor{keywordflow}{EXIT}
106           \textcolor{keywordflow}{else}
107             postpro_dec = postpro_dec + 1
108 \textcolor{keywordflow}{          end if}
109 \textcolor{keywordflow}{        end do}
110 \textcolor{keywordflow}{      end if}
111   
112       \textcolor{keywordflow}{if} (.not. \textcolor{keyword}{allocated}(ids\_obs)) \textcolor{keywordflow}{then}
113         \textcolor{keyword}{allocate}(ids(ubound(pde,1), 4))
114         \textcolor{keyword}{allocate}(ids\_obs(ubound(pde,1), 4))
115         \textcolor{keyword}{allocate}(ids\_anime(ubound(pde,1), 4))
116 \textcolor{keywordflow}{      end if}
117       
118       \textcolor{keywordflow}{if} (anime) \textcolor{keywordflow}{then}
119         ids => ids\_anime
120       \textcolor{keywordflow}{else}
121         ids => ids\_obs
122 \textcolor{keywordflow}{      end if}
123         
124 
125       \textcolor{keyword}{allocate}(filenames(ubound(pde,1),4))
126  
127       
128       \textcolor{keywordflow}{if} (anime) \textcolor{keywordflow}{then}
129         prefix = \textcolor{stringliteral}{"out/anime/"}
130         \textcolor{keyword}{write}(unit=forma, fmt=\textcolor{stringliteral}{"(a, I7, a)"}) \textcolor{stringliteral}{"(a, a, a, a, a, I"}, 1,\textcolor{stringliteral}{" a)"}
131         run = anime\_run
132       \textcolor{keywordflow}{else}
133         prefix = \textcolor{stringliteral}{"out/"}
134         \textcolor{keyword}{write}(unit=forma, fmt=\textcolor{stringliteral}{"(a, I7, a)"}) \textcolor{stringliteral}{"(a, a, a, a, a, I"}, postpro_dec,\textcolor{stringliteral}{" a)"}
135         run = postpro_run
136 \textcolor{keywordflow}{      end if}
137 
138       \textcolor{keywordflow}{do} proc=1, ubound(pde,1)
139 
140         \textcolor{keyword}{write}(unit=filenames(proc,1), fmt=forma) trim(prefix), trim(pde(proc)%problem\_name\textcolor{comment}{(1)), }\textcolor{stringliteral}{"\_"}\textcolor{comment}{, &}
141 \textcolor{comment}{        trim(pde(proc)%solution\_name(1)), }\textcolor{stringliteral}{"-"},  run, trim(extension)
142 
143 
144         \textcolor{keyword}{write}(unit=filenames(proc,2), fmt=forma) trim(prefix), trim(pde(proc)%problem\_name\textcolor{comment}{(1)), }\textcolor{stringliteral}{"\_"}\textcolor{comment}{, trim(
      pde(proc)%solution\_name(1)), &}
145 \textcolor{comment}{                                                  }\textcolor{stringliteral}{"-el\_avg-"},  run,  trim(extension)
146 
147         \textcolor{keyword}{write}(unit=filenames(proc,3), fmt=forma) trim(prefix), trim(pde(proc)%problem\_name\textcolor{comment}{(1)), }\textcolor{stringliteral}{"\_"}\textcolor{comment}{,  trim(
      pde(proc)%mass\_name(1)), }\textcolor{stringliteral}{"-"}\textcolor{comment}{, & }
148 \textcolor{comment}{                                             run,  trim(extension)}
149 \textcolor{comment}{}
150 \textcolor{comment}{        }\textcolor{keyword}{write}(unit=filenames(proc,4), fmt=forma) trim(prefix), trim(pde(proc)%problem\_name\textcolor{comment}{(1)), }\textcolor{stringliteral}{"\_"}\textcolor{comment}{, trim(
      pde(proc)%flux\_name(1)), }\textcolor{stringliteral}{"-"}\textcolor{comment}{, &}
151 \textcolor{comment}{                                                  run,  trim(extension)}
152 \textcolor{comment}{!       }
153         \textcolor{keywordflow}{if} ( (.not. anime .and. mode == 0)  .or. &
154           (anime\_run == 1 .and. anime) .or. & 
155          ( .not. anime .and. (mode == -1 .and. postpro_run == 0 ) ) ) \textcolor{keywordflow}{then}
156 
157           \textcolor{keywordflow}{do} i=1, ubound(filenames,2)
158             \textcolor{keyword}{call }find_unit(ids(proc, i), 6000)
159             \textcolor{keyword}{open}(unit=ids(proc, i), file=trim(filenames(proc,i)), action=\textcolor{stringliteral}{"write"}\textcolor{comment}{, status=}\textcolor{stringliteral}{"replace"}\textcolor{comment}{, iostat=
      ierr)}
160 \textcolor{comment}{            }\textcolor{keywordflow}{if} (ierr /= 0) \textcolor{keywordflow}{then}
161               \textcolor{keyword}{call }system(\textcolor{stringliteral}{"mkdir out/anime"})
162               \textcolor{keyword}{open}(unit=ids(proc, i), file=trim(filenames(proc,i)), action=\textcolor{stringliteral}{"write"}\textcolor{comment}{, status=}\textcolor{stringliteral}{"replace"}\textcolor{comment}{, 
      iostat=ierr)}
163 \textcolor{comment}{              }\textcolor{keywordflow}{if} (ierr /= 0) \textcolor{keywordflow}{then}
164                 print *, \textcolor{stringliteral}{"unexpected system error, called from postpro::make\_print()"}
165                 error stop
166 \textcolor{keywordflow}{              end if}
167 \textcolor{keywordflow}{            end if}
168 \textcolor{keywordflow}{          end do}  
169 \textcolor{keywordflow}{        end if}
170 
171 
172         quadpnt%type\_pnt = \textcolor{stringliteral}{"ndpt"}
173         
174         \textcolor{keywordflow}{if} (time > epsilon(time) ) \textcolor{keywordflow}{then}
175           quadpnt%column = 3
176         \textcolor{keywordflow}{else}
177           quadpnt%column = 1
178 \textcolor{keywordflow}{        end if}
179         
180         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(curtime)) \textcolor{keywordflow}{then}
181           quadpnt%globtime = .false.
182           quadpnt%time4eval = curtime
183 \textcolor{keywordflow}{        end if}
184 
185         
186         \textcolor{keywordflow}{if} (drutes_config%dimen == 1 .or. www) \textcolor{keywordflow}{then}
187   
188           \textcolor{keyword}{call }print_pure(ids(proc,:), proc, quadpnt)
189           
190         \textcolor{keywordflow}{else}
191           \textcolor{keywordflow}{select case}(observe_info%fmt)
192             \textcolor{keywordflow}{case}(\textcolor{stringliteral}{"pure"})
193               \textcolor{keyword}{call }print_pure(ids(proc,:), proc, quadpnt)
194             \textcolor{keywordflow}{case}(\textcolor{stringliteral}{"scil"})
195               \textcolor{keyword}{call }print_scilab(ids(proc,:), proc, quadpnt)
196             \textcolor{keywordflow}{case}(\textcolor{stringliteral}{"gmsh"})
197               \textcolor{keyword}{call }print_gmsh(ids(proc,:), proc, quadpnt)
198 \textcolor{keywordflow}{          end select}
199 \textcolor{keywordflow}{        end if}
200 \textcolor{keywordflow}{      end do}
201 
202 
203       \textcolor{keywordflow}{if} (.not. anime) \textcolor{keywordflow}{then}
204         \textcolor{keywordflow}{do} proc=1, ubound(pde,1)
205           \textcolor{keywordflow}{do} i=1,ubound(ids,2)
206             \textcolor{keywordflow}{if} (mode == 0) \textcolor{keywordflow}{then}
207               \textcolor{keyword}{close}(ids(proc,i))
208             \textcolor{keywordflow}{else}
209               \textcolor{keyword}{call }flush(ids(proc,i))
210 \textcolor{keywordflow}{            end if}
211 \textcolor{keywordflow}{          end do}
212 \textcolor{keywordflow}{        end do}  
213       \textcolor{keywordflow}{else}      
214         \textcolor{keywordflow}{do} proc=1, ubound(pde,1)
215           \textcolor{keywordflow}{do} i=1,ubound(ids,2)
216             \textcolor{keyword}{write}(unit=ids(proc,i), fmt=\textcolor{stringliteral}{"(a,I6.6,a)"} ) \textcolor{stringliteral}{"xs2png(0, 'K-"}, anime\_run\textcolor{comment}{ , }\textcolor{stringliteral}{".png');"}
217             \textcolor{keyword}{write}(unit=ids(proc,i), fmt=*) \textcolor{stringliteral}{"clear"}
218             \textcolor{keyword}{write}(unit=ids(proc,i), fmt=*) \textcolor{stringliteral}{"   "}
219             \textcolor{keyword}{call }flush(ids(proc,i))
220 \textcolor{keywordflow}{          end do}
221 \textcolor{keywordflow}{        end do}
222         
223 \textcolor{keywordflow}{      end if}
224       
225 
226       \textcolor{keyword}{deallocate}(filenames)
227       
228       first\_run=.false.
229       
230       
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=290pt]{namespacepostpro_a21af39d8fdc38e6b736346450f99fece_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacepostpro_a21af39d8fdc38e6b736346450f99fece_icgraph}
\end{center}
\end{figure}


\index{postpro@{postpro}!print\+\_\+gmsh@{print\+\_\+gmsh}}
\index{print\+\_\+gmsh@{print\+\_\+gmsh}!postpro@{postpro}}
\subsubsection[{print\+\_\+gmsh(ids, proc, quadpnt)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, private postpro\+::print\+\_\+gmsh (
\begin{DoxyParamCaption}
\item[{integer, dimension(\+:), intent(in)}]{ids, }
\item[{integer(kind=ikind), intent(in)}]{proc, }
\item[{type({\bf integpnt\+\_\+str}), intent(inout)}]{quadpnt}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespacepostpro_a075d651e98dee329985f2b054ba54415}


Definition at line 527 of file postpro.\+f90.



References globals\+::elements, globals\+::nodes, pde\+\_\+objs\+::pde, globals\+::postpro\+\_\+run, and globals\+::time.



Referenced by make\+\_\+print().


\begin{DoxyCode}
527     \textcolor{keywordtype}{use }typy
528     \textcolor{keywordtype}{use }globals
529     \textcolor{keywordtype}{use }global_objs
530     \textcolor{keywordtype}{use }pde_objs
531     \textcolor{keywordtype}{use }debug_tools
532     
533     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: ids
534     \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: proc
535     \textcolor{keywordtype}{type}(integpnt_str),  \textcolor{keywordtype}{intent(in out)} :: quadpnt
536     \textcolor{keywordtype}{integer(kind=ikind)} :: i
537     \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{save} :: printed 
538     \textcolor{keywordtype}{real(kind=rkind)} :: curtime
539     
540     
541     \textcolor{keywordflow}{if} (.not. \textcolor{keyword}{allocated}(printed)) \textcolor{keywordflow}{then}
542       \textcolor{keyword}{allocate}(printed(ubound(pde,1)))
543       printed = .false.
544 \textcolor{keywordflow}{    end if}
545         
546     \textcolor{keywordflow}{if} (.not. quadpnt%globtime) \textcolor{keywordflow}{then}
547       curtime = quadpnt%time4eval
548     \textcolor{keywordflow}{else}
549       curtime = time
550 \textcolor{keywordflow}{    end if}
551     
552     \textcolor{keywordflow}{if} (.not. printed(proc)) \textcolor{keywordflow}{then}
553   
554       \textcolor{keyword}{write}(unit=ids(1), fmt=\textcolor{stringliteral}{"(a)"}) \textcolor{stringliteral}{"$MeshFormat"}
555       \textcolor{keyword}{write}(unit=ids(1), fmt=\textcolor{stringliteral}{"(a)"}) \textcolor{stringliteral}{"2.2 0 8"}
556       \textcolor{keyword}{write}(unit=ids(1), fmt=\textcolor{stringliteral}{"(a)"}) \textcolor{stringliteral}{"$EndMeshFormat"}
557       \textcolor{keyword}{write}(unit=ids(1), fmt=\textcolor{stringliteral}{"(a)"}) \textcolor{stringliteral}{"$Nodes"}
558       
559       \textcolor{keyword}{write}(unit=ids(1), fmt=*) nodes%kolik
560       
561       \textcolor{keywordflow}{do} i=1, nodes%kolik
562         \textcolor{keyword}{write}(unit=ids(1), fmt=*) i,  nodes%data(i,:)
563 \textcolor{keywordflow}{      end do}
564       \textcolor{keyword}{write}(unit=ids(1), fmt=\textcolor{stringliteral}{"(a)"}) \textcolor{stringliteral}{"$EndNodes"}
565       \textcolor{keyword}{write}(unit=ids(1), fmt=\textcolor{stringliteral}{"(a)"}) \textcolor{stringliteral}{"$Elements"}
566       \textcolor{keyword}{write}(unit=ids(1), fmt=*) elements%kolik
567       \textcolor{keywordflow}{do} i=1, elements%kolik
568         \textcolor{keyword}{write}(unit=ids(1), fmt=*) i,  elements%data(i,:)
569 \textcolor{keywordflow}{      end do}
570       \textcolor{keyword}{write}(unit=ids(1), fmt=\textcolor{stringliteral}{"(a)"}) \textcolor{stringliteral}{"$EndElements"}
571       \textcolor{keyword}{write}(unit=ids(1), fmt=\textcolor{stringliteral}{"(a)"}) \textcolor{stringliteral}{"$NodeData"}
572       
573       printed(proc) = .true.
574 \textcolor{keywordflow}{    end if}
575     
576     \textcolor{keyword}{write}(unit=ids(1), fmt=\textcolor{stringliteral}{"(a)"}) \textcolor{stringliteral}{"$NodeData"}     
577     \textcolor{keyword}{write}(unit=ids(1), fmt=*) \textcolor{stringliteral}{"1"}
578     \textcolor{keyword}{write}(unit=ids(1), fmt=*) \textcolor{stringliteral}{' " '}, trim(pde(proc)%problem\_name(2)), \textcolor{stringliteral}{" "}, trim(
      pde(proc)%solution\_name(1)) , \textcolor{stringliteral}{' " '}
579     \textcolor{keyword}{write}(unit=ids(1), fmt=*) \textcolor{stringliteral}{"1"}
580     \textcolor{keyword}{write}(unit=ids(1), fmt=*) curtime  \textcolor{comment}{!///tohle udává čas}
581     \textcolor{keyword}{write}(unit=ids(1), fmt=*) \textcolor{stringliteral}{"3"}
582     \textcolor{keyword}{write}(unit=ids(1), fmt=*) postpro_run
583     \textcolor{keyword}{write}(unit=ids(1), fmt=*) \textcolor{stringliteral}{"1"}
584       
585 
586     
587     \textcolor{keyword}{write}(unit=ids(1), fmt=*) nodes%kolik
588     \textcolor{keywordflow}{do} i=1, nodes%kolik
589       quadpnt%order = i
590       \textcolor{keyword}{write}(unit=ids(1), fmt=*) i, pde(proc)%getval(quadpnt)
591 \textcolor{keywordflow}{    end do}
592     \textcolor{keyword}{write}(unit=ids(1), fmt=\textcolor{stringliteral}{"(a)"}) \textcolor{stringliteral}{"$EndNodeData"}
593   
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacepostpro_a075d651e98dee329985f2b054ba54415_icgraph}
\end{center}
\end{figure}


\index{postpro@{postpro}!print\+\_\+pure@{print\+\_\+pure}}
\index{print\+\_\+pure@{print\+\_\+pure}!postpro@{postpro}}
\subsubsection[{print\+\_\+pure(ids, proc, quadpnt)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, private postpro\+::print\+\_\+pure (
\begin{DoxyParamCaption}
\item[{integer, dimension(\+:), intent(in)}]{ids, }
\item[{integer(kind=ikind), intent(in)}]{proc, }
\item[{type({\bf integpnt\+\_\+str}), intent(inout)}]{quadpnt}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespacepostpro_ac9d752e3b26cac769ba607b84791ba2a}


Definition at line 493 of file postpro.\+f90.



References globals\+::elements, globals\+::nodes, and pde\+\_\+objs\+::pde.



Referenced by make\+\_\+print().


\begin{DoxyCode}
493     \textcolor{keywordtype}{use }typy
494     \textcolor{keywordtype}{use }globals
495     \textcolor{keywordtype}{use }global_objs
496     \textcolor{keywordtype}{use }pde_objs
497     
498     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: ids
499     \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: proc
500     \textcolor{keywordtype}{type}(integpnt_str),  \textcolor{keywordtype}{intent(in out)} :: quadpnt
501     \textcolor{keywordtype}{real(kind=rkind)} :: curtime
502     \textcolor{keywordtype}{integer(kind=ikind)} :: i, layer
503     \textcolor{keywordtype}{real(kind=rkind)} ::  distance, flux, avgval
504     \textcolor{keywordtype}{type}(integpnt_str) :: qpntloc
505 
506   
507     \textcolor{keywordflow}{do} i=1, nodes%kolik
508       quadpnt%order = i
509       quadpnt%preproc=.true.
510       \textcolor{keyword}{write}(unit=ids(1), fmt=*) i,  nodes%data(i,:), pde(proc)%getval(quadpnt) 
511       
512       layer = elements%material(nodes%element(i)%data(1), proc)
513 
514       \textcolor{keyword}{call }pde(proc)%flux(layer, quadpnt, scalar=flux)
515       
516       \textcolor{keyword}{write}(unit=ids(3), fmt=*)  i, nodes%data(i,:), pde(proc)%mass(layer, quadpnt)
517 
518       \textcolor{keyword}{write}(unit=ids(4), fmt=*) i, nodes%data(i,:), flux
519 \textcolor{keywordflow}{    end do}
520     
521     \textcolor{keyword}{close}(ids(1))
522 
523   
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacepostpro_ac9d752e3b26cac769ba607b84791ba2a_icgraph}
\end{center}
\end{figure}


\index{postpro@{postpro}!print\+\_\+scilab@{print\+\_\+scilab}}
\index{print\+\_\+scilab@{print\+\_\+scilab}!postpro@{postpro}}
\subsubsection[{print\+\_\+scilab(ids, proc, quadpnt)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, private postpro\+::print\+\_\+scilab (
\begin{DoxyParamCaption}
\item[{integer, dimension(\+:), intent(in)}]{ids, }
\item[{integer(kind=ikind), intent(in)}]{proc, }
\item[{type({\bf integpnt\+\_\+str}), intent(inout)}]{quadpnt}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespacepostpro_a30f6a138dc9108e16310e8c9ec415a8a}


Definition at line 360 of file postpro.\+f90.



References globals\+::drutes\+\_\+config, globals\+::elements, globals\+::gauss\+\_\+points, globals\+::nodes, pde\+\_\+objs\+::pde, globals\+::time, and globals\+::time\+\_\+units.



Referenced by make\+\_\+print().


\begin{DoxyCode}
360     \textcolor{keywordtype}{use }typy
361     \textcolor{keywordtype}{use }globals
362     \textcolor{keywordtype}{use }global_objs
363     \textcolor{keywordtype}{use }pde_objs
364     \textcolor{keywordtype}{use }geom_tools
365     \textcolor{keywordtype}{use }debug_tools
366     
367     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: ids
368     \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: proc
369     \textcolor{keywordtype}{type}(integpnt_str), \textcolor{keywordtype}{intent(in out)} :: quadpnt
370     \textcolor{keywordtype}{integer(kind=ikind)} :: i, j, layer
371     \textcolor{keywordtype}{real(kind=rkind)} :: tmp, totflux
372     \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(3)} :: flux
373     \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(3,8)} :: body
374     \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(2)} :: vct1, vct2
375     \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(8)} :: vct\_tmp
376     \textcolor{keywordtype}{integer(kind=ikind)} :: time\_dec
377     \textcolor{keywordtype}{real(kind=rkind)} :: curtime
378     \textcolor{keywordtype}{type}(integpnt_str) :: qpntloc
379 
380     
381     
382     \textcolor{keywordflow}{if} (.not. quadpnt%globtime) \textcolor{keywordflow}{then}
383       curtime = quadpnt%time4eval
384     \textcolor{keywordflow}{else}
385       curtime = time
386 \textcolor{keywordflow}{    end if}
387   
388     \textcolor{keywordflow}{do} i=1, ubound(ids,1)
389       \textcolor{keyword}{write}(unit=ids(i), fmt=*) \textcolor{stringliteral}{"//"}, curtime
390       \textcolor{keyword}{write}(unit=ids(i), fmt=*) \textcolor{stringliteral}{"nt ="}, elements%kolik, \textcolor{stringliteral}{";"}
391       \textcolor{keyword}{write}(unit=ids(i), fmt=*) \textcolor{stringliteral}{"x=zeros(nt,3);"}
392       \textcolor{keyword}{write}(unit=ids(i), fmt=*) \textcolor{stringliteral}{"y=zeros(nt,3);"}
393       \textcolor{keyword}{write}(unit=ids(i), fmt=*) \textcolor{stringliteral}{"z=zeros(nt,3);"}
394 \textcolor{keywordflow}{    end do}
395 
396 
397     quadpnt%preproc=.true.
398     \textcolor{keywordflow}{do} i=1, elements%kolik
399       \textcolor{keywordflow}{do} j=1,ubound(elements%data,2)
400         body(j,1:2) = nodes%data(elements%data(i,j),:)
401         quadpnt%order = elements%data(i,j)
402         body(j,3) = pde(proc)%getval(quadpnt)
403 \textcolor{keywordflow}{      end do}
404     
405       \textcolor{comment}{! mass (constant over element)}
406       layer = elements%material(i, proc)
407       qpntloc%element = i
408       qpntloc%column = 2
409       qpntloc%type\_pnt = \textcolor{stringliteral}{"gqnd"}
410       tmp = 0
411       \textcolor{keywordflow}{do} j=1, ubound(gauss_points%weight,1)
412         qpntloc%order = j
413         tmp = tmp + pde(proc)%mass(layer, qpntloc)*gauss_points%weight(j)
414 \textcolor{keywordflow}{      end do}
415       
416       body(:,5) = tmp/gauss_points%area
417         
418       \textcolor{keywordflow}{if} (ubound(gauss_points%weight,1) > 1) \textcolor{keywordflow}{then}
419         qpntloc%order = nint(ubound(gauss_points%weight,1)/2.0)
420       \textcolor{keywordflow}{else}
421         qpntloc%order = 1
422 \textcolor{keywordflow}{      end if}
423       
424       \textcolor{keyword}{call }pde(proc)%flux(layer, qpntloc, vector\_out=flux(1:drutes_config%dimen), scalar=totflux)
425 
426       body(:,6) = totflux
427       
428       vct1 = body(3, 1:2) - body(1, 1:2) 
429       vct2 = body(3, 1:2) - body(2, 1:2)
430       
431       \textcolor{keywordflow}{if} ( (vct1(1)*vct2(2)-vct1(2)*vct2(1)) > 0.0\_rkind) \textcolor{keywordflow}{then}
432         vct\_tmp = body(3,:)
433         body(3,:) = body(2,:)
434         body(2,:) = vct\_tmp
435       \textcolor{keywordflow}{else}
436         \textcolor{keywordflow}{CONTINUE}
437 \textcolor{keywordflow}{      end if}
438 
439       \textcolor{keywordflow}{do} j=1, ubound(ids,1)
440         \textcolor{keyword}{write}(unit=ids(j), fmt=*) \textcolor{stringliteral}{"x("}, i, \textcolor{stringliteral}{",1) ="}, body(1,1), \textcolor{stringliteral}{";"}
441         \textcolor{keyword}{write}(unit=ids(j), fmt=*) \textcolor{stringliteral}{"x("}, i, \textcolor{stringliteral}{",2) ="}, body(2,1), \textcolor{stringliteral}{";"}
442         \textcolor{keyword}{write}(unit=ids(j), fmt=*) \textcolor{stringliteral}{"x("}, i, \textcolor{stringliteral}{",3) ="}, body(3,1), \textcolor{stringliteral}{";"}
443         
444         \textcolor{keyword}{write}(unit=ids(j), fmt=*) \textcolor{stringliteral}{"y("}, i, \textcolor{stringliteral}{",1) ="}, body(1,2), \textcolor{stringliteral}{";"}
445         \textcolor{keyword}{write}(unit=ids(j), fmt=*) \textcolor{stringliteral}{"y("}, i, \textcolor{stringliteral}{",2) ="}, body(2,2), \textcolor{stringliteral}{";"}
446         \textcolor{keyword}{write}(unit=ids(j), fmt=*) \textcolor{stringliteral}{"y("}, i, \textcolor{stringliteral}{",3) ="}, body(3,2), \textcolor{stringliteral}{";"}
447 
448         \textcolor{keyword}{write}(unit=ids(j), fmt=*) \textcolor{stringliteral}{"z("}, i, \textcolor{stringliteral}{",1) ="}, body(1,2+j), \textcolor{stringliteral}{";"}
449         \textcolor{keyword}{write}(unit=ids(j), fmt=*) \textcolor{stringliteral}{"z("}, i, \textcolor{stringliteral}{",2) ="}, body(2,2+j), \textcolor{stringliteral}{";"}
450         \textcolor{keyword}{write}(unit=ids(j), fmt=*) \textcolor{stringliteral}{"z("}, i, \textcolor{stringliteral}{",3) ="}, body(3,2+j), \textcolor{stringliteral}{";"}
451 \textcolor{keywordflow}{      end do}
452 
453 \textcolor{keywordflow}{    end do}
454   
455     time\_dec = 0
456     \textcolor{keywordflow}{if} (curtime>epsilon(curtime)) \textcolor{keywordflow}{then}
457       \textcolor{keywordflow}{do}
458         \textcolor{keywordflow}{if} (curtime*10.0\_rkind**time\_dec > 1) \textcolor{keywordflow}{then}
459           \textcolor{keywordflow}{EXIT} 
460         \textcolor{keywordflow}{else}
461           time\_dec = time\_dec + 1
462 \textcolor{keywordflow}{        end if}
463 \textcolor{keywordflow}{      end do}
464 \textcolor{keywordflow}{    end if}
465     
466 
467 
468     \textcolor{keywordflow}{do} i=1, ubound(ids,1)
469       \textcolor{keyword}{write}(unit=ids(i), fmt=*) \textcolor{stringliteral}{"f=gcf();"}
470       \textcolor{keyword}{write}(unit=ids(i), fmt=*) \textcolor{stringliteral}{"clf(f,'reset');"}
471       \textcolor{keyword}{write}(unit=ids(i), fmt=*) \textcolor{stringliteral}{"f.color\_map=jetcolormap(256);"}
472       \textcolor{keyword}{write}(unit=ids(i), fmt=*) \textcolor{stringliteral}{"colorbar(min(z),max(z));"}
473       \textcolor{keywordflow}{if} (time\_dec < 2) \textcolor{keywordflow}{then}
474         \textcolor{keyword}{write}(unit=ids(i), fmt=\textcolor{stringliteral}{"(a,F10.2,a,a,a,a)"})  \textcolor{stringliteral}{"xtitle('$\(\backslash\)mathbf\{\(\backslash\)LARGE t= "}, curtime,\textcolor{stringliteral}{"  "},&
475               \textcolor{stringliteral}{"\} \(\backslash\)quad \(\backslash\)mbox\{\(\backslash\)Large "},   trim(time_units), \textcolor{stringliteral}{"\}$')"}
476       \textcolor{keywordflow}{else}
477                                                             
478 \textcolor{comment}{!                                                                  a                     F10.2        a}
479        \textcolor{keyword}{write}(unit=ids(i), fmt=\textcolor{stringliteral}{"(a,F10.2,a,a,I16,a,a,a)"})  \textcolor{stringliteral}{"xtitle('$\(\backslash\)mathbf\{\(\backslash\)LARGE t= "}, curtime*10**
      time\_dec,\textcolor{stringliteral}{"  "},&
480 \textcolor{comment}{!                    a            I16         a                         a                a}
481               \textcolor{stringliteral}{"\(\backslash\)times 10^\{-"}, time\_dec,\textcolor{stringliteral}{"\}\} \(\backslash\)quad \(\backslash\)mbox\{\(\backslash\)Large "},   trim(
      time_units), \textcolor{stringliteral}{"\}$')"}
482 \textcolor{keywordflow}{      end if}
483       
484       
485       \textcolor{keyword}{write}(unit=ids(i), fmt=*) \textcolor{stringliteral}{"plot3d1(x',y',z',alpha=0, theta=-90);"}
486 
487 \textcolor{keywordflow}{    end do} 
488   
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacepostpro_a30f6a138dc9108e16310e8c9ec415a8a_icgraph}
\end{center}
\end{figure}


\index{postpro@{postpro}!write\+\_\+obs@{write\+\_\+obs}}
\index{write\+\_\+obs@{write\+\_\+obs}!postpro@{postpro}}
\subsubsection[{write\+\_\+obs()}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public postpro\+::write\+\_\+obs (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{namespacepostpro_a00d58d5653970e829bcd95cb34cf5b75}


Definition at line 237 of file postpro.\+f90.



References globals\+::drutes\+\_\+config, globals\+::elements, globals\+::observation\+\_\+array, pde\+\_\+objs\+::pde, globals\+::time, and globals\+::time\+\_\+step.



Referenced by fem\+::solve\+\_\+pde().


\begin{DoxyCode}
237       \textcolor{keywordtype}{use }typy
238       \textcolor{keywordtype}{use }globals
239       \textcolor{keywordtype}{use }global_objs
240       \textcolor{keywordtype}{use }geom_tools
241       \textcolor{keywordtype}{use }pde_objs
242       \textcolor{keywordtype}{use }debug_tools
243                 
244       \textcolor{keywordtype}{integer(kind=ikind)} :: i, layer, proc, d
245       \textcolor{keywordtype}{real(kind=rkind)} :: val, massval
246       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(3)} :: advectval
247       \textcolor{keywordtype}{type}(integpnt_str) :: quadpnt
248       
249       quadpnt%type\_pnt = \textcolor{stringliteral}{"obpt"}
250       quadpnt%column=3
251       d = drutes_config%dimen
252       
253 
254       \textcolor{keywordflow}{do} proc=1, ubound(pde,1)
255         \textcolor{keywordflow}{do} i =1, ubound(observation_array,1)
256           layer = elements%material(observation_array(i)%element, proc)
257 
258           quadpnt%order = i
259           
260           quadpnt%element = observation_array(i)%element
261           
262           quadpnt%preproc=.true.
263           
264           \textcolor{keyword}{call }pde(proc)%flux(layer=layer, quadpnt=quadpnt,  vector\_out=advectval\textcolor{comment}{(1:d))}
265 \textcolor{comment}{}
266 \textcolor{comment}{          val = pde(proc)%getval(quadpnt)}
267 \textcolor{comment}{}
268 \textcolor{comment}{          massval = pde(proc)%mass(layer, quadpnt)}
269 \textcolor{comment}{          }
270 \textcolor{comment}{          observation_array(i)%cumflux(proc) = observation_array(i)%cumflux(proc) + &}
271 \textcolor{comment}{                    sqrt(dot_product(advectval(1:d), advectval(1:d)))*time_step}
272 \textcolor{comment}{                    }
273 \textcolor{comment}{}
274 \textcolor{comment}{          }\textcolor{keyword}{write}(unit=pde(proc)%obspt\_unit(i), fmt=\textcolor{stringliteral}{"(50E24.12E3)"}) time, val, massval\textcolor{comment}{, advectval(1:d), 
      observation_array(i)%cumflux(proc)}
275 \textcolor{comment}{}
276 \textcolor{comment}{          }\textcolor{keyword}{call }flush(pde(proc)%obspt\_unit(i))
277           
278 \textcolor{keywordflow}{        end do}
279 \textcolor{keywordflow}{      end do}
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=334pt]{namespacepostpro_a00d58d5653970e829bcd95cb34cf5b75_icgraph}
\end{center}
\end{figure}


