\section{schwarz\+\_\+dd2subcyc Module Reference}
\label{namespaceschwarz__dd2subcyc}\index{schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}}
\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine, public {\bf schwarz\+\_\+subcyc} (ierr, itcount, success)
\begin{DoxyCompactList}\small\item\em solves the problem using Picard method with Schwarz multiplicative domain decomposition reflecting the nonlinear problem \end{DoxyCompactList}\item 
subroutine {\bf solve\+\_\+subdomain} (sub, reps)
\item 
subroutine {\bf combinevals} (subdom, short)
\item 
subroutine, private {\bf build\+\_\+xvect\+\_\+loc} ()
\item 
subroutine, private {\bf search\+\_\+error\+\_\+cluster} (sub, itcount)
\item 
integer(kind=ikind) function, private {\bf domains\+\_\+solved} ()
\begin{DoxyCompactList}\small\item\em counts number of solved subdomains \end{DoxyCompactList}\item 
integer(kind=ikind) function {\bf ndofs\+\_\+solved} ()
\begin{DoxyCompactList}\small\item\em counts number of solved subdomains \end{DoxyCompactList}\item 
subroutine, private {\bf locmat\+\_\+assembler} (mtx, bvect, permut, dt, invpermut, domain\+\_\+id, extended, ierr)
\item 
subroutine, private {\bf set\+\_\+solved} (sub, mode)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
real(kind=rkind), dimension(\+:), allocatable, save, private {\bf resvct}
\item 
real(kind=rkind), dimension(\+:), allocatable, save, private {\bf corrvct}
\end{DoxyCompactItemize}


\subsection{Function/\+Subroutine Documentation}
\index{schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}!build\+\_\+xvect\+\_\+loc@{build\+\_\+xvect\+\_\+loc}}
\index{build\+\_\+xvect\+\_\+loc@{build\+\_\+xvect\+\_\+loc}!schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}}
\subsubsection[{build\+\_\+xvect\+\_\+loc()}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, private schwarz\+\_\+dd2subcyc\+::build\+\_\+xvect\+\_\+loc (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespaceschwarz__dd2subcyc_a3eefc94b849a82d14750938df8cdddc8}


Definition at line 313 of file schwarz\+\_\+dd2subcyc.\+f90.



References pde\+\_\+objs\+::pde\+\_\+common, decomp\+\_\+vars\+::prolong\+\_\+mtx, and decomp\+\_\+vars\+::subdomain.



Referenced by schwarz\+\_\+subcyc().


\begin{DoxyCode}
313         \textcolor{keywordtype}{use }typy
314         \textcolor{keywordtype}{use }globals
315         \textcolor{keywordtype}{use }global_objs
316         \textcolor{keywordtype}{use }pde_objs
317         \textcolor{keywordtype}{use }decomp_vars
318         \textcolor{keywordtype}{use }debug_tools
319         
320         \textcolor{keywordtype}{integer(kind=ikind)} :: i, glob, loc, subcrit
321 
322 
323         pde_common%xvect(:,2:3) = 0.0\_rkind
324         
325         
326         \textcolor{keywordflow}{do} i = 1, ubound(subdomain,1)
327           \textcolor{keywordflow}{do} loc = 1, subdomain(i)%ndof
328             glob =  subdomain(i)%permut(loc)
329             pde_common%xvect(glob,2:3) = pde_common%xvect(glob,2:3) + subdomain(i)%xvect(loc,2:3)*
      prolong_mtx%get(glob,i)
330 \textcolor{keywordflow}{          end do}
331 \textcolor{keywordflow}{        end do}
332         
333         pde_common%xvect(:,1) = pde_common%xvect(:,3)
334         
335         \textcolor{keywordflow}{do} i=1, ubound(subdomain,1)
336           subdomain(i)%xvect(:,:) = pde_common%xvect(subdomain(i)%permut(1:
      subdomain(i)%ndof),:)
337           subdomain(i)%extxvect(:,:) = pde_common%xvect(subdomain(i)%extpermut(1:
      subdomain(i)%extndof),:)
338 \textcolor{keywordflow}{        end do}
339         
340         
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd2subcyc_a3eefc94b849a82d14750938df8cdddc8_icgraph}
\end{center}
\end{figure}


\index{schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}!combinevals@{combinevals}}
\index{combinevals@{combinevals}!schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}}
\subsubsection[{combinevals(subdom, short)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine schwarz\+\_\+dd2subcyc\+::combinevals (
\begin{DoxyParamCaption}
\item[{type({\bf subdomain\+\_\+str}), intent(inout)}]{subdom, }
\item[{logical, intent(in)}]{short}
\end{DoxyParamCaption}
)}\label{namespaceschwarz__dd2subcyc_a8cf80997fb263fed0e4cc5ac533932b0}


Definition at line 268 of file schwarz\+\_\+dd2subcyc.\+f90.



References decomp\+\_\+vars\+::ddinfo, pde\+\_\+objs\+::pde\+\_\+common, decomp\+\_\+vars\+::prolong\+\_\+mtx, set\+\_\+solved(), and decomp\+\_\+vars\+::subdomain.



Referenced by schwarz\+\_\+subcyc().


\begin{DoxyCode}
268         \textcolor{keywordtype}{use }typy
269         \textcolor{keywordtype}{use }decomp_vars
270         \textcolor{keywordtype}{use }pde_objs
271         \textcolor{keywordtype}{use }debug_tools
272         
273         
274         \textcolor{keywordtype}{type}(subdomain_str), \textcolor{keywordtype}{intent(in out)} :: subdom
275         \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{intent(in)} :: short
276         \textcolor{keywordtype}{integer(kind=ikind)} :: i, glob, globgeom, j, sub, loc
277         \textcolor{keywordtype}{real(kind=rkind)} :: \textcolor{keywordtype}{value}, oldvalue
278         
279         \textcolor{keywordflow}{do} i=1, ubound(subdom%xvect,1)
280           glob = subdom%permut(i)
281           globgeom = pde_common%invpermut(glob)
282           oldvalue = subdom%xvect(i,2)
283           \textcolor{keywordflow}{if} (ddinfo%nodesinsub(globgeom)%pos >= 1) \textcolor{keywordflow}{then}
284           
285             \textcolor{keywordtype}{value} = 0
286             \textcolor{keywordflow}{do} j=1, ddinfo%nodesinsub(globgeom)%pos
287               sub = ddinfo%nodesinsub(globgeom)%data(j)
288               loc = subdomain(sub)%invpermut(glob)
289               \textcolor{keywordtype}{value} = \textcolor{keywordtype}{value} + subdomain(sub)%returnval(loc, subdom%time)*
      prolong_mtx%get(glob,sub)
290 \textcolor{keywordflow}{            end do}
291 
292             \textcolor{keywordflow}{if} (short) \textcolor{keywordflow}{then}
293               \textcolor{keywordflow}{if} (subdom%short\_dt) \textcolor{keywordflow}{then}
294                 subdom%xvect(i, 2:3) = \textcolor{keywordtype}{value}
295 \textcolor{keywordflow}{              end if}
296             \textcolor{keywordflow}{else}
297               subdom%xvect(i, 2:3) = \textcolor{keywordtype}{value}
298 \textcolor{keywordflow}{            end if}
299             
300             
301             \textcolor{keywordflow}{if} (subdom%solved .and. abs(\textcolor{keywordtype}{value}-oldvalue) > iter_criterion) \textcolor{keywordflow}{then}
302               \textcolor{keyword}{call }set_solved(subdom, mode=-1)
303 \textcolor{keywordflow}{            end if}
304             
305 \textcolor{keywordflow}{          end if}
306 \textcolor{keywordflow}{        end do}
307         
308       
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=304pt]{namespaceschwarz__dd2subcyc_a8cf80997fb263fed0e4cc5ac533932b0_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd2subcyc_a8cf80997fb263fed0e4cc5ac533932b0_icgraph}
\end{center}
\end{figure}


\index{schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}!domains\+\_\+solved@{domains\+\_\+solved}}
\index{domains\+\_\+solved@{domains\+\_\+solved}!schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}}
\subsubsection[{domains\+\_\+solved()}]{\setlength{\rightskip}{0pt plus 5cm}integer(kind=ikind) function, private schwarz\+\_\+dd2subcyc\+::domains\+\_\+solved (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespaceschwarz__dd2subcyc_aae81f4373f72df631462a60abf7be2d2}


counts number of solved subdomains 



Definition at line 386 of file schwarz\+\_\+dd2subcyc.\+f90.



References decomp\+\_\+vars\+::subdomain.



Referenced by schwarz\+\_\+subcyc().


\begin{DoxyCode}
386         \textcolor{keywordtype}{use }typy
387         \textcolor{keywordtype}{use }globals
388         \textcolor{keywordtype}{use }global_objs
389         \textcolor{keywordtype}{use }decomp_vars
390         
391         \textcolor{keywordtype}{integer(kind=ikind)} :: no
392 
393         \textcolor{keywordtype}{integer(kind=ikind)} :: i
394 
395         no = 0
396 
397         \textcolor{keywordflow}{do} i=1, ubound(subdomain,1)
398           \textcolor{keywordflow}{if} (subdomain(i)%solved) \textcolor{keywordflow}{then}
399             no = no + 1
400 \textcolor{keywordflow}{          end if}
401 \textcolor{keywordflow}{        end do}
402 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd2subcyc_aae81f4373f72df631462a60abf7be2d2_icgraph}
\end{center}
\end{figure}


\index{schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}!locmat\+\_\+assembler@{locmat\+\_\+assembler}}
\index{locmat\+\_\+assembler@{locmat\+\_\+assembler}!schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}}
\subsubsection[{locmat\+\_\+assembler(mtx, bvect, permut, dt, invpermut, domain\+\_\+id, extended, ierr)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, private schwarz\+\_\+dd2subcyc\+::locmat\+\_\+assembler (
\begin{DoxyParamCaption}
\item[{class({\bf extsmtx}), intent(inout)}]{mtx, }
\item[{real(kind=rkind), dimension(\+:), intent(out)}]{bvect, }
\item[{integer(kind=ikind), dimension(\+:), intent(in)}]{permut, }
\item[{real(kind=rkind), intent(in)}]{dt, }
\item[{integer(kind=ikind), dimension(\+:), intent(in)}]{invpermut, }
\item[{integer(kind=ikind), intent(in)}]{domain\+\_\+id, }
\item[{logical, intent(in)}]{extended, }
\item[{integer, intent(out)}]{ierr}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespaceschwarz__dd2subcyc_af9ae0ba0d8e6b75d61b7849eefcb28df}


Definition at line 428 of file schwarz\+\_\+dd2subcyc.\+f90.



References stiffmat\+::build\+\_\+bvect(), stiffmat\+::build\+\_\+stiff\+\_\+np(), globals\+::cap\+\_\+mat, decomp\+\_\+vars\+::ddinfo, globals\+::elements, globals\+::elnode\+\_\+prev, fem\+\_\+tools\+::in2global(), globals\+::nodes, solver\+\_\+interfaces\+::null\+\_\+problem(), pde\+\_\+objs\+::pde, pde\+\_\+objs\+::pde\+\_\+common, globals\+::stiff\+\_\+mat, and decomp\+\_\+vars\+::subdomain.



Referenced by solve\+\_\+subdomain().


\begin{DoxyCode}
428       \textcolor{keywordtype}{use }typy
429       \textcolor{keywordtype}{use }globals
430       \textcolor{keywordtype}{use }global_objs
431       \textcolor{keywordtype}{use }pde_objs
432       \textcolor{keywordtype}{use }capmat
433       \textcolor{keywordtype}{use }stiffmat
434       \textcolor{keywordtype}{use }feminittools
435       \textcolor{keywordtype}{use }geom_tools
436       \textcolor{keywordtype}{use }fem_tools
437       \textcolor{keywordtype}{use }re_constitutive
438       \textcolor{keywordtype}{use }linalg
439       \textcolor{keywordtype}{use }solver_interfaces
440       \textcolor{keywordtype}{use }debug_tools     
441       \textcolor{keywordtype}{use }decomp_vars
442       
443       \textcolor{keywordtype}{class}(extsmtx), \textcolor{keywordtype}{intent(in out)} :: mtx
444       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(out)} :: bvect
445       \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: permut
446       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)} :: dt
447       \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: invpermut
448       \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: domain\_id
449       \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{intent(in)} :: extended
450       \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)} :: ierr
451       \textcolor{keywordtype}{integer(kind=ikind)} :: el,j,k,l, proc, ll, limits, nd, ii, pnd, nnd\textcolor{comment}{, pnnd, coarseel, iii, i}
452 \textcolor{comment}{      }\textcolor{keywordtype}{logical}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{save} :: elsolved
453       \textcolor{keywordtype}{type}(integpnt_str) :: quadpnt
454       \textcolor{keywordtype}{real(kind=rkind)} :: value
455 
456       
457       \textcolor{keywordflow}{if} (.not. \textcolor{keyword}{allocated}(elsolved)) \textcolor{keywordflow}{then}
458         \textcolor{keyword}{allocate}(elsolved(elements%kolik))
459 \textcolor{keywordflow}{      end if}
460       
461       
462       \textcolor{keyword}{call }null_problem(mtx, bvect)
463 
464       
465       elsolved = .false. 
466       
467 \textcolor{comment}{!       limits = ubound(stiff\_mat,1)/ubound(pde,1)}
468       
469       proc = 1
470       
471 
472       loop\_nodes: \textcolor{keywordflow}{do} pnd=1, ubound(permut,1)
473 
474                       \textcolor{keywordflow}{if} (permut(pnd) == 0) \textcolor{keywordflow}{then}
475                         \textcolor{keywordflow}{EXIT} loop\_nodes
476 \textcolor{keywordflow}{                      end if}
477 
478                       nd = permut(pnd)
479 
480                       nd = pde_common%invpermut(nd)
481 
482 
483                       \textcolor{keywordflow}{do} ii=1,nodes%el2integ(nd)%pos
484 
485                         el = nodes%el2integ(nd)%data(ii)
486 
487                         \textcolor{keywordflow}{if} (.not. elsolved(el)) \textcolor{keywordflow}{then}
488 
489                           quadpnt%type\_pnt = \textcolor{stringliteral}{"ndpt"}
490                           quadpnt%column = 1
491                           quadpnt%ddlocal=.true.
492                           coarseel = ddinfo%elincoarse(el)
493         
494                           
495                           \textcolor{keywordflow}{if} (domain\_id /= ddinfo%coarseinsub(coarseel))\textcolor{comment}{ }\textcolor{keywordflow}{then}
496                             quadpnt%extended = .false.
497                             quadpnt%subdom = ddinfo%coarseinsub(coarseel\textcolor{comment}{)}
498 \textcolor{comment}{                          }\textcolor{keywordflow}{else}
499                             quadpnt%subdom=domain\_id
500                             quadpnt%extended = extended
501 \textcolor{keywordflow}{                          end if}
502 
503                           \textcolor{keywordflow}{do} k = 1, ubound(elements%data,2)
504                           
505                             nnd = elements%data(el,k)
506                             pnnd = pde(proc)%permut(nnd)
507                             
508                            
509                             \textcolor{keywordflow}{if} (pnnd /= 0) \textcolor{keywordflow}{then} 
510                               \textcolor{keywordflow}{if} (domain\_id /= quadpnt%subdom) \textcolor{keywordflow}{then}     \textcolor{comment}{                              }
511 \textcolor{comment}{                                quadpnt%globtime = .false.}
512 \textcolor{comment}{                                quadpnt%time4eval = subdomain(domain\_id)%time}
513 \textcolor{comment}{                                quadpnt%column = 2}
514 \textcolor{comment}{                              }\textcolor{keywordflow}{else}
515                                 quadpnt%globtime = .true.
516 \textcolor{keywordflow}{                              end if}
517 \textcolor{keywordflow}{                            end if}
518                             
519                             quadpnt%order = nnd
520                             elnode_prev(k) = pde(proc)%getval(quadpnt)
521 \textcolor{keywordflow}{                          end do} 
522                           
523                           
524          
525                           
526                           \textcolor{keyword}{call }build_bvect(el, dt, quadpnt\_in=quadpnt)
527 
528                           \textcolor{keyword}{call }build_stiff_np(el, dt, quadpnt\_in=quadpnt\textcolor{comment}{)}
529 \textcolor{comment}{}
530 \textcolor{comment}{                          }\textcolor{keyword}{call }pde_common%time\_integ(el, quadpnt\_in=quadpnt\textcolor{comment}{)}
531 \textcolor{comment}{                               }
532 \textcolor{comment}{                          quadpnt%element = el}
533 \textcolor{comment}{                          quadpnt%column = 2}
534 \textcolor{comment}{                          quadpnt%type\_pnt = }\textcolor{stringliteral}{"gqnd"}
535                           
536                           quadpnt%ddlocal = .true.                        
537                         
538                           stiff_mat = stiff_mat + cap_mat
539                           
540                           \textcolor{keyword}{call }in2global(el,mtx, bvect, invpermut)
541                           
542                           elsolved(el) = .true.
543 \textcolor{keywordflow}{                        end if}
544 \textcolor{keywordflow}{                      end do}
545 
546 \textcolor{keywordflow}{      end do} loop\_nodes
547      
548 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=305pt]{namespaceschwarz__dd2subcyc_af9ae0ba0d8e6b75d61b7849eefcb28df_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd2subcyc_af9ae0ba0d8e6b75d61b7849eefcb28df_icgraph}
\end{center}
\end{figure}


\index{schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}!ndofs\+\_\+solved@{ndofs\+\_\+solved}}
\index{ndofs\+\_\+solved@{ndofs\+\_\+solved}!schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}}
\subsubsection[{ndofs\+\_\+solved()}]{\setlength{\rightskip}{0pt plus 5cm}integer(kind=ikind) function schwarz\+\_\+dd2subcyc\+::ndofs\+\_\+solved (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{namespaceschwarz__dd2subcyc_aea81417100e6d53300534851a29460b4}


counts number of solved subdomains 



Definition at line 407 of file schwarz\+\_\+dd2subcyc.\+f90.



References decomp\+\_\+vars\+::subdomain.


\begin{DoxyCode}
407         \textcolor{keywordtype}{use }typy
408         \textcolor{keywordtype}{use }globals
409         \textcolor{keywordtype}{use }global_objs
410         \textcolor{keywordtype}{use }decomp_vars
411         
412         \textcolor{keywordtype}{integer(kind=ikind)} :: no
413 
414         \textcolor{keywordtype}{integer(kind=ikind)} :: i
415 
416         no = 0
417 
418         \textcolor{keywordflow}{do} i=1, ubound(subdomain,1)
419           \textcolor{keywordflow}{if} (subdomain(i)%solved) \textcolor{keywordflow}{then}
420             no = no + subdomain(i)%ndof
421 \textcolor{keywordflow}{          end if}
422 \textcolor{keywordflow}{        end do}
423 
\end{DoxyCode}
\index{schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}!schwarz\+\_\+subcyc@{schwarz\+\_\+subcyc}}
\index{schwarz\+\_\+subcyc@{schwarz\+\_\+subcyc}!schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}}
\subsubsection[{schwarz\+\_\+subcyc(ierr, itcount, success)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public schwarz\+\_\+dd2subcyc\+::schwarz\+\_\+subcyc (
\begin{DoxyParamCaption}
\item[{integer, intent(out)}]{ierr, }
\item[{integer(kind=ikind), intent(out)}]{itcount, }
\item[{logical, intent(out)}]{success}
\end{DoxyParamCaption}
)}\label{namespaceschwarz__dd2subcyc_a1172bd9a4c93b3862894cf530bff7fea}


solves the problem using Picard method with Schwarz multiplicative domain decomposition reflecting the nonlinear problem 



Definition at line 16 of file schwarz\+\_\+dd2subcyc.\+f90.



References build\+\_\+xvect\+\_\+loc(), combinevals(), corrvct, decomp\+\_\+vars\+::ddcoarse\+\_\+mesh, domains\+\_\+solved(), decomp\+\_\+vars\+::inner\+\_\+criterion, pde\+\_\+objs\+::pde, resvct, decomposer\+::set\+\_\+subdomains(), solve\+\_\+subdomain(), decomp\+\_\+vars\+::subdomain, globals\+::terminal, globals\+::time, globals\+::time\+\_\+step, and debug\+\_\+tools\+::wait().



Referenced by manage\+\_\+pointers\+::set\+\_\+pointers().


\begin{DoxyCode}
16         \textcolor{keywordtype}{use }typy
17         \textcolor{keywordtype}{use }globals
18         \textcolor{keywordtype}{use }global_objs
19         \textcolor{keywordtype}{use }pde_objs
20         \textcolor{keywordtype}{use }feminittools
21         \textcolor{keywordtype}{use }fem_tools
22         \textcolor{keywordtype}{use }linalg
23         \textcolor{keywordtype}{use }debug_tools
24         \textcolor{keywordtype}{use }sparsematrix
25         \textcolor{keywordtype}{use }decomp_vars
26         \textcolor{keywordtype}{use }decomp_tools
27         \textcolor{keywordtype}{use }decomposer
28         \textcolor{keywordtype}{use }postpro
29         \textcolor{keywordtype}{use }femmat
30         \textcolor{keywordtype}{use }core_tools
31         \textcolor{keywordtype}{use }simplelinalg
32         \textcolor{keywordtype}{use }printtools
33         \textcolor{keywordtype}{use }debug_tools
34 
35         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)} :: ierr
36         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(out)} :: itcount
37         \textcolor{keywordtype}{integer(kind=ikind)} ::  fin, pcg\_it, subfin
38         \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{intent(out)} :: success
39         \textcolor{keywordtype}{integer(kind=ikind)} :: i, proc,j, m, l, k, ii, nd
40         \textcolor{keywordtype}{real(kind=rkind)} :: error, loc\_error, res\_error, reps, cumerr
41         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{save} :: coarse2fine
42         \textcolor{keywordtype}{logical} :: dt\_fine, first\_run, picard\_done, reset\_domains
43         \textcolor{keywordtype}{integer} :: ierr\_loc
44         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: radek, radek2, radek3
45         \textcolor{keywordtype}{character(len=128)} :: text
46         \textcolor{keywordtype}{real(4)}, \textcolor{keywordtype}{dimension(2,2)} :: taaray
47         \textcolor{keywordtype}{real(4)}, \textcolor{keywordtype}{dimension(2)} :: rslt
48         \textcolor{keywordtype}{real(kind=rkind)} :: val
49 
50 
51         \textcolor{keyword}{call }etime(taaray(1,:), rslt(1))
52         proc = ubound(pde,1)
53         fin = maxval(pde(proc)%permut(:))
54         itcount = 0
55         inner_criterion = 1e-4
56 
57         \textcolor{comment}{!reset local-local cluster iteration count}
58         ddcoarse_mesh(:)%iter\_count = 4
59         
60         \textcolor{comment}{!the residual vector is not allocated, thus we are at the beginning}
61         \textcolor{keywordflow}{if} (.not. \textcolor{keyword}{allocated}(resvct)) \textcolor{keywordflow}{then}
62           first\_run = .true.
63           \textcolor{keyword}{allocate}(resvct(fin))
64           \textcolor{keyword}{allocate}(corrvct(fin))          
65           \textcolor{keyword}{call }set_subdomains()
66         \textcolor{keywordflow}{else}
67           first\_run = .false.
68 \textcolor{keywordflow}{        end if}
69 
70         subdomain(:)%time\_step = time_step
71         
72         subdomain(1)%time\_step = time_step
73         subdomain(1)%short\_dt = .false.
74         
75         
76         subdomain(:)%timeprev = time
77         subdomain(:)%time = time 
78         
79               
80                 
81         \textcolor{comment}{!reset local subdomain iteration count}
82         subdomain(:)%itcount = 0                
83 
84         \textcolor{comment}{!reset successes on domains}
85         subdomain(:)%solved = .false.
86         
87         picard\_done = .false.
88         
89 
90         \textcolor{keyword}{write}(unit=terminal, fmt=\textcolor{stringliteral}{"(a)"}) \textcolor{stringliteral}{"  "}
91         \textcolor{keyword}{write}(unit=terminal, fmt=\textcolor{stringliteral}{"(a, I4,a)"}) \textcolor{stringliteral}{" Solving"}, ubound(subdomain,1),  \textcolor{stringliteral}{" subdomains .... "}
92         
93         schwarz: \textcolor{keywordflow}{do}
94 
95           subdoms:  \textcolor{keywordflow}{do} i=1, ubound(subdomain,1)
96          
97             \textcolor{keywordflow}{if} (.not. subdomain(i)%solved) \textcolor{keywordflow}{then}    
98               \textcolor{keyword}{call }solve_subdomain(subdomain(i), reps=1e-10)
99 \textcolor{keywordflow}{            end if}
100             
101 \textcolor{keywordflow}{          end do} subdoms
102          
103 
104           
105           \textcolor{keyword}{call }wait()
106           
107           \textcolor{keywordflow}{if} (domains_solved() == ubound(subdomain,1)) \textcolor{keywordflow}{then}
108             \textcolor{keyword}{call }build_xvect_loc()
109             
110             \textcolor{keywordflow}{do} i=1, ubound(subdomain,1)
111               \textcolor{keyword}{call }combinevals(subdomain(i), short=.false.)
112 \textcolor{keywordflow}{            end do}
113             \textcolor{keywordflow}{if} (domains_solved() == ubound(subdomain,1)) \textcolor{keywordflow}{then}
114               \textcolor{keywordflow}{EXIT} schwarz
115 \textcolor{keywordflow}{            end if}
116 \textcolor{keywordflow}{          end if}
117         
118 \textcolor{keywordflow}{        end do} schwarz
119           
120 \textcolor{comment}{!           }
121 \textcolor{comment}{!         call build\_xvect()}
122 \textcolor{comment}{!   }
123 \textcolor{comment}{!           }
124 \textcolor{comment}{!         call progressbar( int(100*ndofs\_solved()/(1.0*ddinfo%ndofs\_tot)))}
125 \textcolor{comment}{!         }
126 \textcolor{comment}{! }
127 \textcolor{comment}{!         if (domains\_solved() == ubound(subdomain,1)) then}
128 \textcolor{comment}{!           call etime(taaray(2,:), rslt(2))}
129 \textcolor{comment}{!           do i=1, ubound(subdomain,1)}
130 \textcolor{comment}{!             if (.not. subdomain(i)%critical .and. subdomain(i)%itcount>1 ) then}
131 \textcolor{comment}{!               reset\_domains = .true.}
132 \textcolor{comment}{!               EXIT}
133 \textcolor{comment}{!             else}
134 \textcolor{comment}{!               reset\_domains = .false.}
135 \textcolor{comment}{!             end if}
136 \textcolor{comment}{!           end do}
137 \textcolor{comment}{!          }
138 \textcolor{comment}{!           call printtime("Time spent on iterations: ", rslt(2)-rslt(1))}
139 \textcolor{comment}{!           }
140 \textcolor{comment}{!           if (reset\_domains) then}
141 \textcolor{comment}{!             call build\_xvect()}
142 \textcolor{comment}{!             call set\_subdomains()}
143 \textcolor{comment}{!           end if}
144 \textcolor{comment}{!           }
145 \textcolor{comment}{!           }
146 \textcolor{comment}{!           success = .TRUE.}
147 \textcolor{comment}{!           ierr = 0}
148 \textcolor{comment}{!           write(unit=file\_ddinfo, fmt=*) time, itcount, "|", subdomain(:)%ndof}
149 \textcolor{comment}{!           call flush(file\_ddinfo)}
150 \textcolor{comment}{!           EXIT picard\_loop}
151 \textcolor{comment}{!         end if}
152 \textcolor{comment}{! }
153 \textcolor{comment}{!         if (itcount > max\_itcount) then}
154 \textcolor{comment}{!           call set\_subdomains()}
155 \textcolor{comment}{!           success = .FALSE.}
156 \textcolor{comment}{!           ierr = 1}
157 \textcolor{comment}{!           RETURN}
158 \textcolor{comment}{!         end if}
159 \textcolor{comment}{! }
160 \textcolor{comment}{!         end do picard\_loop}
161 \textcolor{comment}{! }
162 \textcolor{comment}{! }
163 \textcolor{comment}{! }
164 \textcolor{comment}{!         do proc=1, ubound(pde,1)}
165 \textcolor{comment}{!         do i=1, ubound(subdomain,1)}
166 \textcolor{comment}{!           dt\_fine = pde(proc)%dt\_check()}
167 \textcolor{comment}{!         end do}
168 \textcolor{comment}{!         end do}
169 \textcolor{comment}{!         }
170 \textcolor{comment}{!         if (.not.(dt\_fine)) then}
171 \textcolor{comment}{!           ierr = 2}
172 \textcolor{comment}{!           success = .false.}
173 \textcolor{comment}{!           RETURN}
174 \textcolor{comment}{!         else}
175 \textcolor{comment}{!           ierr = 0}
176 \textcolor{comment}{!           call results\_extractor()}
177 \textcolor{comment}{!           do i=1, ubound(subdomain,1)}
178 \textcolor{comment}{!           subdomain(i)%xvect(:,1) = subdomain(i)%xvect(:,3)}
179 \textcolor{comment}{!         end do}
180 \textcolor{comment}{!         end if}
181 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd2subcyc_a1172bd9a4c93b3862894cf530bff7fea_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd2subcyc_a1172bd9a4c93b3862894cf530bff7fea_icgraph}
\end{center}
\end{figure}


\index{schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}!search\+\_\+error\+\_\+cluster@{search\+\_\+error\+\_\+cluster}}
\index{search\+\_\+error\+\_\+cluster@{search\+\_\+error\+\_\+cluster}!schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}}
\subsubsection[{search\+\_\+error\+\_\+cluster(sub, itcount)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, private schwarz\+\_\+dd2subcyc\+::search\+\_\+error\+\_\+cluster (
\begin{DoxyParamCaption}
\item[{type({\bf subdomain\+\_\+str}), intent(in)}]{sub, }
\item[{integer(kind=ikind), intent(in)}]{itcount}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespaceschwarz__dd2subcyc_a4fb6145e46c22c5cfe35a2773550fc46}


Definition at line 344 of file schwarz\+\_\+dd2subcyc.\+f90.



References decomp\+\_\+vars\+::ddcoarse\+\_\+mesh, globals\+::elements, globals\+::iter\+\_\+criterion, and pde\+\_\+objs\+::pde.


\begin{DoxyCode}
344         \textcolor{keywordtype}{use }typy
345         \textcolor{keywordtype}{use }globals
346         \textcolor{keywordtype}{use }global_objs
347         \textcolor{keywordtype}{use }decomp_vars
348         \textcolor{keywordtype}{use }debug_tools
349         \textcolor{keywordtype}{use }pde_objs
350 
351         \textcolor{keywordtype}{type}(subdomain_str), \textcolor{keywordtype}{intent(in)} :: sub
352         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: itcount
353 
354         \textcolor{keywordtype}{integer(kind=ikind)} :: i, j, ii, jj, el, nd, xpos, xpos\_loc
355         \textcolor{keywordtype}{real(kind=rkind)} :: loc\_error
356         
357 
358         \textcolor{keywordflow}{do} i=1, ubound(sub%coarse\_el,1)
359           j = sub%coarse\_el(i)
360           loc\_error = 0
361           \textcolor{keywordflow}{do} ii=1, ubound(ddcoarse_mesh(j)%elements,1)
362             el = ddcoarse_mesh(j)%elements(ii)
363             \textcolor{keywordflow}{do} jj = 1, ubound(elements%data,2)
364               nd = elements%data(el,jj)
365               xpos = pde(1)%permut(nd)
366               \textcolor{keywordflow}{if} (xpos > 0) \textcolor{keywordflow}{then}
367                 xpos\_loc = sub%invpermut(xpos)
368                 loc\_error = max(loc\_error, abs(sub%xvect(xpos\_loc,3)-sub%xvect(xpos\_loc,2)) )
369 \textcolor{keywordflow}{              end if}
370 \textcolor{keywordflow}{            end do}
371 \textcolor{keywordflow}{          end do}
372           \textcolor{keywordflow}{if} (loc\_error > iter_criterion) \textcolor{keywordflow}{then}
373             ddcoarse_mesh(j)%iter\_count = ddcoarse_mesh(j)%iter\_count + 1
374 \textcolor{keywordflow}{          end if}
375 \textcolor{keywordflow}{        end do}
376   
377 
\end{DoxyCode}
\index{schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}!set\+\_\+solved@{set\+\_\+solved}}
\index{set\+\_\+solved@{set\+\_\+solved}!schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}}
\subsubsection[{set\+\_\+solved(sub, mode)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, private schwarz\+\_\+dd2subcyc\+::set\+\_\+solved (
\begin{DoxyParamCaption}
\item[{type({\bf subdomain\+\_\+str}), intent(inout)}]{sub, }
\item[{integer, intent(in)}]{mode}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespaceschwarz__dd2subcyc_af41fedc51000d37271c12eff94cdbe71}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mode} & 0 -\/ the short time step is solved 1 -\/ the long time step is solved 2 -\/ it\textquotesingle{}s done burning the bridges, no way back -\/1 -\/ status solved is switched to unsolved \\
\hline
\end{DoxyParams}


Definition at line 553 of file schwarz\+\_\+dd2subcyc.\+f90.



Referenced by combinevals(), and solve\+\_\+subdomain().


\begin{DoxyCode}
553       \textcolor{keywordtype}{use }decomp_vars
554       
555       \textcolor{keywordtype}{type}(subdomain_str), \textcolor{keywordtype}{intent(in out)} :: sub
560       \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: mode
561       
562       \textcolor{keywordflow}{select case}(mode)
563         \textcolor{keywordflow}{case}(0)
564           sub%xvect(1,:) = sub%xvect(3,:)
565         \textcolor{keywordflow}{case}(1)
566           sub%xvect(1,:) = sub%xvect(3,:)
567           sub%solved = .true.
568         \textcolor{keywordflow}{case}(2)
569           sub%xvect(1,:) = sub%xvect(3,:)
570           sub%xvect(2,:) = sub%xvect(3,:)
571           sub%xvect(4,:) = sub%xvect(3,:)
572           sub%solved = .true.
573         \textcolor{keywordflow}{case}(-1)
574           sub%solved = .false.
575           sub%xvect(1,:) = sub%xvect(4,:)
576 \textcolor{keywordflow}{        case default}
577           print *, \textcolor{stringliteral}{"code bug, incorrect mode value, exited from schwarz\_dd2subcyc::set\_solved"}
578           error stop
579 \textcolor{keywordflow}{      end select}
580     
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd2subcyc_af41fedc51000d37271c12eff94cdbe71_icgraph}
\end{center}
\end{figure}


\index{schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}!solve\+\_\+subdomain@{solve\+\_\+subdomain}}
\index{solve\+\_\+subdomain@{solve\+\_\+subdomain}!schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}}
\subsubsection[{solve\+\_\+subdomain(sub, reps)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine schwarz\+\_\+dd2subcyc\+::solve\+\_\+subdomain (
\begin{DoxyParamCaption}
\item[{class({\bf subdomain\+\_\+str}), intent(inout)}]{sub, }
\item[{real(kind=rkind), intent(in)}]{reps}
\end{DoxyParamCaption}
)}\label{namespaceschwarz__dd2subcyc_a332b28ddec42b6b80a856199f23d4355}


Definition at line 185 of file schwarz\+\_\+dd2subcyc.\+f90.



References corrvct, decomp\+\_\+vars\+::ddinfo, simplelinalg\+::diag\+\_\+precond(), decomp\+\_\+tools\+::getres\+\_\+loc(), locmat\+\_\+assembler(), pde\+\_\+objs\+::pde\+\_\+common, resvct, set\+\_\+solved(), pde\+\_\+objs\+::solve\+\_\+matrix, and decomp\+\_\+vars\+::subdomain.



Referenced by schwarz\+\_\+subcyc().


\begin{DoxyCode}
185         \textcolor{keywordtype}{use }typy
186         \textcolor{keywordtype}{use }decomp_vars
187         \textcolor{keywordtype}{use }decomp_tools
188         \textcolor{keywordtype}{use }sparsematrix
189         \textcolor{keywordtype}{use }simplelinalg
190         \textcolor{keywordtype}{use }pde_objs
191         \textcolor{keywordtype}{use }debug_tools
192         
193         \textcolor{keywordtype}{class}(subdomain_str), \textcolor{keywordtype}{intent(in out)} :: sub
194         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)} :: reps
195         
196         \textcolor{keywordtype}{integer(kind=ikind)} :: subfin, i, s, nd, pnd, extdom, j, extpnd
197         \textcolor{keywordtype}{real(kind=rkind)} :: error       
198         \textcolor{keywordtype}{integer} :: ierr
199         
200         sub%itcount = 0
201 
202 
203         sub%itcount = sub%itcount + 1
204 
205 
206         \textcolor{keyword}{call }locmat_assembler(mtx=sub%matrix, bvect=sub%bvect, &
207               permut=sub%permut, dt=sub%time\_step, invpermut=sub%invpermut, domain\_id=sub%order, extended=.
      false., &
208               ierr=ierr)
209 
210         \textcolor{keyword}{call }locmat_assembler(mtx=sub%extmatrix, bvect=sub%extbvect, &
211               permut=sub%extpermut, dt=sub%time\_step, invpermut=sub%extinvpermut, &
212               domain\_id=sub%order, extended=.true.,ierr=ierr)
213 
214 
215         \textcolor{keyword}{call }getres_loc(sub)
216 
217         resvct = 0
218         
219         subfin = sub%ndof
220               
221         resvct(sub%permut(1:sub%ndof)) = sub%resvct%main
222               
223         resvct(sub%extpermut(1:sub%extndof)) = sub%resvct%ext
224         
225         corrvct(1:subfin) = 0.0
226         
227         \textcolor{keyword}{call }diag_precond(a=sub%matrix, prmt=sub%permut,  mode=1)
228                             
229         \textcolor{keyword}{call }solve_matrix(sub%matrix, resvct, corrvct(1:subfin), ilev1=0, itmax1=subfin, reps1=reps)
230               
231         \textcolor{keyword}{call }diag_precond(a=sub%matrix, x=corrvct(1:subfin), mode=-1)
232                       
233         error = maxval(abs(corrvct(1:subfin)))
234         
235         sub%xvect(:,2) = sub%xvect(:,2) + corrvct(1:subfin)
236           
237         sub%xvect(:,3) = sub%xvect(:,2)
238         
239         \textcolor{keywordflow}{do} i=1, ubound(sub%xvect,1)
240           pnd = sub%permut(i)
241           nd = pde_common%invpermut(pnd)
242           \textcolor{keywordflow}{do} j=1, ddinfo%nodesinextsub(nd)%pos
243             extdom = ddinfo%nodesinextsub(nd)%data(j)
244             extpnd = subdomain(extdom)%extinvpermut(pnd)
245             \textcolor{keywordflow}{if} (extpnd /= 0) \textcolor{keywordflow}{then}
246               subdomain(extdom)%extxvect(extpnd,2:3) = (subdomain(extdom)%extxvect(extpnd,2:3) + sub%xvect(
      i,2:3))/2.0\_rkind
247 \textcolor{keywordflow}{            end if}
248 \textcolor{keywordflow}{          end do}
249 \textcolor{keywordflow}{        end do}
250         
251         
252         \textcolor{keywordflow}{if} (error < iter_criterion) \textcolor{keywordflow}{then}
253           sub%time = sub%time + sub%time\_step
254           \textcolor{keywordflow}{if} (abs(sub%time - time - time_step) < 100*epsilon(time)) \textcolor{keywordflow}{then}
255             \textcolor{keyword}{call }set_solved(sub, mode=1)
256           \textcolor{keywordflow}{else}
257             \textcolor{keyword}{call }set_solved(sub, mode=0)
258 \textcolor{keywordflow}{          end if}
259 \textcolor{keywordflow}{        end if}
260         
261 
262         
263       
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd2subcyc_a332b28ddec42b6b80a856199f23d4355_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd2subcyc_a332b28ddec42b6b80a856199f23d4355_icgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\index{schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}!corrvct@{corrvct}}
\index{corrvct@{corrvct}!schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}}
\subsubsection[{corrvct}]{\setlength{\rightskip}{0pt plus 5cm}real(kind=rkind), dimension(\+:), allocatable, save, private schwarz\+\_\+dd2subcyc\+::corrvct\hspace{0.3cm}{\ttfamily [private]}}\label{namespaceschwarz__dd2subcyc_a9a58796fa4747ef6fa92ddeaa1a4aa5b}


Definition at line 10 of file schwarz\+\_\+dd2subcyc.\+f90.



Referenced by schwarz\+\_\+subcyc(), and solve\+\_\+subdomain().

\index{schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}!resvct@{resvct}}
\index{resvct@{resvct}!schwarz\+\_\+dd2subcyc@{schwarz\+\_\+dd2subcyc}}
\subsubsection[{resvct}]{\setlength{\rightskip}{0pt plus 5cm}real(kind=rkind), dimension(\+:), allocatable, save, private schwarz\+\_\+dd2subcyc\+::resvct\hspace{0.3cm}{\ttfamily [private]}}\label{namespaceschwarz__dd2subcyc_a12a17ec62996317aeff74f4908b6bf06}


Definition at line 10 of file schwarz\+\_\+dd2subcyc.\+f90.



Referenced by schwarz\+\_\+subcyc(), and solve\+\_\+subdomain().


\begin{DoxyCode}
10     \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{private}, \textcolor{keywordtype}{save} :: resvct, 
      corrvct
\end{DoxyCode}
