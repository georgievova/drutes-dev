\section{schwarz\+\_\+dd\+\_\+time\+\_\+test Module Reference}
\label{namespaceschwarz__dd__time__test}\index{schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}}
\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine, public {\bf schwarz\+\_\+picard\+\_\+tt} (ierr, itcount, success)
\begin{DoxyCompactList}\small\item\em solves the problem using Picard method with Schwarz multiplicative domain decomposition reflecting the nonlinear problem \end{DoxyCompactList}\item 
integer(kind=ikind) function, private {\bf vyreseno} ()
\item 
subroutine, private {\bf schwarzloc} (ierr, itcount, success)
\begin{DoxyCompactList}\small\item\em solves the problem using Picard method with Schwarz multiplicative domain decomposition reflecting the nonlinear problem \end{DoxyCompactList}\item 
subroutine, private {\bf build\+\_\+xvect} ()
\item 
subroutine, private {\bf search\+\_\+error\+\_\+cluster\+\_\+tt} (sub, itcount)
\item 
subroutine, private {\bf results\+\_\+extractor} ()
\item 
integer(kind=ikind) function, private {\bf domains\+\_\+solved} ()
\begin{DoxyCompactList}\small\item\em counts number of solved subdomains \end{DoxyCompactList}\item 
integer(kind=ikind) function {\bf ndofs\+\_\+solved} ()
\begin{DoxyCompactList}\small\item\em counts number of solved subdomains \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function/\+Subroutine Documentation}
\index{schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}!build\+\_\+xvect@{build\+\_\+xvect}}
\index{build\+\_\+xvect@{build\+\_\+xvect}!schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}}
\subsubsection[{build\+\_\+xvect()}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, private schwarz\+\_\+dd\+\_\+time\+\_\+test\+::build\+\_\+xvect (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespaceschwarz__dd__time__test_a1bcd2b4474e16444beb716dbfa0f8fc6}


Definition at line 385 of file schwarz\+\_\+dd-\/time-\/test.\+f90.



References pde\+\_\+objs\+::pde\+\_\+common, decomp\+\_\+vars\+::prolong\+\_\+mtx, and decomp\+\_\+vars\+::subdomain.



Referenced by schwarzloc().


\begin{DoxyCode}
385         \textcolor{keywordtype}{use }typy
386         \textcolor{keywordtype}{use }globals
387         \textcolor{keywordtype}{use }global_objs
388         \textcolor{keywordtype}{use }pde_objs
389         \textcolor{keywordtype}{use }decomp_vars
390         \textcolor{keywordtype}{use }debug_tools
391         
392         \textcolor{keywordtype}{integer(kind=ikind)} :: i, glob, loc, subcrit
393 
394 
395         pde_common%xvect(:,2:3) = 0.0\_rkind
396         
397         
398         \textcolor{keywordflow}{do} i = 1, ubound(subdomain,1)
399           \textcolor{keywordflow}{do} loc = 1, subdomain(i)%ndof
400             glob =  subdomain(i)%permut(loc)
401             pde_common%xvect(glob,2:3) = pde_common%xvect(glob,2:3) + subdomain(i)%xvect(loc,2:3)*
      prolong_mtx%get(glob,i)
402 \textcolor{keywordflow}{          end do}
403 \textcolor{keywordflow}{        end do}
404         
405 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd__time__test_a1bcd2b4474e16444beb716dbfa0f8fc6_icgraph}
\end{center}
\end{figure}


\index{schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}!domains\+\_\+solved@{domains\+\_\+solved}}
\index{domains\+\_\+solved@{domains\+\_\+solved}!schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}}
\subsubsection[{domains\+\_\+solved()}]{\setlength{\rightskip}{0pt plus 5cm}integer(kind=ikind) function, private schwarz\+\_\+dd\+\_\+time\+\_\+test\+::domains\+\_\+solved (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespaceschwarz__dd__time__test_a2e1aaa197d03df66e433a4ef06780620}


counts number of solved subdomains 



Definition at line 479 of file schwarz\+\_\+dd-\/time-\/test.\+f90.



References decomp\+\_\+vars\+::subdomain.



Referenced by schwarzloc().


\begin{DoxyCode}
479         \textcolor{keywordtype}{use }typy
480         \textcolor{keywordtype}{use }globals
481         \textcolor{keywordtype}{use }global_objs
482         \textcolor{keywordtype}{use }decomp_vars
483         
484         \textcolor{keywordtype}{integer(kind=ikind)} :: no
485 
486         \textcolor{keywordtype}{integer(kind=ikind)} :: i
487 
488         no = 0
489 
490         \textcolor{keywordflow}{do} i=1, ubound(subdomain,1)
491           \textcolor{keywordflow}{if} (subdomain(i)%solved) \textcolor{keywordflow}{then}
492             no = no + 1
493 \textcolor{keywordflow}{          end if}
494 \textcolor{keywordflow}{        end do}
495 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd__time__test_a2e1aaa197d03df66e433a4ef06780620_icgraph}
\end{center}
\end{figure}


\index{schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}!ndofs\+\_\+solved@{ndofs\+\_\+solved}}
\index{ndofs\+\_\+solved@{ndofs\+\_\+solved}!schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}}
\subsubsection[{ndofs\+\_\+solved()}]{\setlength{\rightskip}{0pt plus 5cm}integer(kind=ikind) function schwarz\+\_\+dd\+\_\+time\+\_\+test\+::ndofs\+\_\+solved (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{namespaceschwarz__dd__time__test_a43f903666f3ea6580be2b268ec684c99}


counts number of solved subdomains 



Definition at line 500 of file schwarz\+\_\+dd-\/time-\/test.\+f90.



References decomp\+\_\+vars\+::subdomain.



Referenced by schwarzloc().


\begin{DoxyCode}
500         \textcolor{keywordtype}{use }typy
501         \textcolor{keywordtype}{use }globals
502         \textcolor{keywordtype}{use }global_objs
503         \textcolor{keywordtype}{use }decomp_vars
504         
505         \textcolor{keywordtype}{integer(kind=ikind)} :: no
506 
507         \textcolor{keywordtype}{integer(kind=ikind)} :: i
508 
509         no = 0
510 
511         \textcolor{keywordflow}{do} i=1, ubound(subdomain,1)
512           \textcolor{keywordflow}{if} (subdomain(i)%solved) \textcolor{keywordflow}{then}
513             no = no + subdomain(i)%ndof
514 \textcolor{keywordflow}{          end if}
515 \textcolor{keywordflow}{        end do}
516 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd__time__test_a43f903666f3ea6580be2b268ec684c99_icgraph}
\end{center}
\end{figure}


\index{schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}!results\+\_\+extractor@{results\+\_\+extractor}}
\index{results\+\_\+extractor@{results\+\_\+extractor}!schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}}
\subsubsection[{results\+\_\+extractor()}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, private schwarz\+\_\+dd\+\_\+time\+\_\+test\+::results\+\_\+extractor (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespaceschwarz__dd__time__test_a17aa5ab15ef249e3df241cb890ed955d}


Definition at line 450 of file schwarz\+\_\+dd-\/time-\/test.\+f90.



References globals\+::nodes, pde\+\_\+objs\+::pde, and pde\+\_\+objs\+::pde\+\_\+common.



Referenced by schwarzloc().


\begin{DoxyCode}
450           \textcolor{keywordtype}{use }typy
451           \textcolor{keywordtype}{use }globals
452           \textcolor{keywordtype}{use }global_objs
453           \textcolor{keywordtype}{use }debug_tools
454           \textcolor{keywordtype}{use }pde_objs
455 
456           \textcolor{keywordtype}{integer(kind=ikind)} :: i, j, proc
457 
458 
459           \textcolor{keywordflow}{do} proc=1, ubound(pde,1)
460               \textcolor{keywordflow}{do} i=1, nodes%kolik
461                   \textcolor{keywordflow}{if} (pde(proc)%permut(i) > 0) \textcolor{keywordflow}{then}
462                       pde(proc)%solution(i) = pde_common%xvect(pde(proc)%permut(i),3)
463                   \textcolor{keywordflow}{else}
464                       j = nodes%edge(i)
465                       pde(proc)%solution(i) = pde(proc)%bc(j)%value
466 \textcolor{keywordflow}{                  end if}
467 \textcolor{keywordflow}{              end do}
468 \textcolor{keywordflow}{          end do}
469 
470 
471           pde_common%xvect(:,1) = pde_common%xvect(:,3)
472           pde_common%xvect(:,2) = pde_common%xvect(:,3)
473 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd__time__test_a17aa5ab15ef249e3df241cb890ed955d_icgraph}
\end{center}
\end{figure}


\index{schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}!schwarz\+\_\+picard\+\_\+tt@{schwarz\+\_\+picard\+\_\+tt}}
\index{schwarz\+\_\+picard\+\_\+tt@{schwarz\+\_\+picard\+\_\+tt}!schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}}
\subsubsection[{schwarz\+\_\+picard\+\_\+tt(ierr, itcount, success)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public schwarz\+\_\+dd\+\_\+time\+\_\+test\+::schwarz\+\_\+picard\+\_\+tt (
\begin{DoxyParamCaption}
\item[{integer, intent(out)}]{ierr, }
\item[{integer(kind=ikind), intent(out)}]{itcount, }
\item[{logical, intent(out)}]{success}
\end{DoxyParamCaption}
)}\label{namespaceschwarz__dd__time__test_a28474cc01fb4558d0a875080f5a52724}


solves the problem using Picard method with Schwarz multiplicative domain decomposition reflecting the nonlinear problem 



Definition at line 14 of file schwarz\+\_\+dd-\/time-\/test.\+f90.



References decomp\+\_\+vars\+::coarse\+\_\+elements, decomp\+\_\+vars\+::ddcoarse\+\_\+mesh, globals\+::dtmax, globals\+::dtmin, decomp\+\_\+vars\+::file\+\_\+dt, globals\+::iter\+\_\+criterion, pde\+\_\+objs\+::pde, pde\+\_\+objs\+::pde\+\_\+common, schwarzloc(), decomposer\+::set\+\_\+subdomains(), decomp\+\_\+vars\+::subdomain, globals\+::terminal, globals\+::time\+\_\+step, and vyreseno().


\begin{DoxyCode}
14         \textcolor{keywordtype}{use }typy
15         \textcolor{keywordtype}{use }globals
16         \textcolor{keywordtype}{use }global_objs
17         \textcolor{keywordtype}{use }pde_objs
18         \textcolor{keywordtype}{use }feminittools
19         \textcolor{keywordtype}{use }fem_tools
20         \textcolor{keywordtype}{use }linalg
21         \textcolor{keywordtype}{use }debug_tools
22         \textcolor{keywordtype}{use }sparsematrix
23         \textcolor{keywordtype}{use }decomp_vars
24         \textcolor{keywordtype}{use }decomp_tools
25         \textcolor{keywordtype}{use }decomposer
26         \textcolor{keywordtype}{use }postpro
27         \textcolor{keywordtype}{use }femmat
28         \textcolor{keywordtype}{use }core_tools
29         \textcolor{keywordtype}{use }simplelinalg
30         \textcolor{keywordtype}{use }printtools
31         \textcolor{keywordtype}{use }debug_tools
32         \textcolor{keywordtype}{use }schwarz_dd
33 
34         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)} :: ierr
35         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(out)} :: itcount
36         \textcolor{keywordtype}{integer(kind=ikind)} ::  fin, pcg\_it, subfin, itcountloc
37         \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{intent(out)} :: success
38         \textcolor{keywordtype}{integer(kind=ikind)} :: i, proc,j, m, l, k, ii
39         \textcolor{keywordtype}{real(kind=rkind)} :: error, loc\_error, res\_error, reps, time\_step\_tmp, itmp
40         \textcolor{keywordtype}{logical} :: dt\_fine, first\_run, picard\_done
41         \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{save} :: reset\_domains = .true.
42         \textcolor{keywordtype}{integer} :: ierr\_loc
43         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{save} :: resvct, corrvct
44         \textcolor{keywordtype}{character(len=128)} :: text
45         \textcolor{keywordtype}{real(4)}, \textcolor{keywordtype}{dimension(2,2)} :: taaray
46         \textcolor{keywordtype}{real(4)}, \textcolor{keywordtype}{dimension(2)} :: rslt
47         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:,:,:)}, \textcolor{keywordtype}{allocatable} :: tempvect
48         \textcolor{keywordtype}{logical} :: dt\_check
49         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: iters 
50 
51 \textcolor{comment}{!       }
52         \textcolor{keyword}{allocate}(iters(coarse_elements%kolik))
53 
54         \textcolor{keyword}{allocate}(tempvect(2, ubound(pde_common%xvect,1), 4))
55         
56         \textcolor{keywordflow}{if} (reset\_domains) \textcolor{keyword}{call }set_subdomains()
57                 
58 
59         tempvect(1,:,:) = pde_common%xvect
60                 
61         time\_step\_tmp = time_step
62         
63         time_step = 50*dtmax
64         
65         \textcolor{comment}{!reset local-local cluster iteration count}
66         ddcoarse_mesh(:)%iter\_count = 1
67         
68         \textcolor{keyword}{call }schwarzloc(ierr, itcount, success)
69         
70         \textcolor{keywordflow}{do} i=1, coarse_elements%kolik
71           iters(i) = ddcoarse_mesh(i)%iter\_count
72 \textcolor{keywordflow}{        end do}
73         
74         print *, \textcolor{stringliteral}{"max iter"},  maxval(ddcoarse_mesh(:)%iter\_count), itcount, maxval(iters)
75         
76         \textcolor{keyword}{call }flush(terminal)
77         
78         itcountloc = itcount
79         
80         subdomain(:)%finish = .false.
81         
82 
83         
84 \textcolor{comment}{!       print *, ddcoarse\_mesh(:)%iter\_count}
85         
86           \textcolor{keywordflow}{if}(ierr==-10) \textcolor{keywordflow}{then}
87             reset\_domains = .true.
88           \textcolor{keywordflow}{else}
89             reset\_domains = .false.
90 \textcolor{keywordflow}{          end if}
91           
92          \textcolor{keywordflow}{if} (ierr == 1) \textcolor{keywordflow}{then}
93           success = .false.
94           \textcolor{keywordflow}{return}
95 \textcolor{keywordflow}{         end if}
96         
97 \textcolor{comment}{!         print *, reset\_domains, itcount, ierr ; stop}
98         
99         itmp = iter_criterion
100          
101         iter_criterion = 5.5
102         
103         tempvect(2,:,:) = pde_common%xvect
104         
105         subdomain(:)%tmpval = time_step
106 
107         timecheck: \textcolor{keywordflow}{do}
108         
109           pde_common%xvect = tempvect(1,:,:)
110           
111           time_step = max(0.5*time_step, 0.95*dtmin)
112           
113           
114           \textcolor{keyword}{call }flush(file_dt)
115           
116           
117            
118           \textcolor{keyword}{call }schwarzloc(ierr, itcount, success)
119 
120           
121 \textcolor{comment}{!         if (success) then}
122             \textcolor{keywordflow}{do} i=1, ubound(subdomain,1)
123               \textcolor{keywordflow}{if} (pde(1)%dt\_check(subdomain(i)%xvect, subdomain(i)%permut) .or. 
      time_step < dtmin) \textcolor{keywordflow}{then}
124                 \textcolor{keywordflow}{if} (.not. subdomain(i)%finish) \textcolor{keywordflow}{then}
125                   subdomain(i)%tmpval = time_step
126                   subdomain(i)%finish = .true.
127                   print *, i, time_step
128 \textcolor{keywordflow}{                end if}
129               \textcolor{keywordflow}{else}
130                 print *, \textcolor{stringliteral}{"time step"}, time_step
131 \textcolor{keywordflow}{              end if}
132 \textcolor{keywordflow}{            end do}
133 \textcolor{comment}{!         end ifmake}
134 
135           
136           \textcolor{keywordflow}{if} (vyreseno() == ubound(subdomain,1)) \textcolor{keywordflow}{then}
137                   \textcolor{keyword}{write}(unit=file_dt, fmt=*) subdomain(:)%tmpval
138 
139             time_step = time\_step\_tmp
140             pde_common%xvect = tempvect(2,:,:)
141             iter_criterion = itmp
142             ierr = 0
143             itcount = itcountloc
144             \textcolor{keywordflow}{EXIT} timecheck
145 \textcolor{keywordflow}{          end if}
146 \textcolor{keywordflow}{        end do} timecheck
147         
148 
149         \textcolor{keywordflow}{do} i=1, coarse_elements%kolik
150           ddcoarse_mesh(i)%iter\_count = iters(i)
151 \textcolor{keywordflow}{        end do}
152         
153         print *, \textcolor{stringliteral}{"max iter"},  maxval(ddcoarse_mesh(:)%iter\_count), itcount, maxval(iters), 
      iter_criterion
154 
155 
156             
157            
158 
159 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd__time__test_a28474cc01fb4558d0a875080f5a52724_cgraph}
\end{center}
\end{figure}


\index{schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}!schwarzloc@{schwarzloc}}
\index{schwarzloc@{schwarzloc}!schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}}
\subsubsection[{schwarzloc(ierr, itcount, success)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, private schwarz\+\_\+dd\+\_\+time\+\_\+test\+::schwarzloc (
\begin{DoxyParamCaption}
\item[{integer, intent(out)}]{ierr, }
\item[{integer(kind=ikind), intent(out)}]{itcount, }
\item[{logical, intent(out)}]{success}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespaceschwarz__dd__time__test_ac055f89162bd3f14323b125cdd0253a6}


solves the problem using Picard method with Schwarz multiplicative domain decomposition reflecting the nonlinear problem 



Definition at line 181 of file schwarz\+\_\+dd-\/time-\/test.\+f90.



References build\+\_\+xvect(), decomp\+\_\+vars\+::ddinfo, simplelinalg\+::diag\+\_\+precond(), domains\+\_\+solved(), decomp\+\_\+vars\+::file\+\_\+ddinfo, decomp\+\_\+tools\+::get\+\_\+residual(), decomp\+\_\+vars\+::inner\+\_\+criterion, globals\+::iter\+\_\+criterion, schwarz\+\_\+dd\+::locmat\+\_\+assembler(), globals\+::max\+\_\+itcount, ndofs\+\_\+solved(), pde\+\_\+objs\+::pde, pde\+\_\+objs\+::pde\+\_\+common, printtools\+::printtime(), printtools\+::progressbar(), results\+\_\+extractor(), search\+\_\+error\+\_\+cluster\+\_\+tt(), pde\+\_\+objs\+::solve\+\_\+matrix, decomp\+\_\+vars\+::subdomain, globals\+::terminal, globals\+::time, and globals\+::time\+\_\+step.



Referenced by schwarz\+\_\+picard\+\_\+tt().


\begin{DoxyCode}
181         \textcolor{keywordtype}{use }typy
182         \textcolor{keywordtype}{use }globals
183         \textcolor{keywordtype}{use }global_objs
184         \textcolor{keywordtype}{use }pde_objs
185         \textcolor{keywordtype}{use }feminittools
186         \textcolor{keywordtype}{use }fem_tools
187         \textcolor{keywordtype}{use }linalg
188         \textcolor{keywordtype}{use }debug_tools
189         \textcolor{keywordtype}{use }sparsematrix
190         \textcolor{keywordtype}{use }decomp_vars
191         \textcolor{keywordtype}{use }decomp_tools
192         \textcolor{keywordtype}{use }decomposer
193         \textcolor{keywordtype}{use }postpro
194         \textcolor{keywordtype}{use }femmat
195         \textcolor{keywordtype}{use }core_tools
196         \textcolor{keywordtype}{use }simplelinalg
197         \textcolor{keywordtype}{use }printtools
198         \textcolor{keywordtype}{use }debug_tools
199         \textcolor{keywordtype}{use }schwarz_dd
200 
201         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)} :: ierr
202         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(out)} :: itcount
203         \textcolor{keywordtype}{integer(kind=ikind)} ::  fin, pcg\_it, subfin
204         \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{intent(out)} :: success
205         \textcolor{keywordtype}{integer(kind=ikind)} :: i, proc,j, m, l, k, ii
206         \textcolor{keywordtype}{real(kind=rkind)} :: error, loc\_error, res\_error, reps
207         \textcolor{keywordtype}{logical} :: dt\_fine, first\_run, picard\_done, reset\_domains
208         \textcolor{keywordtype}{integer} :: ierr\_loc
209         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{save} :: resvct, corrvct
210         \textcolor{keywordtype}{character(len=128)} :: text
211         \textcolor{keywordtype}{real(4)}, \textcolor{keywordtype}{dimension(2,2)} :: taaray
212         \textcolor{keywordtype}{real(4)}, \textcolor{keywordtype}{dimension(2)} :: rslt
213 
214         
215         \textcolor{keyword}{call }etime(taaray(1,:), rslt(1))
216         proc = ubound(pde,1)
217         fin = maxval(pde(proc)%permut(:))
218         itcount = 0
219         inner_criterion = 1e-2
220 
221         
222         \textcolor{comment}{!the residual vector is not allocated, thus we are at the beginning}
223         \textcolor{keywordflow}{if} (.not. \textcolor{keyword}{allocated}(resvct)) \textcolor{keywordflow}{then}
224           first\_run = .true.
225           \textcolor{keyword}{allocate}(resvct(fin))
226           \textcolor{keyword}{allocate}(corrvct(fin))          
227 \textcolor{comment}{!           call set\_subdomains()}
228           subdomain(:)%time = 0
229         \textcolor{keywordflow}{else}
230           first\_run = .false.
231 \textcolor{keywordflow}{        end if}
232         
233         
234         
235 
236         subdomain(:)%time\_step = time_step
237 
238                 
239         \textcolor{comment}{!reset local subdomain iteration count}
240         subdomain(:)%itcount = 0                
241 
242         \textcolor{comment}{!reset successes on domains}
243         subdomain(:)%solved = .false.
244         
245         picard\_done = .false.
246         
247 
248         \textcolor{keyword}{write}(unit=terminal, fmt=\textcolor{stringliteral}{"(a)"}) \textcolor{stringliteral}{"  "}
249         \textcolor{keyword}{write}(unit=terminal, fmt=\textcolor{stringliteral}{"(a, I4,a)"}) \textcolor{stringliteral}{" Solving"}, ubound(subdomain,1),  \textcolor{stringliteral}{" subdomains .... "}
250 
251         picard\_loop: \textcolor{keywordflow}{do}
252         
253           itcount = itcount + 1
254 
255   \textcolor{comment}{!       !compute the local residuum}
256   \textcolor{comment}{!       !and create the local matrices}
257           \textcolor{keywordflow}{do} i=1, ubound(subdomain,1)
258             subdomain(i)%xvect(:,1:3) = pde_common%xvect(subdomain(i)%permut(1:
      subdomain(i)%ndof),1:3)
259             \textcolor{keywordflow}{if} (.not. subdomain(i)%solved) \textcolor{keywordflow}{then}
260               \textcolor{keyword}{call }locmat_assembler(subdomain(i), ierr, i)
261 \textcolor{keywordflow}{            end if}
262 \textcolor{keywordflow}{          end do}
263                   
264           \textcolor{keyword}{call }get_residual(resvct)
265 
266 
267          
268           
269           subdoms:  \textcolor{keywordflow}{do} i=1, ubound(subdomain,1)
270 
271             subfin = subdomain(i)%ndof
272                 \textcolor{comment}{! check local residuum}
273 \textcolor{comment}{!           res\_error = norm2(resvct(subdomain(i)%permut(1:subfin)))}
274     \textcolor{comment}{!                   res\_error = maxval(resvct(subdomain(i)%permut(1:subfin)))}
275 
276             \textcolor{keywordflow}{if} (res\_error > inner_criterion) \textcolor{keywordflow}{then}
277               subdomain(i)%solved = .false.
278             \textcolor{keywordflow}{else}
279               subdomain(i)%solved = .true.
280 \textcolor{keywordflow}{            end if}
281             
282             \textcolor{keywordflow}{if} (.not. subdomain(i)%solved) \textcolor{keywordflow}{then}
283 
284               corrvct(1:subfin) = 0.0
285 
286               \textcolor{keywordflow}{if} (subdomain(i)%critical) \textcolor{keywordflow}{then}
287                 reps = 1e-20
288               \textcolor{keywordflow}{else}
289                 reps = 1e-10
290 \textcolor{keywordflow}{              end if}
291 
292 
293               \textcolor{keyword}{call }diag_precond(a=subdomain(i)%matrix, prmt=subdomain(i)%permut,  mode=1)
294               
295               \textcolor{keyword}{call }solve_matrix(subdomain(i)%matrix, resvct, corrvct(1:subfin), ilev1=0, itmax1=subfin, 
      reps1=reps)
296 
297               \textcolor{keyword}{call }diag_precond(a=subdomain(i)%matrix, x=corrvct(1:subfin), mode=-1)
298               
299               error = maxval(abs(corrvct(1:subfin)))
300               
301 \textcolor{comment}{!             print *, itcount, error}
302               
303               subdomain(i)%xvect(:,3) = subdomain(i)%xvect(:,2) + corrvct(1:subfin)
304               
305               \textcolor{keywordflow}{if} (iter_criterion < 5) \textcolor{keywordflow}{then}
306 
307                 \textcolor{keyword}{call }search\_error\_cluster\_tt(subdomain(i), itcount) 
308                 
309 \textcolor{keywordflow}{              end if}
310               
311               subdomain(i)%xvect(:,2) = subdomain(i)%xvect(:,3)
312 
313               subdomain(i)%itcount = itcount
314 \textcolor{comment}{!             }
315 \textcolor{comment}{!             if (error <= iter\_criterion .and. &}
316 \textcolor{comment}{!             norm2(resvct(subdomain(i)%permut(1:subfin))) < inner\_criterion) then }
317 \textcolor{comment}{!               subdomain(i)%solved = .true.}
318 \textcolor{comment}{!             end if}
319 \textcolor{keywordflow}{            end if}
320                                         
321 \textcolor{keywordflow}{          end do} subdoms
322                     
323           \textcolor{keyword}{call }progressbar( int(100*ndofs_solved()/(1.0*ddinfo%ndofs\_tot)))
324 
325           \textcolor{keyword}{call }build_xvect()
326           
327 
328           \textcolor{keywordflow}{if} (domains_solved() == ubound(subdomain,1)) \textcolor{keywordflow}{then}
329 
330             \textcolor{keyword}{call }etime(taaray(2,:), rslt(2))
331             \textcolor{keywordflow}{do} i=1, ubound(subdomain,1)
332               \textcolor{keywordflow}{if} (.not. subdomain(i)%critical .and. subdomain(i)%itcount>1 ) \textcolor{keywordflow}{then}
333                 reset\_domains = .true.
334                 \textcolor{keywordflow}{EXIT}
335               \textcolor{keywordflow}{else}
336                 reset\_domains = .false.
337 \textcolor{keywordflow}{              end if}
338 \textcolor{keywordflow}{            end do}
339             
340               
341             \textcolor{keyword}{call }printtime(\textcolor{stringliteral}{"Time spent on iterations: "}, rslt(2)-rslt(1))
342             \textcolor{keywordflow}{if} (reset\_domains) \textcolor{keywordflow}{then}
343               ierr=-10
344             \textcolor{keywordflow}{else}
345               ierr=0
346 \textcolor{keywordflow}{            end if}
347             success = .true.
348 
349             \textcolor{keyword}{write}(unit=file_ddinfo, fmt=*) time, itcount, \textcolor{stringliteral}{"|"}, subdomain(:)%ndof
350             \textcolor{keyword}{call }flush(file_ddinfo)
351 
352             \textcolor{keywordflow}{EXIT} picard\_loop
353 \textcolor{keywordflow}{          end if}
354 
355           \textcolor{keywordflow}{if} (itcount > max_itcount) \textcolor{keywordflow}{then}
356 \textcolor{comment}{!           call set\_subdomains()}
357             success = .false.
358             ierr = 1
359             \textcolor{keywordflow}{RETURN}
360 \textcolor{keywordflow}{          end if}
361 
362 \textcolor{keywordflow}{        end do} picard\_loop
363 
364 
365 \textcolor{comment}{!         do proc=1, ubound(pde,1)}
366 \textcolor{comment}{!         do i=1, ubound(subdomain,1)}
367 \textcolor{comment}{!           call printmtx(subdomain(i)%xvect)}
368 \textcolor{comment}{!           dt\_fine = pde(proc)%dt\_check(subdomain(i)%xvect, subdomain(i)%permut)}
369             dt\_fine = .true.
370 \textcolor{comment}{!         end do}
371 \textcolor{comment}{!         end do}
372         
373         \textcolor{keywordflow}{if} (.not.(dt\_fine)) \textcolor{keywordflow}{then}
374           ierr = 2
375           success = .false.
376           \textcolor{keywordflow}{RETURN}
377         \textcolor{keywordflow}{else}
378 \textcolor{comment}{!           ierr = 0}
379           \textcolor{keyword}{call }results_extractor()
380 \textcolor{keywordflow}{        end if}
381 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd__time__test_ac055f89162bd3f14323b125cdd0253a6_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=310pt]{namespaceschwarz__dd__time__test_ac055f89162bd3f14323b125cdd0253a6_icgraph}
\end{center}
\end{figure}


\index{schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}!search\+\_\+error\+\_\+cluster\+\_\+tt@{search\+\_\+error\+\_\+cluster\+\_\+tt}}
\index{search\+\_\+error\+\_\+cluster\+\_\+tt@{search\+\_\+error\+\_\+cluster\+\_\+tt}!schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}}
\subsubsection[{search\+\_\+error\+\_\+cluster\+\_\+tt(sub, itcount)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, private schwarz\+\_\+dd\+\_\+time\+\_\+test\+::search\+\_\+error\+\_\+cluster\+\_\+tt (
\begin{DoxyParamCaption}
\item[{type({\bf subdomain\+\_\+str}), intent(in)}]{sub, }
\item[{integer(kind=ikind), intent(in)}]{itcount}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespaceschwarz__dd__time__test_a7bde386ee530d07dc024487cc43e0e23}


Definition at line 409 of file schwarz\+\_\+dd-\/time-\/test.\+f90.



References decomp\+\_\+vars\+::ddcoarse\+\_\+mesh, globals\+::elements, globals\+::iter\+\_\+criterion, and pde\+\_\+objs\+::pde.



Referenced by schwarzloc().


\begin{DoxyCode}
409         \textcolor{keywordtype}{use }typy
410         \textcolor{keywordtype}{use }globals
411         \textcolor{keywordtype}{use }global_objs
412         \textcolor{keywordtype}{use }decomp_vars
413         \textcolor{keywordtype}{use }debug_tools
414         \textcolor{keywordtype}{use }pde_objs
415 
416         \textcolor{keywordtype}{type}(subdomain_str), \textcolor{keywordtype}{intent(in)} :: sub
417         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: itcount
418 
419         \textcolor{keywordtype}{integer(kind=ikind)} :: i, j, ii, jj, el, nd, xpos, xpos\_loc
420         \textcolor{keywordtype}{real(kind=rkind)} :: loc\_error
421         
422 \textcolor{comment}{!       print *, maxval(abs(sub%xvect(:,3)-sub%xvect(:,2)))}
423         
424         \textcolor{keywordflow}{do} i=1, ubound(sub%coarse\_el,1)
425           j = sub%coarse\_el(i)
426           loc\_error = 0
427           \textcolor{keywordflow}{do} ii=1, ubound(ddcoarse_mesh(j)%elements,1)
428             el = ddcoarse_mesh(j)%elements(ii)
429             \textcolor{keywordflow}{do} jj = 1, ubound(elements%data,2)
430               nd = elements%data(el,jj)
431               xpos = pde(1)%permut(nd)
432               \textcolor{keywordflow}{if} (xpos > 0) \textcolor{keywordflow}{then}
433                 xpos\_loc = sub%invpermut(xpos)
434                 loc\_error = max(loc\_error, abs(sub%xvect(xpos\_loc,3)-sub%xvect(xpos\_loc,2)) )
435 \textcolor{comment}{!               print *, loc\_error}
436 \textcolor{keywordflow}{              end if}
437 \textcolor{keywordflow}{            end do}
438 \textcolor{keywordflow}{          end do}
439           \textcolor{keywordflow}{if} (loc\_error > iter_criterion) \textcolor{keywordflow}{then}
440 \textcolor{comment}{!         print *, "dfs"}
441             ddcoarse_mesh(j)%iter\_count = itcount + 1
442 \textcolor{keywordflow}{          end if}
443 \textcolor{keywordflow}{        end do}
444   
445 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceschwarz__dd__time__test_a7bde386ee530d07dc024487cc43e0e23_icgraph}
\end{center}
\end{figure}


\index{schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}!vyreseno@{vyreseno}}
\index{vyreseno@{vyreseno}!schwarz\+\_\+dd\+\_\+time\+\_\+test@{schwarz\+\_\+dd\+\_\+time\+\_\+test}}
\subsubsection[{vyreseno()}]{\setlength{\rightskip}{0pt plus 5cm}integer(kind=ikind) function, private schwarz\+\_\+dd\+\_\+time\+\_\+test\+::vyreseno (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespaceschwarz__dd__time__test_a25f98453f72bb54e1bfbcf1339bd6692}


Definition at line 163 of file schwarz\+\_\+dd-\/time-\/test.\+f90.



References decomp\+\_\+vars\+::subdomain.



Referenced by schwarz\+\_\+picard\+\_\+tt().


\begin{DoxyCode}
163         \textcolor{keywordtype}{use }typy
164         \textcolor{keywordtype}{use }decomp_vars
165         
166         \textcolor{keywordtype}{integer(kind=ikind)} :: cislo
167         \textcolor{keywordtype}{integer(kind=ikind)} :: i
168         
169         cislo = 0
170         \textcolor{keywordflow}{do} i=1, ubound(subdomain,1)
171           \textcolor{keywordflow}{if} (subdomain(i)%finish) \textcolor{keywordflow}{then}
172             cislo = cislo + 1
173 \textcolor{keywordflow}{          end if}
174 \textcolor{keywordflow}{        end do}
175         
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=310pt]{namespaceschwarz__dd__time__test_a25f98453f72bb54e1bfbcf1339bd6692_icgraph}
\end{center}
\end{figure}


