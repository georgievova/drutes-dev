\section{stiffmat Module Reference}
\label{namespacestiffmat}\index{stiffmat@{stiffmat}}


stiffness matrix procedure for non-\/linear problems linearized by Picard method  


\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine, public {\bf build\+\_\+stiff\+\_\+np} (el\+\_\+id, dt, domain\+\_\+id, quadpnt\+\_\+in)
\begin{DoxyCompactList}\small\item\em build local stifness matrix for nonlinear problems and Picard method \end{DoxyCompactList}\item 
subroutine, public {\bf build\+\_\+bvect} (el\+\_\+id, dt, domain\+\_\+id, quadpnt\+\_\+in)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
stiffness matrix procedure for non-\/linear problems linearized by Picard method 

\subsection{Function/\+Subroutine Documentation}
\index{stiffmat@{stiffmat}!build\+\_\+bvect@{build\+\_\+bvect}}
\index{build\+\_\+bvect@{build\+\_\+bvect}!stiffmat@{stiffmat}}
\subsubsection[{build\+\_\+bvect(el\+\_\+id, dt, domain\+\_\+id, quadpnt\+\_\+in)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public stiffmat\+::build\+\_\+bvect (
\begin{DoxyParamCaption}
\item[{integer(kind=ikind), intent(in)}]{el\+\_\+id, }
\item[{real(kind=rkind), intent(in)}]{dt, }
\item[{integer(kind=ikind), intent(in), optional}]{domain\+\_\+id, }
\item[{type({\bf integpnt\+\_\+str}), intent(in), optional}]{quadpnt\+\_\+in}
\end{DoxyParamCaption}
)}\label{namespacestiffmat_a31243094e6fbabfb25e1e1939b133899}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em domain\+\_\+id} & subdomain number (inserted only if domain decomposition used and if only local data needed) \\
\hline
\end{DoxyParams}


Definition at line 133 of file stiffmat.\+f90.



References globals\+::bside, globals\+::elements, globals\+::gauss\+\_\+points, pde\+\_\+objs\+::pde, and globals\+::stiff\+\_\+mat.



Referenced by femmat\+::assemble\+\_\+mat(), schwarz\+\_\+dd\+::locmat\+\_\+assembler(), and schwarz\+\_\+dd2subcyc\+::locmat\+\_\+assembler().


\begin{DoxyCode}
133       \textcolor{keywordtype}{use }typy
134       \textcolor{keywordtype}{use }globals
135       \textcolor{keywordtype}{use }global_objs
136       \textcolor{keywordtype}{use }pde_objs
137       \textcolor{keywordtype}{use }feminittools
138       \textcolor{keywordtype}{use }linalg
139       \textcolor{keywordtype}{use }debug_tools
140       
141       \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: el\_id
142       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)} :: dt
144       \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: domain\_id
145       \textcolor{keywordtype}{type}(integpnt_str) , \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: quadpnt\_in
146       
147       \textcolor{keywordtype}{integer(kind=ikind)} :: iproc, limits, ii, i, l
148       \textcolor{keywordtype}{real(kind=rkind)} :: suma
149       \textcolor{keywordtype}{type}(integpnt_str) :: quadpnt
150       
151       bside = 0
152       
153       \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(quadpnt\_in)) \textcolor{keywordflow}{then}
154         quadpnt = quadpnt\_in
155 \textcolor{keywordflow}{      end if}
156       
157       quadpnt%element = el\_id
158       quadpnt%column = 2
159       quadpnt%type\_pnt = \textcolor{stringliteral}{"gqnd"}
160       
161       limits = ubound(stiff_mat,1)/ubound(pde,1)
162 
163       \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(domain\_id)) \textcolor{keywordflow}{then}
164         quadpnt%ddlocal = .true.
165         quadpnt%subdom = domain\_id
166 \textcolor{keywordflow}{      end if}
167       
168       \textcolor{keywordflow}{do} iproc = 1, ubound(pde,1)
169         \textcolor{keywordflow}{do} i=1, ubound(stiff_mat,1)/ ubound(pde,1)
170           suma = 0
171           
172           \textcolor{keywordflow}{do} l=1, ubound(gauss_points%weight,1)
173            quadpnt%order = l      
174            suma = suma - pde(iproc)%pde\_fnc(iproc)%zerord(pde(iproc), layer=
      elements%material\textcolor{comment}{(el\_id, iproc), quadpnt=quadpnt) &}
175 \textcolor{comment}{           *gauss_points%weight(l)}
176 \textcolor{comment}{}\textcolor{keywordflow}{          end do}
177           
178           ii = i + (iproc-1)*limits
179           
180           bside(ii) = suma*dt*elements%areas(el\_id)
181           
182 \textcolor{keywordflow}{        end do}
183 \textcolor{keywordflow}{      end do}
184     
185 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacestiffmat_a31243094e6fbabfb25e1e1939b133899_icgraph}
\end{center}
\end{figure}


\index{stiffmat@{stiffmat}!build\+\_\+stiff\+\_\+np@{build\+\_\+stiff\+\_\+np}}
\index{build\+\_\+stiff\+\_\+np@{build\+\_\+stiff\+\_\+np}!stiffmat@{stiffmat}}
\subsubsection[{build\+\_\+stiff\+\_\+np(el\+\_\+id, dt, domain\+\_\+id, quadpnt\+\_\+in)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public stiffmat\+::build\+\_\+stiff\+\_\+np (
\begin{DoxyParamCaption}
\item[{integer(kind=ikind), intent(in)}]{el\+\_\+id, }
\item[{real(kind=rkind), intent(in)}]{dt, }
\item[{integer(kind=ikind), intent(in), optional}]{domain\+\_\+id, }
\item[{type({\bf integpnt\+\_\+str}), intent(inout), optional}]{quadpnt\+\_\+in}
\end{DoxyParamCaption}
)}\label{namespacestiffmat_ae46961e6784b8661f5fa07d7b6bed25a}


build local stifness matrix for nonlinear problems and Picard method 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em dt} & time step\\
\hline
\mbox{\tt in}  & {\em domain\+\_\+id} & subdomain number (inserted only if domain decomposition used and if only local data needed) \\
\hline
\end{DoxyParams}
sum of dispersive terms

sum of convection terms

sum of reaction terms 

Definition at line 9 of file stiffmat.\+f90.



References globals\+::base\+\_\+fnc, globals\+::drutes\+\_\+config, globals\+::elements, globals\+::gauss\+\_\+points, pde\+\_\+objs\+::pde, and globals\+::stiff\+\_\+mat.



Referenced by femmat\+::assemble\+\_\+mat(), schwarz\+\_\+dd\+::locmat\+\_\+assembler(), and schwarz\+\_\+dd2subcyc\+::locmat\+\_\+assembler().


\begin{DoxyCode}
9       \textcolor{keywordtype}{use }typy
10       \textcolor{keywordtype}{use }globals
11       \textcolor{keywordtype}{use }global_objs
12       \textcolor{keywordtype}{use }pde_objs
13       \textcolor{keywordtype}{use }feminittools
14       \textcolor{keywordtype}{use }linalg
15       \textcolor{keywordtype}{use }debug_tools
16 
17       \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: el\_id
19       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)} :: dt
21       \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: domain\_id
22       \textcolor{keywordtype}{type}(integpnt_str), \textcolor{keywordtype}{intent(in out)}, \textcolor{keywordtype}{optional} :: quadpnt\_in
23 
24       
25       \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{save} :: layer
27       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(1,1)} :: dsum
29       \textcolor{keywordtype}{real(kind=rkind)} :: csum
31       \textcolor{keywordtype}{real(kind=rkind)} :: rsum
32       \textcolor{keywordtype}{integer(kind=ikind)} :: i,j,l, top, iproc, jproc, ii, jj, limits
33       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(1,3)} :: u
34       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(3,1)} :: v
35       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(1,3)} :: w
36       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(3)} :: conv
37       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(3,3)} :: disp
38       \textcolor{keywordtype}{type}(integpnt_str) :: quadpnt
39 
40       stiff_mat = 0
41 
42       \textcolor{keywordflow}{if} (.not. \textcolor{keyword}{allocated}(layer)) \textcolor{keywordflow}{then}
43         \textcolor{keyword}{allocate}(layer(ubound(pde,1), ubound(pde,1)))
44 \textcolor{keywordflow}{      end if}
45 
46       \textcolor{keywordflow}{do} iproc=1,ubound(pde,1)
47         \textcolor{keywordflow}{do} jproc=1,ubound(pde,1)
48             layer(iproc, jproc) = elements%material(el\_id, jproc)
49 \textcolor{keywordflow}{        end do}
50 \textcolor{keywordflow}{      end do}
51       
52       limits = ubound(stiff_mat,1)/ubound(pde,1)
53 
54       top = drutes_config%dimen
55       
56       \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(quadpnt\_in)) \textcolor{keywordflow}{then}
57         quadpnt=quadpnt\_in
58 \textcolor{keywordflow}{      end if}
59 
60       quadpnt%element = el\_id
61       quadpnt%column = 2
62       quadpnt%type\_pnt = \textcolor{stringliteral}{"gqnd"}
63       
64       \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(domain\_id)) \textcolor{keywordflow}{then}
65         quadpnt%ddlocal = .true.
66         quadpnt%subdom = domain\_id
67 \textcolor{keywordflow}{      end if}
68       
69 
70      
71             
72       \textcolor{keywordflow}{do} iproc=1,ubound(pde,1)
73         \textcolor{keywordflow}{do} jproc=1, ubound(pde,1)
74           \textcolor{keywordflow}{do} i=1, ubound(stiff_mat,1)/ ubound(pde,1)
75             \textcolor{keywordflow}{do} j=1, ubound(stiff_mat,1)/ubound(pde,1)
76               dsum = 0
77               csum = 0
78               rsum = 0
79               
80               
81               v(1:top,1) = elements%ders(el\_id,i,1:top)
82               u(1,1:top) = elements%ders(el\_id,j,1:top)
83 
84               \textcolor{keywordflow}{do} l=1, ubound(gauss_points%weight,1)
85                 quadpnt%order = l
86                 \textcolor{keyword}{call }pde(iproc)%pde\_fnc(jproc)%dispersion(pde(iproc), layer(iproc\textcolor{comment}{, jproc), &}
87 \textcolor{comment}{                quadpnt, tensor=disp(1:top,1:top))}
88 \textcolor{comment}{                w(:,1:top) =  matmul(u(:,1:top),disp(1:top,1:top))}
89 \textcolor{comment}{                dsum = dsum - matmul(w(:,1:top) ,v(1:top,:))*gauss_points%weight(l)}
90 \textcolor{comment}{}\textcolor{keywordflow}{              end do}
91 
92   
93               \textcolor{keywordflow}{do} l=1, ubound(gauss_points%weight,1)
94                 quadpnt%order = l
95                 \textcolor{keyword}{call }pde(iproc)%pde\_fnc(jproc)%convection(pde(iproc), layer(iproc, jproc\textcolor{comment}{), quadpnt, &}
96 \textcolor{comment}{                  vector\_out=conv(1:top))}
97 \textcolor{comment}{                  csum = csum - dot_product(u(1,1:top),conv(1:top))*base_fnc(i,l)*
      gauss_points%weight(l)}
98 \textcolor{comment}{                  }\textcolor{keyword}{call }pde(iproc)%pde\_fnc(jproc)%der\_convect(pde(iproc), layer(iproc, jproc\textcolor{comment}{), quadpnt,  &}
99 \textcolor{comment}{                  vector\_out=conv(1:top))}
100 \textcolor{comment}{                  w = base_fnc(i,l)*base_fnc(j,l)}
101 \textcolor{comment}{                  csum = csum - dot_product(w(1,1:top), conv(1:top))*
      gauss_points%weight(l)}
102 \textcolor{comment}{}\textcolor{keywordflow}{              end do}
103               
104 
105               \textcolor{keywordflow}{do} l=1, ubound(gauss_points%weight,1)
106                 quadpnt%order = l
107                 rsum = rsum + pde(iproc)%pde\_fnc(jproc)%reaction(pde(iproc),layer(iproc\textcolor{comment}{, jproc), &}
108 \textcolor{comment}{                      quadpnt)*base_fnc(i,l)*base_fnc(j,l)*gauss_points%weight(l)}
109 \textcolor{comment}{}\textcolor{keywordflow}{              end do}
110              
111               
112 
113               ii = i + (iproc-1)*limits
114               jj = j + (jproc-1)*limits
115               
116               
117               
118               stiff_mat(ii,jj) = (dsum(1,1) + csum + rsum)
119 
120 \textcolor{keywordflow}{            end do}
121 \textcolor{keywordflow}{          end do} 
122 \textcolor{keywordflow}{        end do}
123 \textcolor{keywordflow}{      end do}
124 
125       
126      stiff_mat = stiff_mat/gauss_points%area*elements%areas(el\_id)*dt
127      
128      
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacestiffmat_ae46961e6784b8661f5fa07d7b6bed25a_icgraph}
\end{center}
\end{figure}


