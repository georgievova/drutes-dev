\section{simegen Module Reference}
\label{namespacesimegen}\index{simegen@{simegen}}


simple mesh generator  


\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine, public {\bf simegen1d} ()
\item 
subroutine, public {\bf simegen2d} (lx, ly, density, edges\+\_\+xy, center\+\_\+coor)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
simple mesh generator 

\subsection{Function/\+Subroutine Documentation}
\index{simegen@{simegen}!simegen1d@{simegen1d}}
\index{simegen1d@{simegen1d}!simegen@{simegen}}
\subsubsection[{simegen1d()}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public simegen\+::simegen1d (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{namespacesimegen_aa20a1b7ef75f108fb29cd787f0cf5d3b}


Definition at line 9 of file simegen.\+f90.



References core\+\_\+tools\+::avg(), globals1d\+::deltax\+\_\+1d, globals\+::elements, readtools\+::file\+\_\+error(), globals\+::file\+\_\+mesh, globals1d\+::materials\+\_\+1d, core\+\_\+tools\+::mesh\+\_\+allocater(), and globals\+::nodes.



Referenced by read\+\_\+inputs\+::read\+\_\+1dmesh\+\_\+int().


\begin{DoxyCode}
9       \textcolor{keywordtype}{use }typy
10       \textcolor{keywordtype}{use }global_objs
11       \textcolor{keywordtype}{use }globals
12       \textcolor{keywordtype}{use }globals1d
13       \textcolor{keywordtype}{use }core_tools
14       \textcolor{keywordtype}{use }readtools
15       \textcolor{keywordtype}{use }debug_tools
16 
17 
18       \textcolor{keywordtype}{integer(kind=ikind)} :: pocet1
19       \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: pocty, sumy
20       \textcolor{keywordtype}{real(kind=rkind)} :: dx1
21       \textcolor{keywordtype}{integer(kind=ikind)} :: i,j, last, n
22       \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: testmat
23       \textcolor{keywordtype}{logical} :: err\_mat = .false.
24 
25 
26       \textcolor{keyword}{allocate}(pocty(ubound(deltax_1d,1)))
27       \textcolor{keyword}{allocate}(sumy(0:ubound(deltax_1d,1)))
28       
29 
30      
31       pocet1 = 0
32       \textcolor{keywordflow}{do} i = 1, ubound(deltax_1d,1)
33         \textcolor{keywordflow}{if} (abs((int((deltax_1d(i,3) - deltax_1d(i,2))/deltax_1d(i,1)) - &
34                   ((deltax_1d(i,3) - deltax_1d(i,2))/deltax_1d(i,1)))) > 100*epsilon(dx1\textcolor{comment}{)) }\textcolor{keywordflow}{then}
35           n = int((deltax_1d(i,3) - deltax_1d(i,2))/deltax_1d(i,1)) + 1
36         \textcolor{keywordflow}{else}
37           n = int((deltax_1d(i,3) - deltax_1d(i,2))/deltax_1d(i,1))
38 \textcolor{keywordflow}{        end if}    
39 
40         deltax_1d(i,1) = (deltax_1d(i,3) - deltax_1d(i,2))/(1.0\_rkind*n)
41 
42         \textcolor{keywordflow}{if} (i == 1) \textcolor{keywordflow}{then}
43           n = n + 1
44 \textcolor{keywordflow}{        end if}
45         pocty(i) = n
46         pocet1 = pocet1 + n
47         sumy(i) = pocet1
48 \textcolor{keywordflow}{      end do}
49       
50 
51       nodes%kolik=pocet1
52       elements%kolik = nodes%kolik - 1
53       \textcolor{keyword}{call }mesh_allocater()
54       sumy(0) = 0
55       deltax_1d(0,:) = 0
56       deltax_1d(0,3) = deltax_1d(1,2)
57 
58       
59         
60       \textcolor{keywordflow}{do} i=1, ubound(pocty,1)
61         \textcolor{keywordflow}{do} j=1, pocty(i) 
62           \textcolor{keywordflow}{if} (i == 1) \textcolor{keywordflow}{then}
63             nodes%data(j+sumy(i-1),1) = deltax_1d(i-1,3) + (j-1)*deltax_1d(i,1)
64           \textcolor{keywordflow}{else}
65             nodes%data(j+sumy(i-1),1) = deltax_1d(i-1,3) + j*deltax_1d(i,1)
66 \textcolor{keywordflow}{          end if}
67 \textcolor{keywordflow}{        end do}
68 \textcolor{keywordflow}{      end do}
69         
70       elements%data(1,1) = 1 
71       elements%data(1,2) = 2
72       \textcolor{keywordflow}{do} i=2, elements%kolik
73         elements%data(i,1) = elements%data(i-1,2)
74         elements%data(i,2) = i+1
75 \textcolor{keywordflow}{      end do}
76 
77 
78 
79       \textcolor{keywordflow}{do} i=1, elements%kolik
80         \textcolor{keywordflow}{do} j=1,ubound(materials_1d,1)
81           \textcolor{keywordflow}{if} (avg(nodes%data(elements%data(i,1),1), nodes%data(elements%data(i,\textcolor{comment}{2),1)) > 
      materials_1d(j,2) .and. &}
82 \textcolor{comment}{              avg(nodes%data(elements%data(i,1),1), nodes%data(elements%data(i,2),1)) <= 
      materials_1d(j,3)) }\textcolor{keywordflow}{then}
83               
84               elements%material(i, :) =  nint(materials_1d(j,1))
85               \textcolor{keywordflow}{EXIT}
86 \textcolor{keywordflow}{          end if}
87 \textcolor{keywordflow}{        end do}
88 \textcolor{keywordflow}{      end do}
89 
90       \textcolor{keywordflow}{if} (minval(elements%material) == 0) \textcolor{keywordflow}{then}
91         print *, \textcolor{stringliteral}{"check file drutes.conf/mesh/drumesh1d.conf, seems like the material description does not
       cover the entire domain"}
92         error stop
93 \textcolor{keywordflow}{      end if}
94       
95       \textcolor{keyword}{allocate}(testmat(nint(maxval(materials_1d(:,1)))))
96       
97       testmat = .false.
98       
99       \textcolor{keywordflow}{do} i=1, ubound(elements%material,1)
100         testmat(elements%material(i,1)) = .true.
101 \textcolor{keywordflow}{      end do}
102       
103       \textcolor{keywordflow}{do} i=1, ubound(testmat,1)
104         \textcolor{keywordflow}{if} (.not. testmat(i)) \textcolor{keywordflow}{then}
105           print *, \textcolor{stringliteral}{"ERROR! material with ID"}, i, \textcolor{stringliteral}{"undefined in drutes.conf/mesh.conf/drumesh1d.conf"}
106           err\_mat = .true.
107 \textcolor{keywordflow}{        end if}
108 \textcolor{keywordflow}{      end do}
109       
110       \textcolor{keywordflow}{if} (err\_mat) \textcolor{keyword}{call }file_error(file_mesh, \textcolor{stringliteral}{"ERROR!! check your material description"}\textcolor{comment}{)}
111 \textcolor{comment}{}
112 \textcolor{comment}{}
113 \textcolor{comment}{      nodes%edge = 0}
114 \textcolor{comment}{      }
115 \textcolor{comment}{      }\textcolor{keywordflow}{if} (nodes%data(1,1) < nodes%data(nodes%kolik,1) ) \textcolor{keywordflow}{then}
116         nodes%edge(1) = 101
117         nodes%edge(ubound(nodes%edge,1)) = 102
118       \textcolor{keywordflow}{else}
119         nodes%edge(1) = 102
120         nodes%edge(ubound(nodes%edge,1)) = 101
121 \textcolor{keywordflow}{      end if}
122 
123 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=321pt]{namespacesimegen_aa20a1b7ef75f108fb29cd787f0cf5d3b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacesimegen_aa20a1b7ef75f108fb29cd787f0cf5d3b_icgraph}
\end{center}
\end{figure}


\index{simegen@{simegen}!simegen2d@{simegen2d}}
\index{simegen2d@{simegen2d}!simegen@{simegen}}
\subsubsection[{simegen2d(lx, ly, density, edges\+\_\+xy, center\+\_\+coor)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public simegen\+::simegen2d (
\begin{DoxyParamCaption}
\item[{real(kind=rkind), intent(in)}]{lx, }
\item[{real(kind=rkind), intent(in)}]{ly, }
\item[{real(kind=rkind), intent(in)}]{density, }
\item[{real(kind=rkind), dimension(\+:,\+:,\+:), intent(in)}]{edges\+\_\+xy, }
\item[{real(kind=rkind), dimension(\+:), intent(in)}]{center\+\_\+coor}
\end{DoxyParamCaption}
)}\label{namespacesimegen_aed5580e640bf5adfe4427f5b879b517d}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em lx} & mesh parameters\\
\hline
\mbox{\tt in}  & {\em ly} & mesh parameters\\
\hline
\mbox{\tt in}  & {\em density} & mesh parameters\\
\hline
\mbox{\tt in}  & {\em edges\+\_\+xy} & description of the mesh edges \\
\hline
\end{DoxyParams}


Definition at line 127 of file simegen.\+f90.



References globals\+::elements, geom\+\_\+tools\+::inline(), core\+\_\+tools\+::mesh\+\_\+allocater(), and globals\+::nodes.



Referenced by read\+\_\+inputs\+::read\+\_\+2dmesh\+\_\+int().


\begin{DoxyCode}
127       \textcolor{keywordtype}{use }typy
128       \textcolor{keywordtype}{use }globals
129       \textcolor{keywordtype}{use }globals2d
130       \textcolor{keywordtype}{use }geom_tools
131       \textcolor{keywordtype}{use }core_tools
132       \textcolor{keywordtype}{use }debug_tools
133 
135       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)} :: lx, ly, density
137       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:,:,:)}, \textcolor{keywordtype}{intent(in)} :: edges\_xy
138       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: center\_coor
139       \textcolor{keywordtype}{real(kind=rkind)} :: step1, step2, tmp1, tmp2, reps
140       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(2)} :: a,b
141       
142       \textcolor{keywordtype}{integer} :: i,j, counter, m, count1, count2, k, l
143       \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(2)} :: c
144       \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{allocatable} :: cpus
145       
146       
147 
148       count1 = int(lx/density)
149       
150       step1 = lx/count1
151       
152       count2 = int(ly/density)
153       
154       step2 = ly/count2
155       
156       nodes%kolik = (count1+1)*(count2+1)
157       elements%kolik = 2*count1*count2
158       
159 
160       \textcolor{keyword}{call }mesh_allocater()
161 
162       counter = 1\_ikind
163       
164       \textcolor{keywordflow}{do} i=0, count2
165         \textcolor{keywordflow}{do} j=0, count1
166           nodes%data(counter,1) = j*step1
167           nodes%data(counter,2) = i*step2
168           counter = counter + 1
169 \textcolor{keywordflow}{        end do}
170 \textcolor{keywordflow}{      end do}
171       
172 
173       j = 1\_ikind
174       m = 0\_ikind
175       \textcolor{keywordflow}{do} i=1, elements%kolik - 1, 2
176         \textcolor{keywordflow}{if} (m >= count1) \textcolor{keywordflow}{then}
177           j = j+1
178           m = 0\_ikind
179 \textcolor{keywordflow}{        end if}
180         m = m + 1
181         elements%data(i,1) = int(i/2) + j
182         elements%data(i,2) = int(i/2) + j+1 + count1
183         elements%data(i,3) = int(i/2) + j+1 + count1 + 1
184         elements%data(i+1,1) = int(i/2) + j
185         elements%data(i+1,2) = int(i/2) + j+1
186         elements%data(i+1,3) = int(i/2) + j+1 + count1 + 1
187 \textcolor{keywordflow}{      end do}
188 
189 \textcolor{comment}{!       do i=1, elements%kolik}
190 \textcolor{comment}{!       if (nodes%data(elements%data(i,1),2) > 50) then}
191 \textcolor{comment}{!         elements%material(i,:) = 1}
192 \textcolor{comment}{!       else}
193 \textcolor{comment}{!         elements%material(i,:) = 2}
194 \textcolor{comment}{!       end if}
195 \textcolor{comment}{!       end do}
196       elements%material = 1
197       
198       \textcolor{keywordflow}{do} i=1, nodes%kolik
199         nodes%data(i,:) = nodes%data(i,:) + center\_coor
200 \textcolor{keywordflow}{      end do}
201       
202 
203       reps = epsilon(reps)
204       
205 
206       nodes%edge = 0\_ikind
207       
208     
209 
210       \textcolor{keywordflow}{do} i=1, nodes%kolik
211         \textcolor{keywordflow}{do} j=1, ubound(edges\_xy,1)
212           a = edges\_xy(j,1,:)
213           b = edges\_xy(j,2,:)     
214 
215           c = nodes%data(i,:)
216 
217           \textcolor{keywordflow}{if} (inline(a,b,c)) \textcolor{keywordflow}{then}
218                 nodes%edge(i) = j+100
219 \textcolor{keywordflow}{           end if}
220 \textcolor{keywordflow}{          end do}
221 \textcolor{keywordflow}{        end do}
222         
223 
224 
225 
226 \textcolor{comment}{!       nodes%data(2,:) = (/0,1/)}
227 \textcolor{comment}{!       nodes%data(3,:) = (/0,2/)}
228 \textcolor{comment}{!       nodes%data(4,:) = (/1,0/)}
229 \textcolor{comment}{!       nodes%data(5,:) = (/1,1/)}
230 \textcolor{comment}{!       nodes%data(6,:) = (/1,2/)}
231 \textcolor{comment}{! }
232 \textcolor{comment}{!       elements%data(1,:) = (/1,4,5/)}
233 \textcolor{comment}{!       elements%data(2,:) = (/1,5,2/)}
234 \textcolor{comment}{!       elements%data(3,:) = (/2,5,6/)}
235 \textcolor{comment}{!       elements%data(4,:) = (/2,6,3/)}
236 \textcolor{comment}{! }
237 \textcolor{comment}{!       nodes%edge = 0}
238 \textcolor{comment}{!       nodes%edge(1) = 101}
239 \textcolor{comment}{!       nodes%edge(4) = 101}
240 
241 
242 \textcolor{comment}{!       if (num\_images() > 1) then}
243 \textcolor{comment}{!         allocate(cpus(num\_images(),2))}
244 \textcolor{comment}{!         i = elements%kolik/num\_images()}
245 \textcolor{comment}{!         }
246 \textcolor{comment}{!         do j=1, num\_images()-1}
247 \textcolor{comment}{!           cpus(j,1) = (j-1)*i+1}
248 \textcolor{comment}{!           cpus(j,2) = j*i}
249 \textcolor{comment}{!         end do}
250 \textcolor{comment}{!     }
251 \textcolor{comment}{!         }
252 \textcolor{comment}{!         cpus(num\_images(),1) = cpus(num\_images()-1,2)+1}
253 \textcolor{comment}{!         cpus(num\_images(),2) = elements%kolik}
254 \textcolor{comment}{!     }
255 \textcolor{comment}{!         i=1}
256 \textcolor{comment}{!         do j=1, elements%kolik}
257 \textcolor{comment}{!           do}
258 \textcolor{comment}{!             if (j >= cpus(i,1) .and. j <= cpus(i,2)) then}
259 \textcolor{comment}{!               elements%CPU(j) = i}
260 \textcolor{comment}{!               EXIT}
261 \textcolor{comment}{!             else}
262 \textcolor{comment}{!               i = i+1}
263 \textcolor{comment}{!             end if}
264 \textcolor{comment}{!           end do}
265 \textcolor{comment}{!         end do}
266 \textcolor{comment}{!     }
267 \textcolor{comment}{!         deallocate(cpus)}
268 \textcolor{comment}{!       else}
269 \textcolor{comment}{!         elements%CPU = 1}
270 \textcolor{comment}{!       end if}
271 
272     
273   \textcolor{comment}{!     do i=1, nodes%kolik}
274   \textcolor{comment}{!       do j=lbound(waterbc\_m,1), lbound(waterbc\_m,1)}
275   \textcolor{comment}{!     do k=1, ubound(waterbc\_m(j)%x,1)-1}
276   \textcolor{comment}{!       a = (/waterbc\_m(j)%x(k), waterbc\_m(j)%y(k)/)}
277   \textcolor{comment}{!       b = (/waterbc\_m(j)%x(k+1), waterbc\_m(j)%y(k+1)/)}
278   \textcolor{comment}{!               print *, a,b}
279   \textcolor{comment}{!       print *, nodes%data(i,:)}
280   \textcolor{comment}{!       if (inline(a,b,nodes%data(i,:))) then}
281   \textcolor{comment}{!           nodes%edge(i) = waterbc\_m(j)%ID}
282   \textcolor{comment}{!           EXIT}
283   \textcolor{comment}{!       end if}
284   \textcolor{comment}{!     end do}
285   \textcolor{comment}{!       end do}
286   \textcolor{comment}{!     end do}
287                 
288               
289     
290   \textcolor{comment}{!     do i=1, nodes%kolik}
291   \textcolor{comment}{!       if ( abs(nodes%data(i,2) - ly) < reps ) then }
292   \textcolor{comment}{!         nodes%bc\_c(i, :) = 1\_ikind}
293   \textcolor{comment}{!       else}
294   \textcolor{comment}{!         nodes%bc\_c(i,:) = 0\_ikind}
295   \textcolor{comment}{!       end if}
296   \textcolor{comment}{!     end do}
297   \textcolor{comment}{!     }
298   \textcolor{comment}{!   }
299 
300 
301 
302   \textcolor{comment}{!     do i=1, ubound(nodes%data,1)}
303   \textcolor{comment}{!       print *, i, nodes%data(i,:), "edge", nodes%edge(i)}
304   \textcolor{comment}{!     end do}
305   \textcolor{comment}{!   stop}
306   \textcolor{comment}{!     stop}
307   \textcolor{comment}{!     do i=1, nodes%kolik}
308   \textcolor{comment}{!       print *, i, nodes%data(i,:), nodes%bc(i,:)}
309   \textcolor{comment}{!     end do}
310   \textcolor{comment}{! !     }
311   \textcolor{comment}{!     do i=1, elements%kolik}
312   \textcolor{comment}{!       print *, i, elements%data(i,:)}
313   \textcolor{comment}{!     end do}
314   \textcolor{comment}{!   stop }
315 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacesimegen_aed5580e640bf5adfe4427f5b879b517d_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacesimegen_aed5580e640bf5adfe4427f5b879b517d_icgraph}
\end{center}
\end{figure}


