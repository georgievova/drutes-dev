\section{solvers Module Reference}
\label{namespacesolvers}\index{solvers@{solvers}}


resice soustav  


\subsection*{Data Types}
\begin{DoxyCompactItemize}
\item 
type {\bf vrstvy}
\end{DoxyCompactItemize}
\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine, public {\bf jacobi} (a, b, x, maxit1, reps1, it, repsfin, l1, l2, countop, ilev1)
\begin{DoxyCompactList}\small\item\em Jacobiova metoda. \end{DoxyCompactList}\item 
subroutine, public {\bf gs} (a, b, x, maxit, reps, it, repsfin, l1, l2, countop, ilev)
\begin{DoxyCompactList}\small\item\em Gauss-\/\+Seidelova metoda. \end{DoxyCompactList}\item 
subroutine, public {\bf ldu} (A, LU, info, pivtype, ilev, perm1, perm2)
\begin{DoxyCompactList}\small\item\em nedestruktivni L\+DU rozklad \end{DoxyCompactList}\item 
subroutine, public {\bf ldud} (A, info, pivtype, ilev, perm1, perm2)
\begin{DoxyCompactList}\small\item\em destruktivni L\+DU rozklad \end{DoxyCompactList}\item 
subroutine, public {\bf split} (L\+DU, L, D, U, p1, p2)
\begin{DoxyCompactList}\small\item\em rozdeli matici s L\+DU rozkladem na jednotlive komponenty \end{DoxyCompactList}\item 
subroutine, public {\bf lduback} (L\+DU, b, x, p1, p2, oc1, ilevel, errcode)
\begin{DoxyCompactList}\small\item\em Zpetny chod po L\+DU dekompozici. Predpoklada se, ze matice je ctvercova. \end{DoxyCompactList}\item 
subroutine, public {\bf sd} (A, b, x, itmax1, reps1, ilev1, itfin1, repsfin1, ll1, ll2, cond1, opcnt1, errcode1)
\begin{DoxyCompactList}\small\item\em metoda nejvetsiho spadu ( Steepest descent) podrobnosti viz \doxyref{\char`\"{}\+Metoda nejvetsiho spadu\char`\"{}}{p.}{sd} \end{DoxyCompactList}\item 
subroutine, public {\bf sdnormal}
\item 
subroutine, public {\bf cg} (A, b, x, itmax1, reps1, ilev1, itfin1, repsfin1, ll1, ll2, cond1, opcnt1, errcode1)
\begin{DoxyCompactList}\small\item\em metoda sdruzenych gradientu \doxyref{Metoda sdruzenych gradientu}{p.}{cg} \end{DoxyCompactList}\item 
subroutine, public {\bf cgnormal} (A, b, x, itmax1, reps1, ilev1, itfin1, repsfin1, ll1, ll2, cond1, opcnt1, errcode1)
\begin{DoxyCompactList}\small\item\em metoda sdruzenych gradientu pro normalni rovnice \doxyref{Metoda sdruzenych gradientu pro normalni rovnice}{p.}{cgn} \end{DoxyCompactList}\item 
subroutine, public {\bf pcg} (A, Minv, b, x, itmax1, reps1, ilev1, itfin1, repsfin1, ll1, ll2, cond1, opcnt1, errcode1)
\begin{DoxyCompactList}\small\item\em metoda sdruzenych gradientu \doxyref{Metoda predpodminenych sdruzenych gradientu}{p.}{pcg} \end{DoxyCompactList}\item 
subroutine, public {\bf pcgnormal}
\item 
real(kind=rkind) function, private {\bf vycdet} (x, a, b, n)
\item 
subroutine, private {\bf esteig} (l1, l2, n, alfa, beta)
\item 
subroutine {\bf inivrstvy} (levelset, A)
\begin{DoxyCompactList}\small\item\em inicializuje vrstvy \end{DoxyCompactList}\item 
subroutine {\bf firstpoint} (levelset, point)
\begin{DoxyCompactList}\small\item\em vlozi prvni vrchol, v tomto pripade nepotrebuje matici \end{DoxyCompactList}\item 
subroutine {\bf addlevel} (A, mapa, levelset)
\begin{DoxyCompactList}\small\item\em prida vrstvu, predpoklada se, ze aspon jedna tam uz je \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
resice soustav 

\subsection{Function/\+Subroutine Documentation}
\index{solvers@{solvers}!addlevel@{addlevel}}
\index{addlevel@{addlevel}!solvers@{solvers}}
\subsubsection[{addlevel(\+A, mapa, levelset)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine solvers\+::addlevel (
\begin{DoxyParamCaption}
\item[{class({\bf matrix}), intent(in)}]{A, }
\item[{integer(kind=ikind), dimension(\+:), intent(inout)}]{mapa, }
\item[{type({\bf vrstvy}), intent(inout)}]{levelset}
\end{DoxyParamCaption}
)}\label{namespacesolvers_a123077149170b16937efcfe052ff5283}


prida vrstvu, predpoklada se, ze aspon jedna tam uz je 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & matice definujici graf\\
\hline
\mbox{\tt in,out}  & {\em mapa} & mapa povolujici jdnotlive vrcholy\\
\hline
\mbox{\tt in,out}  & {\em levelset} & uktualni sada vrstev \\
\hline
\end{DoxyParams}


Definition at line 2050 of file solvers.\+f90.


\begin{DoxyCode}
2050         \textcolor{keywordtype}{use }mtx
2052         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(in)} :: a
2054         \textcolor{keywordtype}{integer(kind=ikind)},\textcolor{keywordtype}{dimension(:)},\textcolor{keywordtype}{intent(inout)} :: mapa
2056         \textcolor{keywordtype}{type}(vrstvy), \textcolor{keywordtype}{intent(inout)} :: levelset
2057 
2058         \textcolor{keywordflow}{if} (levelset%nlev == 0) stop \textcolor{stringliteral}{"Chybna pouziti addlevel"}
2059         \textcolor{comment}{! posledni vrstva je v od levelset%levstart(nlev) do}
2060         \textcolor{comment}{! levelset%lesvstart(nlev+1)-1}
2061 
\end{DoxyCode}
\index{solvers@{solvers}!cg@{cg}}
\index{cg@{cg}!solvers@{solvers}}
\subsubsection[{cg(\+A, b, x, itmax1, reps1, ilev1, itfin1, repsfin1, ll1, ll2, cond1, opcnt1, errcode1)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public solvers\+::cg (
\begin{DoxyParamCaption}
\item[{class({\bf matrix}), intent(in)}]{A, }
\item[{real(kind=rkind), dimension(\+:), intent(in)}]{b, }
\item[{real(kind=rkind), dimension(\+:), intent(inout)}]{x, }
\item[{integer(kind=ikind), intent(in), optional}]{itmax1, }
\item[{real(kind=rkind), intent(in), optional}]{reps1, }
\item[{integer, intent(in), optional}]{ilev1, }
\item[{integer(kind=ikind), intent(out), optional}]{itfin1, }
\item[{real(kind=rkind), intent(out), optional}]{repsfin1, }
\item[{real(kind=rkind), intent(out), optional}]{ll1, }
\item[{real(kind=rkind), intent(out), optional}]{ll2, }
\item[{real(kind=rkind), intent(out), optional}]{cond1, }
\item[{type({\bf tcount}), intent(out), optional}]{opcnt1, }
\item[{integer, intent(out), optional}]{errcode1}
\end{DoxyParamCaption}
)}\label{namespacesolvers_a3f42c7320ceede904a3ea977a89693cf}


metoda sdruzenych gradientu \doxyref{Metoda sdruzenych gradientu}{p.}{cg} 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & matice soustavy~\newline
 musi poskytovat getn, getm, mul (nasobeni vektorem)\\
\hline
\mbox{\tt in}  & {\em b} & vektor prave strany\\
\hline
\mbox{\tt in,out}  & {\em x} & aproximace reseni, postupne menena\\
\hline
\mbox{\tt in}  & {\em itmax1} & maximalni povoleny pocet iteraci, default = n ( Rozmer matice)\\
\hline
\mbox{\tt in}  & {\em reps1} & pozadovana relativni zmena rezidua, default = 1e-\/6\\
\hline
\mbox{\tt in}  & {\em ilev1} & informacni podrobnost~\newline

\begin{DoxyItemize}
\item 0 ... pracuj tise
\item 1 ... minimalni informace
\item 10 ... maximalni ukecanost
\end{DoxyItemize}\\
\hline
\mbox{\tt out}  & {\em itfin1} & skutecne provedeny pocet iteraci\\
\hline
\mbox{\tt out}  & {\em repsfin1} & skutecne dosazena relativni zmena residua\\
\hline
\mbox{\tt out}  & {\em ll1} & odhad nejvetsiho vlastniho cisla\\
\hline
\mbox{\tt out}  & {\em ll2} & odhad nejmensiho vlastniho cisla\\
\hline
\mbox{\tt out}  & {\em cond1} & odhad cisla podminenosti \+: cond1 = ll1/ll2\\
\hline
\mbox{\tt out}  & {\em opcnt1} & celkovy pocet provedenych operaci a cas behu\\
\hline
\mbox{\tt out}  & {\em errcode1} & kod pripadne chyby
\begin{DoxyItemize}
\item 0 ... OK
\item 1 ... matice neni ctvercova
\item 2 ... nesouhlasi b
\item 3 ... nesouhasi x
\item 4 ... ani jeden z vektoru nesouhlasi
\item 5 ... vycerpan povoleny pocet iteraci
\item 6 ... prestalo klesat residuum i energie 
\end{DoxyItemize}\\
\hline
\end{DoxyParams}


Definition at line 1245 of file solvers.\+f90.



References esteig().



Referenced by solver\+\_\+interfaces\+::cg\+\_\+face().


\begin{DoxyCode}
1245         \textcolor{keywordtype}{use }mtx
1246         \textcolor{keywordtype}{use }typy
1247         \textcolor{keywordtype}{implicit none}
1250         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(in)} :: a
1252         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: b
1254         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in out)} :: x
1256         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: itmax1
1258         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: reps1
1263         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: ilev1
1265         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: itfin1
1267         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: repsfin1
1269         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: ll1
1271         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: ll2
1273         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: cond1
1275         \textcolor{keywordtype}{type}(tcount), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: opcnt1
1284         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: errcode1
1285         \textcolor{keywordtype}{integer(kind=ikind)} :: itmax, cnt, n
1286         \textcolor{keywordtype}{integer} :: ilev,rcount, rcount1, errcode
1287         \textcolor{keywordtype}{real(kind=rkind)} :: reps, repsfin, r0, r1, r2,r3,l1,l2,t1,t2
1288         \textcolor{keywordtype}{real(kind=rkind)} :: wrk, en, enmin, res2min
1289         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: res,p,ap,&
1290         alfa, beta
1291         \textcolor{keywordtype}{type}(tcount) :: opcnt
1292 
1293         \textcolor{keyword}{call }cpu\_time(t1)
1294         errcode = 0
1295         n = a%getn()
1296         rcount = 0
1297         rcount1 = 0
1298         l1 = 1
1299         l2 = 1
1300         \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(errcode1)) errcode1 = 0
1301         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ilev1)) then
1302         ilev = ilev1
1303         else
1304             ilev = 0
1305 \textcolor{keyword}{        end }if
1306 
1307         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(itmax1)) then
1308         itmax = itmax1
1309         else
1310             itmax = a%getn()
1311             \textcolor{keywordflow}{if} (ilev==10) print *,&
1312             \textcolor{stringliteral}{"nastavuji default hodnotu pro itmax na"},itmax
1313 \textcolor{keyword}{        end }if
1314         \textcolor{keyword}{allocate}(alfa(0:itmax), beta(0:itmax))
1315         \textcolor{keywordflow}{if} (a%getn() /= a%getm()) then
1316             \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1317                 errcode1 = 1
1318                 \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"CG: Matice neni ctvercova"}
1319             return
1320             else
1321                 stop \textcolor{stringliteral}{"CG: Matice neni ctvercova"}
1322 \textcolor{keyword}{            end }if
1323 \textcolor{keyword}{        end }if
1324         \textcolor{keywordflow}{if} (a%getn() /= ubound(b,1)) then
1325             \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1326                 errcode1 = 2
1327             \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"CG : nesouhlasi delka prave strany"}
1328             else
1329                 stop \textcolor{stringliteral}{"CG: Nesouhlasi delka prave strany"}
1330 \textcolor{keyword}{            end }if
1331 \textcolor{keyword}{        end }if
1332         \textcolor{keywordflow}{if} (a%getm() /= ubound(x,1)) then
1333             \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1334                 \textcolor{keywordflow}{if} (errcode1==0) then
1335                     errcode1 = 3
1336                 \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"CG: nesouhlasi delka reseni"}
1337                 else
1338                     errcode1 = 4
1339                     \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"CG: nesouhlasi delky obou vektoru"}
1340 \textcolor{keyword}{                end }if
1341             else
1342                 stop \textcolor{stringliteral}{"CG: Nesouhlasi delka vektoru neznamych"}
1343 \textcolor{keyword}{            end }if
1344 \textcolor{keyword}{        end }if
1345         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1346             \textcolor{keywordflow}{if} (errcode1>0) return
1347 \textcolor{keyword}{        end }if
1348         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(reps1) ) then
1349         reps = reps1
1350         else
1351             reps = 1.0e-6
1352             \textcolor{keywordflow}{if} (ilev==10) print *,\textcolor{stringliteral}{"nastavuji reps na defaultni hodnotu "}&
1353             , reps
1354 \textcolor{keyword}{        end }if
1355         \textcolor{comment}{! ted uz je snad vyrizeno vsechno ze vstupu}
1356         \textcolor{comment}{! jdu pocitat}
1357         cnt = 0
1358         \textcolor{comment}{!! Step 1}
1359         res = b - a%mul(x,opcnt)
1360         r2 = dot_product(res,res)
1361         r0 = r2
1362         p = res
1363         opcnt%ad  = n-1
1364         opcnt%mul = n
1365         \textcolor{comment}{!! Step 2}
1366         do
1367             \textcolor{comment}{!! Step 3}
1368             ap =a%mul(p,opcnt)
1369             r1 = dot_product(p,ap)
1370             wrk = r2/r1
1371             \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"alfa="},wrk
1372             alfa(cnt) = wrk
1373             \textcolor{comment}{! tenhle usek je jen kvuli vypoctu energie}
1374             en = -dot_product(x,b+res) \textcolor{comment}{! je to vychozi energie}
1375             \textcolor{comment}{!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!}
1376             \textcolor{comment}{!! Step 4}
1377             x = x + wrk*p
1378             \textcolor{comment}{!! Step 5}
1379             res = res - wrk*ap
1380             \textcolor{comment}{!! Step 6}
1381             r3 = r2
1382             r2 = dot_product(res,res)
1383             wrk = r2/r3
1384             \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"beta="},wrk
1385             beta(cnt) = wrk
1386             \textcolor{comment}{!! Step 7}
1387             p = res + wrk*p
1388             opcnt%ad  = opcnt%ad  + 4*n-2 + 2*n-1
1389             opcnt%mul = opcnt%mul + 4*n   + n
1390             opcnt%div = opcnt%div + 1
1391 
1392             \textcolor{comment}{!! odhadnout vlastni cisla}
1393             \textcolor{keyword}{call }esteig(l1,l2,cnt,alfa,beta)
1394             print *, \textcolor{stringliteral}{"odhad vl. cisel:"},l1,l2
1395             \textcolor{comment}{!! hotovo}
1396 
1397             cnt = cnt + 1
1398             \textcolor{keywordflow}{if} (cnt==1) then
1399                 enmin = en
1400                 res2min = r2
1401                 \textcolor{keywordflow}{if} (r0==0.0\_rkind) then
1402                     repsfin=0
1403                     exit
1404 \textcolor{keyword}{                end }if
1405 \textcolor{keyword}{            end }if
1406             \textcolor{keywordflow}{if} (en < enmin) then
1407                 rcount = 0
1408             enmin = en
1409             else
1410                 rcount = rcount+1
1411 \textcolor{keyword}{            end }if
1412             \textcolor{keywordflow}{if} (r2 < res2min) then
1413                 res2min = r2
1414             rcount1 = 0
1415             else
1416                 rcount1 = rcount1+1
1417 \textcolor{keyword}{            end }if
1418             \textcolor{keywordflow}{if} (ilev>0)  print *, cnt,sqrt(r2), reps, en, enmin
1419             \textcolor{keywordflow}{if} (cnt == itmax) then
1420                 errcode = 5
1421                 exit
1422 \textcolor{keyword}{            end }if
1423             repsfin = sqrt(r2/r0)
1424             \textcolor{keywordflow}{if} (repsfin < reps) exit
1425             \textcolor{keywordflow}{if} ((rcount1>5) .and. (rcount > 5)) then
1426                 errcode = 6
1427                 exit
1428 \textcolor{keyword}{            end }if
1429 \textcolor{keyword}{        end }do
1430 
1431         \textcolor{keyword}{call }cpu\_time(t2)
1432         opcnt%time = t2-t1
1433         \textcolor{comment}{! vyridit konec}
1434         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(opcnt1)) opcnt1 = opcnt
1435         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) errcode1 = errcode
1436         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(itfin1)) itfin1 = cnt
1437         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(repsfin1)) repsfin1 = repsfin
1438         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ll1)) ll1 = l1
1439         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ll2)) ll2 = l2
1440         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(cond1)) cond1 = l1/l2
1441 
1442 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=344pt]{namespacesolvers_a3f42c7320ceede904a3ea977a89693cf_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=242pt]{namespacesolvers_a3f42c7320ceede904a3ea977a89693cf_icgraph}
\end{center}
\end{figure}


\index{solvers@{solvers}!cgnormal@{cgnormal}}
\index{cgnormal@{cgnormal}!solvers@{solvers}}
\subsubsection[{cgnormal(\+A, b, x, itmax1, reps1, ilev1, itfin1, repsfin1, ll1, ll2, cond1, opcnt1, errcode1)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public solvers\+::cgnormal (
\begin{DoxyParamCaption}
\item[{class({\bf matrix}), intent(in)}]{A, }
\item[{real(kind=rkind), dimension(\+:), intent(in)}]{b, }
\item[{real(kind=rkind), dimension(\+:), intent(inout)}]{x, }
\item[{integer(kind=ikind), intent(in), optional}]{itmax1, }
\item[{real(kind=rkind), intent(in), optional}]{reps1, }
\item[{integer, intent(in), optional}]{ilev1, }
\item[{integer(kind=ikind), intent(out), optional}]{itfin1, }
\item[{real(kind=rkind), intent(out), optional}]{repsfin1, }
\item[{real(kind=rkind), intent(out), optional}]{ll1, }
\item[{real(kind=rkind), intent(out), optional}]{ll2, }
\item[{real(kind=rkind), intent(out), optional}]{cond1, }
\item[{type({\bf tcount}), intent(out), optional}]{opcnt1, }
\item[{integer, intent(out), optional}]{errcode1}
\end{DoxyParamCaption}
)}\label{namespacesolvers_a4b33a4dc733829b9eb0161a9c08fec72}


metoda sdruzenych gradientu pro normalni rovnice \doxyref{Metoda sdruzenych gradientu pro normalni rovnice}{p.}{cgn} 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & matice soustavy~\newline
 musi poskytovat getn, getm, mul (nasobeni vektorem)\\
\hline
\mbox{\tt in}  & {\em b} & vektor prave strany\\
\hline
\mbox{\tt in,out}  & {\em x} & aproximace reseni, postupne menena\\
\hline
\mbox{\tt in}  & {\em itmax1} & maximalni povoleny pocet iteraci, default = n ( Rozmer matice)\\
\hline
\mbox{\tt in}  & {\em reps1} & pozadovana relativni zmena rezidua, default = 1e-\/6\\
\hline
\mbox{\tt in}  & {\em ilev1} & informacni podrobnost~\newline

\begin{DoxyItemize}
\item 0 ... pracuj tise
\item 1 ... minimalni informace
\item 10 ... maximalni ukecanost
\end{DoxyItemize}\\
\hline
\mbox{\tt out}  & {\em itfin1} & skutecne provedeny pocet iteraci\\
\hline
\mbox{\tt out}  & {\em repsfin1} & skutecne dosazena relativni zmena residua\\
\hline
\mbox{\tt out}  & {\em ll1} & odhad nejvetsiho vlastniho cisla\\
\hline
\mbox{\tt out}  & {\em ll2} & odhad nejmensiho vlastniho cisla\\
\hline
\mbox{\tt out}  & {\em cond1} & odhad cisla podminenosti \+: cond1 = ll1/ll2\\
\hline
\mbox{\tt out}  & {\em opcnt1} & celkovy pocet provedenych operaci a cas behu\\
\hline
\mbox{\tt out}  & {\em errcode1} & kod pripadnr chyby
\begin{DoxyItemize}
\item 0 ... OK
\item 1 ... matice neni ctvercova
\item 2 ... nesouhlasi b
\item 3 ... nesouhasi x
\item 4 ... ani jeden z vektoru nesouhlasi
\item 5 ... vycerpan povoleny pocet iteraci
\item 6 ... prestalo klesat residuum i energie 
\end{DoxyItemize}\\
\hline
\end{DoxyParams}


Definition at line 1476 of file solvers.\+f90.



Referenced by solver\+\_\+interfaces\+::cg\+\_\+normal\+\_\+face().


\begin{DoxyCode}
1476         \textcolor{keywordtype}{use }mtx
1477         \textcolor{keywordtype}{use }typy
1478         \textcolor{keywordtype}{implicit none}
1481         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(in)} :: a
1483         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: b
1485         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in out)} :: x
1487         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: itmax1
1489         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: reps1
1494         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: ilev1
1496         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: itfin1
1498         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: repsfin1
1500         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: ll1
1502         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: ll2
1504         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: cond1
1506         \textcolor{keywordtype}{type}(tcount), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: opcnt1
1515         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: errcode1
1516         \textcolor{keywordtype}{integer(kind=ikind)} :: itmax, cnt, n
1517         \textcolor{keywordtype}{integer} :: ilev,rcount, rcount1, errcode
1518         \textcolor{keywordtype}{real(kind=rkind)} :: reps, repsfin, r0, r1, r2,r3,l1,l2,t1,t2
1519         \textcolor{keywordtype}{real(kind=rkind)} :: wrk, en, enmin, res2min
1520         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: res,p,ap,&
1521         alfa, beta,&
1522         res1, b1
1523         \textcolor{keywordtype}{type}(tcount) :: opcnt
1524 
1525         \textcolor{keyword}{call }cpu\_time(t1)
1526         \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(errcode1)) errcode1 = 0
1527         errcode = 0
1528         n = a%getn()
1529         rcount = 0
1530         rcount1 = 0
1531         l1 = 1
1532         l2 = 1
1533         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ilev1)) then
1534         ilev = ilev1
1535         else
1536             ilev = 0
1537 \textcolor{keyword}{        end }if
1538 
1539         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(itmax1)) then
1540         itmax = itmax1
1541         else
1542             itmax = a%getn()
1543             \textcolor{keywordflow}{if} (ilev==10) print *,&
1544             \textcolor{stringliteral}{"nastavuji default hodnotu pro itmax na"},itmax
1545 \textcolor{keyword}{        end }if
1546         \textcolor{keyword}{allocate}(alfa(0:itmax), beta(0:itmax))
1547         \textcolor{keywordflow}{if} (a%getn() /= ubound(b,1)) then
1548             \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1549                 errcode1 = 2
1550             \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"CGnormal : nesouhlasi delka prave strany"}
1551             else
1552                 stop \textcolor{stringliteral}{"CGnormal: Nesouhlasi delka prave strany"}
1553 \textcolor{keyword}{            end }if
1554 \textcolor{keyword}{        end }if
1555         \textcolor{keywordflow}{if} (a%getm() /= ubound(x,1)) then
1556             \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1557                 \textcolor{keywordflow}{if} (errcode1==0) then
1558                     errcode1 = 3
1559                 \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"CGnormal: nesouhlasi delka reseni"}
1560                 else
1561                     errcode1 = 4
1562                     \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"CGnormal: nesouhlasi delky obou vektoru"}
1563 \textcolor{keyword}{                end }if
1564             else
1565                 stop \textcolor{stringliteral}{"CGnormal: Nesouhlasi delka vektoru neznamych"}
1566 \textcolor{keyword}{            end }if
1567 \textcolor{keyword}{        end }if
1568         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1569             \textcolor{keywordflow}{if} (errcode1>0) return
1570 \textcolor{keyword}{        end }if
1571         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(reps1) ) then
1572         reps = reps1
1573         else
1574             reps = 1.0e-6
1575             \textcolor{keywordflow}{if} (ilev==10) print *,\textcolor{stringliteral}{"nastavuji reps na defaultni hodnotu "}&
1576             , reps
1577 \textcolor{keyword}{        end }if
1578         \textcolor{comment}{! ted uz je snad vyrizeno vsechno ze vstupu}
1579         \textcolor{comment}{! jdu pocitat}
1580         cnt = 0
1581         \textcolor{comment}{!! Step 1}
1582         b1 = a%mult(b)
1583         res = b - a%mul(x,opcnt)
1584         res = a%mult(res,opcnt)
1585         r2 = dot_product(res,res)
1586         r0 = r2
1587         p = res
1588         opcnt%ad  = n-1
1589         opcnt%mul = n
1590         \textcolor{comment}{!! Step 2}
1591         do
1592             \textcolor{comment}{!! Step 3}
1593             ap =a%mul(p,opcnt)
1594             r1 = dot_product(ap,ap)
1595             wrk = r2/r1
1596             \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"alfa="},wrk
1597             alfa(cnt) = wrk
1598             \textcolor{comment}{! tenhle usek je jen kvuli vypoctu energie}
1599             en = -dot_product(x,b1+res) \textcolor{comment}{! je to vychozi energie}
1600             \textcolor{comment}{!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!}
1601             \textcolor{comment}{!! Step 4}
1602             x = x + wrk*p
1603             \textcolor{comment}{!! Step 5}
1604             res = res - wrk*a%mult(ap,opcnt)
1605             \textcolor{comment}{!! Step 6}
1606             r3 = r2
1607             r2 = dot_product(res,res)
1608             wrk = r2/r3
1609             \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"beta="},wrk
1610             beta(cnt) = wrk
1611             \textcolor{comment}{!! Step 7}
1612             p = res + wrk*p
1613             opcnt%ad  = opcnt%ad  + 4*n-2 + 2*n-1
1614             opcnt%mul = opcnt%mul + 4*n   + n
1615             opcnt%div = opcnt%div + 1
1616 
1617             \textcolor{comment}{!! odhadnout vlastni cisla}
1618 \textcolor{comment}{!             call esteig(l1,l2,cnt,alfa,beta)}
1619 \textcolor{comment}{!             print *, "odhad vl. cisel:",l1,l2}
1620             \textcolor{comment}{!! hotovo}
1621 
1622             cnt = cnt + 1
1623             \textcolor{keywordflow}{if} (cnt==1) then
1624                 enmin = en
1625                 res2min = r2
1626                 \textcolor{keywordflow}{if} (r0==0.0\_rkind) then
1627                     repsfin=0
1628                     exit
1629 \textcolor{keyword}{                end }if
1630 \textcolor{keyword}{            end }if
1631             \textcolor{keywordflow}{if} (en < enmin) then
1632                 rcount = 0
1633             enmin = en
1634             else
1635                 rcount = rcount+1
1636 \textcolor{keyword}{            end }if
1637             \textcolor{keywordflow}{if} (r2 < res2min) then
1638                 res2min = r2
1639             rcount1 = 0
1640             else
1641                 rcount1 = rcount1+1
1642 \textcolor{keyword}{            end }if
1643             \textcolor{keywordflow}{if} (ilev>0)  print *, cnt,sqrt(r2), reps, en, enmin
1644             \textcolor{keywordflow}{if} (cnt == itmax) then
1645                 errcode = 5
1646                 exit
1647 \textcolor{keyword}{            end }if
1648             repsfin = sqrt(r2/r0)
1649             \textcolor{keywordflow}{if} (repsfin < reps) exit
1650             \textcolor{keywordflow}{if} ((rcount1>5) .and. (rcount > 5)) then
1651                 errcode = 6
1652                 exit
1653 \textcolor{keyword}{            end }if
1654 \textcolor{keyword}{        end }do
1655 
1656         \textcolor{keyword}{call }cpu\_time(t2)
1657         opcnt%time = t2-t1
1658         \textcolor{comment}{! vyridit konec}
1659         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(opcnt1)) opcnt1 = opcnt
1660         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) errcode1 = errcode
1661         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(itfin1)) itfin1 = cnt
1662         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(repsfin1)) repsfin1 = repsfin
1663         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ll1)) ll1 = l1  \textcolor{comment}{! tohle zatim nepocita}
1664         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ll2)) ll2 = l2
1665         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(cond1)) cond1 = l1/l2
1666 
1667 
1668 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacesolvers_a4b33a4dc733829b9eb0161a9c08fec72_icgraph}
\end{center}
\end{figure}


\index{solvers@{solvers}!esteig@{esteig}}
\index{esteig@{esteig}!solvers@{solvers}}
\subsubsection[{esteig(l1, l2, n, alfa, beta)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, private solvers\+::esteig (
\begin{DoxyParamCaption}
\item[{real(kind=rkind), intent(inout)}]{l1, }
\item[{real(kind=rkind), intent(inout)}]{l2, }
\item[{integer(kind=ikind), intent(in)}]{n, }
\item[{real(kind=rkind), dimension(0\+:), intent(in)}]{alfa, }
\item[{real(kind=rkind), dimension(0\+:), intent(in)}]{beta}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespacesolvers_a02123ec53b1506ac8bf72231f8a96839}


Definition at line 1952 of file solvers.\+f90.



References vycdet().



Referenced by cg(), and pcg().


\begin{DoxyCode}
1952         \textcolor{keywordtype}{use }typy
1953         \textcolor{keywordtype}{implicit none}
1954         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in out)} :: l1
1955         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in out)} :: l2
1956         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: n
1957         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(0:)}, \textcolor{keywordtype}{intent(in)} :: alfa
1958         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(0:)}, \textcolor{keywordtype}{intent(in)} :: beta
1959 
1960         \textcolor{keywordtype}{real(kind=rkind)} :: x1,x2,x3,y1,y2,y3,d1,d2
1961 
1962         \textcolor{keywordflow}{if} (n==0) then
1963             l1 = 1/alfa(0)
1964         l2 = l1
1965         else
1966             \textcolor{comment}{!odhadneme nejmensi}
1967             x1 = 0
1968             y1 = vycdet(x1,alfa,beta,n)
1969             x2 = l2
1970             y2 = vycdet(x2,alfa,beta,n)
1971             \textcolor{keywordflow}{if} (y1*y2>0) print *, \textcolor{stringliteral}{"podivne"}
1972             d1 =x2-x1
1973             d2 = 2*d1
1974             \textcolor{keywordflow}{do} \textcolor{keywordflow}{while} (d1 < d2)
1975                 d2 = d1
1976                 x3 = (x1+x2)/2
1977                 y3 = vycdet(x3,alfa,beta,n)
1978                 \textcolor{keywordflow}{if} (y3*y1 > 0) then
1979                     x1 = x3
1980                 y1 = y3
1981                 else
1982                     x2 = x3
1983                     y2 = y3
1984 \textcolor{keyword}{                end }if
1985                 d1 = x2 - x1
1986 \textcolor{keyword}{            end }do
1987             l2 = x3
1988             \textcolor{comment}{!odhadneme nejvetsi}
1989             x1 = l1
1990             y1 = vycdet(x1,alfa,beta,n)
1991             d1 = 0.00000000001
1992             x2 = x1+d1
1993             y2 = vycdet(x2,alfa,beta,n)
1994             \textcolor{keywordflow}{do} \textcolor{keywordflow}{while} (y1*y2>0)
1995                 x1 = x2
1996                 y1 = y2
1997                 d1 = d1+d1
1998                 x2 = x1+d1
1999                 y2 = vycdet(x2,alfa,beta,n)
2000 \textcolor{keyword}{            end }do
2001             d1 =x2-x1
2002             d2 = 2*d1
2003             \textcolor{keywordflow}{do} \textcolor{keywordflow}{while} (d1 < d2)
2004                 d2 = d1
2005                 x3 = (x1+x2)/2
2006                 y3 = vycdet(x3,alfa,beta,n)
2007                 \textcolor{keywordflow}{if} (y3*y1 > 0) then
2008                     x1 = x3
2009                 y1 = y3
2010                 else
2011                     x2 = x3
2012                     y2 = y3
2013 \textcolor{keyword}{                end }if
2014                 d1 = x2 - x1
2015 \textcolor{keyword}{            end }do
2016             l1 = x3
2017 \textcolor{keyword}{        end }if
2018 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=243pt]{namespacesolvers_a02123ec53b1506ac8bf72231f8a96839_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacesolvers_a02123ec53b1506ac8bf72231f8a96839_icgraph}
\end{center}
\end{figure}


\index{solvers@{solvers}!firstpoint@{firstpoint}}
\index{firstpoint@{firstpoint}!solvers@{solvers}}
\subsubsection[{firstpoint(levelset, point)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine solvers\+::firstpoint (
\begin{DoxyParamCaption}
\item[{type({\bf vrstvy}), intent(inout)}]{levelset, }
\item[{integer(kind=ikind)}]{point}
\end{DoxyParamCaption}
)}\label{namespacesolvers_a725799257b3a87e003abbace5a9b7b90}


vlozi prvni vrchol, v tomto pripade nepotrebuje matici 



Definition at line 2039 of file solvers.\+f90.


\begin{DoxyCode}
2039         \textcolor{keywordtype}{implicit none}
2040         \textcolor{keywordtype}{type}(vrstvy), \textcolor{keywordtype}{intent(in out)} :: levelset
2041         \textcolor{keywordtype}{integer(kind=ikind)} :: point
2042         levelset%nlev = 1
2043         levelset%levstart(1) = 1
2044         levelset%levstart(2) = 2
2045         levelset%levlist(1) = point
\end{DoxyCode}
\index{solvers@{solvers}!gs@{gs}}
\index{gs@{gs}!solvers@{solvers}}
\subsubsection[{gs(a, b, x, maxit, reps, it, repsfin, l1, l2, countop, ilev)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public solvers\+::gs (
\begin{DoxyParamCaption}
\item[{class({\bf matrix}), intent(in)}]{a, }
\item[{real(kind=rkind), dimension(\+:), intent(in)}]{b, }
\item[{real(kind=rkind), dimension(\+:), intent(inout)}]{x, }
\item[{integer(kind=ikind), intent(in)}]{maxit, }
\item[{real(kind=rkind), intent(in)}]{reps, }
\item[{integer(kind=ikind), intent(out)}]{it, }
\item[{real(kind=rkind), intent(out)}]{repsfin, }
\item[{real(kind=rkind), intent(out)}]{l1, }
\item[{real(kind=rkind), intent(out)}]{l2, }
\item[{type({\bf tcount}), intent(inout), optional}]{countop, }
\item[{integer, intent(in), optional}]{ilev}
\end{DoxyParamCaption}
)}\label{namespacesolvers_ae3b9cf3689487a408b5ce257094b70c0}


Gauss-\/\+Seidelova metoda. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & matice soustavy\\
\hline
\mbox{\tt in}  & {\em b} & prava strana\\
\hline
\mbox{\tt in,out}  & {\em x} & pocitane reseni soustavy\\
\hline
\mbox{\tt in}  & {\em maxit} & maximalni povoleny pocet iteraci\\
\hline
\mbox{\tt in}  & {\em reps} & pozadovane relativni residuum\\
\hline
\mbox{\tt out}  & {\em it} & skutecny pocet iteraci\\
\hline
\mbox{\tt out}  & {\em repsfin} & skutecne relativni residuum\\
\hline
\mbox{\tt out}  & {\em l1} & odhad rychlosti konvergence pomoci mocninne metody\\
\hline
\mbox{\tt out}  & {\em l2} & odhad rychlosti konvergence pomoci odmocniny\\
\hline
\mbox{\tt in,out}  & {\em countop} & pocitadlo operaci\\
\hline
\mbox{\tt in}  & {\em ilev} & podrobnost informaci \\
\hline
\end{DoxyParams}


Definition at line 190 of file solvers.\+f90.



References typy\+::norm2().


\begin{DoxyCode}
190         \textcolor{keywordtype}{use }typy
191         \textcolor{keywordtype}{use }mtx
192         \textcolor{keywordtype}{implicit none}
194         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(in)} :: a
196         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: b
198         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(inout)} :: x
200         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: maxit
202         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)} :: reps
204         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(out)} :: it
206         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)} :: repsfin
208         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)} :: l1
210         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)} :: l2
212         \textcolor{keywordtype}{type}(tcount), \textcolor{keywordtype}{intent(inout)}, \textcolor{keywordtype}{optional} :: countop
214         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: ilev
215 
216         \textcolor{keywordtype}{real(kind=rkind)} :: r0,r1,r2, wrk
217         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: r,diag
218         \textcolor{keywordtype}{integer(kind=ikind)} :: i,j,k
219         \textcolor{keywordtype}{type}(tcount) :: countop1
220         \textcolor{keywordtype}{real(kind=rkind)} :: t1, t2
221 
222         \textcolor{keyword}{call }cpu\_time(t1)
223         \textcolor{keyword}{allocate}(r(1:a%getn()))
224         \textcolor{keyword}{allocate}(diag(1:a%getn()))
225         r=b-a%mul(x,countop1)
226         r0 = norm2(r)
227         countop1%ad = countop1%ad + a%getn()
228         \textcolor{keywordflow}{do} i=1,a%getn()
229             diag(i) = a%get(i,i)
230 \textcolor{keyword}{        end }do
231         it = 0
232         r1 = r0
233         r2 = r0
234         do
235             \textcolor{comment}{!!!!!!!! predelet -}
236             \textcolor{keywordflow}{if} ( it > maxit ) exit
237             repsfin = r1/r0
238             \textcolor{keywordflow}{if} (r1 /= 0) then
239                 l1 = r1/r2
240                 l2 = repsfin**(1.0\_rkind/it)
241 \textcolor{keyword}{            end }if
242             \textcolor{keywordflow}{if} ( ilev > 0 )  print\textcolor{stringliteral}{"(i16,4ES18.10)"}, it, r0,r1,l1,l2
243             \textcolor{keywordflow}{if} ( repsfin < reps) exit
244             r2 = r1
245             r1 = 0
246             \textcolor{keywordflow}{do} i=1, a%getn()
247                 wrk =b(i) - a%mulrow(x,i,countop1)
248                 r1 = r1 + wrk*wrk
249                 x(i) =x(i) + wrk/diag(i)
250 \textcolor{keyword}{            end }do
251             r1 = sqrt(r1)
252             countop1%ad  = countop1%ad  + a%getn()*2
253             countop1%div = countop1%div + a%getn()
254             it = it + 1
255 \textcolor{keyword}{        end }do
256         \textcolor{keyword}{deallocate}(r,diag)
257         \textcolor{keyword}{call }cpu\_time(t2)
258         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(countop)) then
259             countop%ad  = countop%ad  + countop1%ad
260             countop%mul = countop%mul + countop1%mul
261             countop%div = countop%div + countop1%div
262             countop%time = t2-t1
263 \textcolor{keyword}{        end }if
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=213pt]{namespacesolvers_ae3b9cf3689487a408b5ce257094b70c0_cgraph}
\end{center}
\end{figure}


\index{solvers@{solvers}!inivrstvy@{inivrstvy}}
\index{inivrstvy@{inivrstvy}!solvers@{solvers}}
\subsubsection[{inivrstvy(levelset, A)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine solvers\+::inivrstvy (
\begin{DoxyParamCaption}
\item[{type({\bf vrstvy}), intent(inout)}]{levelset, }
\item[{class({\bf matrix}), intent(in)}]{A}
\end{DoxyParamCaption}
)}\label{namespacesolvers_a0819046193527583492f485e4fac7c77}


inicializuje vrstvy 



Definition at line 2023 of file solvers.\+f90.


\begin{DoxyCode}
2023         \textcolor{keywordtype}{use }mtx
2024         \textcolor{keywordtype}{implicit none}
2025         \textcolor{keywordtype}{type}(vrstvy), \textcolor{keywordtype}{intent(in out)} :: levelset
2026         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(in)} :: a
2027         \textcolor{keywordtype}{integer(kind=ikind)} :: n
2028 
2029         n = a%getn()
2030         \textcolor{comment}{! jen pridelim pamet, neinicializuji}
2031         \textcolor{keyword}{allocate}(levelset%levlist(1:n))
2032         \textcolor{keyword}{allocate}(levelset%levstart(1:n+1))
2033         \textcolor{comment}{! pocet urovni je nula}
2034         levelset%nlev = 0
\end{DoxyCode}
\index{solvers@{solvers}!jacobi@{jacobi}}
\index{jacobi@{jacobi}!solvers@{solvers}}
\subsubsection[{jacobi(a, b, x, maxit1, reps1, it, repsfin, l1, l2, countop, ilev1)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public solvers\+::jacobi (
\begin{DoxyParamCaption}
\item[{class({\bf matrix}), intent(in)}]{a, }
\item[{real(kind=rkind), dimension(\+:), intent(in)}]{b, }
\item[{real(kind=rkind), dimension(\+:), intent(inout)}]{x, }
\item[{integer(kind=ikind), intent(in), optional}]{maxit1, }
\item[{real(kind=rkind), intent(in), optional}]{reps1, }
\item[{integer(kind=ikind), intent(out), optional}]{it, }
\item[{real(kind=rkind), intent(out), optional}]{repsfin, }
\item[{real(kind=rkind), intent(out), optional}]{l1, }
\item[{real(kind=rkind), intent(out), optional}]{l2, }
\item[{type({\bf tcount}), intent(inout), optional}]{countop, }
\item[{integer, intent(in), optional}]{ilev1}
\end{DoxyParamCaption}
)}\label{namespacesolvers_aea926a2b4b690d018a06ab48856ab0e7}


Jacobiova metoda. 

podrobnejsi popis viz \doxyref{Jacobiova metoda}{p.}{Jacobi}


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & matice soustavy\\
\hline
\mbox{\tt in}  & {\em b} & prava strana\\
\hline
\mbox{\tt in,out}  & {\em x} & pocitane reseni soustavy\\
\hline
\mbox{\tt in}  & {\em maxit1} & maximalni povoleny pocet iteraci\\
\hline
\mbox{\tt in}  & {\em reps1} & pozadovane relativni residuum\\
\hline
\mbox{\tt out}  & {\em it} & skutecny pocet iteraci\\
\hline
\mbox{\tt out}  & {\em repsfin} & skutecne relativni residuum\\
\hline
\mbox{\tt out}  & {\em l1} & odhad rychlosti konvergence pomoci mocninne metody\\
\hline
\mbox{\tt out}  & {\em l2} & odhad rychlosti konvergence pomoci odmocniny\\
\hline
\mbox{\tt in,out}  & {\em countop} & pocitadlo operaci\\
\hline
\mbox{\tt in}  & {\em ilev1} & podrobnost informaci \\
\hline
\end{DoxyParams}


Definition at line 78 of file solvers.\+f90.



References typy\+::norm2(), and typy\+::r4.



Referenced by solver\+\_\+interfaces\+::jacobi\+\_\+face().


\begin{DoxyCode}
78         \textcolor{keywordtype}{use }typy, r4x=>r4
79         \textcolor{keywordtype}{use }mtx
80         \textcolor{keywordtype}{implicit none}
82         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(in)} :: a
84         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: b
86         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(inout)} :: x
88         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)},\textcolor{keywordtype}{optional} :: maxit1
90         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: reps1
92         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: it
94         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: repsfin
96         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: l1
98         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: l2
100         \textcolor{keywordtype}{type}(tcount), \textcolor{keywordtype}{intent(inout)}, \textcolor{keywordtype}{optional} :: countop
102         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: ilev1
103 
104         \textcolor{keywordtype}{integer(kind=ikind)} :: maxit,it1, ilev
105         \textcolor{keywordtype}{real(kind=rkind)} :: reps
106         \textcolor{keywordtype}{real(kind=rkind)} :: r0,r1,r2, repsfin1
107         \textcolor{keywordtype}{real(kind=rkind)} :: ll1,ll2
108         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: r,diag
109         \textcolor{keywordtype}{integer(kind=ikind)} :: i,n
110         \textcolor{keywordtype}{type}(tcount) :: countop1
111         \textcolor{keywordtype}{real(kind=rkind)} :: t1, t2
112 
113         \textcolor{comment}{!print *,"jacobi zacina"}
114         \textcolor{keyword}{call }cpu\_time(t1)
115         \textcolor{comment}{!! vyresime nepovinne parametry}
116         n = a%getn()
117         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(maxit1)) then
118         maxit = maxit1
119         else
120             maxit = n
121 \textcolor{keyword}{        end }if
122         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(reps1)) then
123         reps = reps1
124         else
125             reps = 1.0e-6
126 \textcolor{keyword}{        end }if
127         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ilev1)) then
128         ilev = ilev1
129         else
130             ilev = 0
131 \textcolor{keyword}{        end }if
132 
133         \textcolor{comment}{!print *, "nepovinne vyseny"}
134         \textcolor{keyword}{allocate}(r(1:a%getn()))
135         \textcolor{keyword}{allocate}(diag(1:a%getn()))
136         r=b-a%mul(x,countop1)
137         r0 = norm2(r)
138         countop1%ad = countop1%ad + a%getn()
139         \textcolor{keywordflow}{do} i=1,a%getn()
140             diag(i) = a%get(i,i)
141 \textcolor{keyword}{        end }do
142         it1 = 0
143         \textcolor{comment}{!print *,"pripraveno"}
144         do
145             \textcolor{keywordflow}{if} ( it1 > maxit ) exit
146             r1 = norm2(r)
147             repsfin1 = r1/r0
148             \textcolor{keywordflow}{if} (r1 /= 0) then
149                 ll1 = r1/r2
150                 ll2 = repsfin1**(1.0\_rkind/it1)
151 \textcolor{keyword}{            end }if
152             \textcolor{keywordflow}{if} ( ilev > 0 )  print\textcolor{stringliteral}{"(i16,4ES18.10)"}, it1, r0,r1,ll1,ll2
153             \textcolor{keywordflow}{if} ( repsfin1 < reps) exit
154             \textcolor{keywordflow}{do} i=1, a%getn()
155                 x(i) = x(i) + r(i)/diag(i)
156 \textcolor{keyword}{            end }do
157             r=b-a%mul(x,countop1)
158             countop1%ad  = countop1%ad  + 2*a%getn()
159             countop1%div = countop1%div +   a%getn()
160             it1 = it1 + 1
161             r2  = r1
162 \textcolor{keyword}{        end }do
163         \textcolor{keyword}{deallocate}(r,diag)
164         \textcolor{keyword}{call }cpu\_time(t2)
165         \textcolor{comment}{!print *,"jacobi konci"}
166         \textcolor{comment}{! vyresime navratove hodnoty}
167         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(countop)) then
168             countop%ad  = countop%ad  + countop1%ad
169             countop%mul = countop%mul + countop1%mul
170             countop%div = countop%div + countop1%div
171             countop%time = t2-t1
172 \textcolor{keyword}{        end }if
173         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(it)) it = it1
174         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(repsfin)) repsfin = repsfin1
175         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(l1)) l1 = ll1
176         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(l2)) l2 = ll2
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=228pt]{namespacesolvers_aea926a2b4b690d018a06ab48856ab0e7_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=257pt]{namespacesolvers_aea926a2b4b690d018a06ab48856ab0e7_icgraph}
\end{center}
\end{figure}


\index{solvers@{solvers}!ldu@{ldu}}
\index{ldu@{ldu}!solvers@{solvers}}
\subsubsection[{ldu(\+A, L\+U, info, pivtype, ilev, perm1, perm2)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public solvers\+::ldu (
\begin{DoxyParamCaption}
\item[{class({\bf matrix}), intent(in)}]{A, }
\item[{class({\bf matrix}), intent(inout)}]{LU, }
\item[{type({\bf tcount}), intent(inout), optional}]{info, }
\item[{integer, intent(in), optional}]{pivtype, }
\item[{integer, intent(in), optional}]{ilev, }
\item[{integer(kind=ikind), dimension(\+:), intent(inout), optional, allocatable}]{perm1, }
\item[{integer(kind=ikind), dimension(\+:), intent(inout), optional, allocatable}]{perm2}
\end{DoxyParamCaption}
)}\label{namespacesolvers_a1fb8d3f54b1edc529946756f819b93cc}


nedestruktivni L\+DU rozklad 

pro volbu pivota plati nasledujici pravidla~\newline
 0 ... zadna~\newline
 1 ... uplny vyber hlavniho prvku (nutne obe permutace )~\newline
 2 ... sloupcovy vyber hlavniho prvku(nutno perm1)~\newline
 3 ... radkovy vyber hlavniho prvku(nutno perm2)~\newline
 4 ... diagonalni vyber hlavniho prvku(nutno aspon jedna = obe shodne)~\newline
 5 ... diagonalni vyber hlavniho prvku pro minimal degree~\newline
 (nutno aspon jedna = obe shodne) ~\newline
 6 ... rid se predepsanou permutaci~\newline
 Pro situace 1 az 6 musi byt pritomny permutacni vektory~\newline
 Pokud nejsou pozadavky splneny -\/ zvoli se nejpodobnejsi volba~\newline
 pro podrobnost informaci plati~\newline
 0 ... tichy chod~\newline
 1 ... super podrobne~\newline



\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & rozkladana matice\\
\hline
\mbox{\tt in,out}  & {\em lu} & rozlozena matice\\
\hline
\mbox{\tt in,out}  & {\em info} & pocty operaci\\
\hline
\mbox{\tt in}  & {\em pivtype} & typ pivotaze\\
\hline
\mbox{\tt in}  & {\em ilev} & podrobnost informaci\\
\hline
\mbox{\tt in,out}  & {\em perm1} & permutace pro i\\
\hline
\mbox{\tt in,out}  & {\em perm2} & permutace pro j \\
\hline
\end{DoxyParams}


Definition at line 291 of file solvers.\+f90.



References ldud().


\begin{DoxyCode}
291         \textcolor{keywordtype}{use }mtx
292         \textcolor{keywordtype}{use }typy
293         \textcolor{keywordtype}{implicit none}
295         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(in)} :: a
297         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(inout)} :: lu
299         \textcolor{keywordtype}{type}(tcount), \textcolor{keywordtype}{intent(inout)}, \textcolor{keywordtype}{optional} :: info
301         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: pivtype
303         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: ilev
305         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable}, &
306         \textcolor{keywordtype}{intent(inout)}, \textcolor{keywordtype}{optional} :: perm1
308         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable},&
309         \textcolor{keywordtype}{intent(inout)}, \textcolor{keywordtype}{optional} :: perm2
310 
311         \textcolor{keywordtype}{integer} :: pt1,il1
312         \textcolor{keywordtype}{integer(kind=ikind)},\textcolor{keywordtype}{dimension(:)},\textcolor{keywordtype}{allocatable} :: p1,p2
313         \textcolor{keywordtype}{type}(tcount) :: inf1
314 
315         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(pivtype)) then
316         pt1 = pivtype
317         else
318             pt1 = 0
319 \textcolor{keyword}{        end }if
320         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ilev)) then
321         il1 = ilev
322         else
323             il1 = 0
324 \textcolor{keyword}{        end }if
325         \textcolor{keyword}{allocate}(p1(1:a%getn()))
326         \textcolor{keyword}{allocate}(p2(1:a%getm()))
327         \textcolor{keywordflow}{select case}(pt1)
328                 \textcolor{keywordflow}{case} (0)
329                 print *, \textcolor{stringliteral}{"nula"}
330                 \textcolor{keywordflow}{case} (1)
331                 \textcolor{keywordflow}{case} (2)
332                 \textcolor{keywordflow}{case} (3)
333                 \textcolor{keywordflow}{case} (4)
334                 \textcolor{keywordflow}{case} (5)
335                 \textcolor{keywordflow}{case} (6)
336                     \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(perm1)) then
337                     else
338 \textcolor{keyword}{                    end }if
339 \textcolor{keywordflow}{                case default}
340                     print *,\textcolor{stringliteral}{"chybna volba"}
341 \textcolor{keyword}{                end }select
342 
343         \textcolor{keyword}{call }lu%copy(a)
344         print *,\textcolor{stringliteral}{"zkopirovano"}
345         \textcolor{keyword}{call }ldud(lu,inf1,pt1,il1,p1,p2)
346         \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(perm1) ) perm1 = p1
347         \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(perm2) ) perm2 = p2
348         \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(info) )  info  = inf1
349         \textcolor{keywordflow}{if} (il1 > 0) print *,\textcolor{stringliteral}{"LDU konci"}
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=317pt]{namespacesolvers_a1fb8d3f54b1edc529946756f819b93cc_cgraph}
\end{center}
\end{figure}


\index{solvers@{solvers}!lduback@{lduback}}
\index{lduback@{lduback}!solvers@{solvers}}
\subsubsection[{lduback(\+L\+D\+U, b, x, p1, p2, oc1, ilevel, errcode)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public solvers\+::lduback (
\begin{DoxyParamCaption}
\item[{class({\bf matrix}), intent(in)}]{L\+DU, }
\item[{real(kind=rkind), dimension(\+:), intent(in)}]{b, }
\item[{real(kind=rkind), dimension(\+:), intent(out)}]{x, }
\item[{integer(kind=ikind), dimension(\+:), intent(in), optional}]{p1, }
\item[{integer(kind=ikind), dimension(\+:), intent(in), optional}]{p2, }
\item[{type({\bf tcount}), intent(out), optional}]{oc1, }
\item[{integer, intent(in), optional}]{ilevel, }
\item[{integer, intent(out), optional}]{errcode}
\end{DoxyParamCaption}
)}\label{namespacesolvers_ab4c7314bf0d113f515e03150556b35bc}


Zpetny chod po L\+DU dekompozici. Predpoklada se, ze matice je ctvercova. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em ldu} & rozlozena matice\\
\hline
\mbox{\tt in}  & {\em b} & prava strana\\
\hline
\mbox{\tt in}  & {\em ilevel} & info level, nepovinny parametr, default = 0
\begin{DoxyItemize}
\item 0 ... pracuj tise
\item 1 ... vse reportuj
\end{DoxyItemize}\\
\hline
\mbox{\tt out}  & {\em errcode} & chybovy status, nepovinny. Pokud neni pritomen,tak chyba zpusobi konec programu
\begin{DoxyItemize}
\item 0 ... vse OK
\item 1 ... chyba -\/ blize neurcena
\item 2 ... lisi se delka b a pocet radku matice
\item 3 ... lisi se delka x a pocet sloupcu matice
\item 4 ... matice je singularni a soustava je konzistentni
\item 5 ... matice je singularni a soustava nekonzistentni 
\end{DoxyItemize}\\
\hline
\end{DoxyParams}


Definition at line 856 of file solvers.\+f90.



Referenced by solver\+\_\+interfaces\+::ldu\+\_\+face().


\begin{DoxyCode}
856         \textcolor{keywordtype}{use }typy
857         \textcolor{keywordtype}{use }mtx
858         \textcolor{keywordtype}{implicit none}
860         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(in)} :: ldu
862         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)}  :: b
863         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(out)} :: x
864         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: p1
865         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: p2
866         \textcolor{keywordtype}{type}(tcount), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: oc1
870         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: ilevel
879         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: errcode
880         \textcolor{keywordtype}{type}(tcount) :: oc
881         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: perm1, perm2
882         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: iperm1, iperm2
883         \textcolor{keywordtype}{integer(kind=ikind)} :: n,m,i,j, ip, ip2
884         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(1:LDU%getn())} :: diag
885         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: v
886         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: ii
887         \textcolor{keywordtype}{integer(kind=ikind)} :: nelem
888         \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{dimension(1:LDU%getn())} :: mask
889         \textcolor{keywordtype}{integer} :: ilv
890 
891         \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(ilevel)) then
892         ilv = ilevel
893         else
894             ilv = 0
895 \textcolor{keyword}{        end }if
896 
897         n = ldu%getn()
898         m = ldu%getm()
899         \textcolor{comment}{! vyresit optionaly}
900         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(p1)) then
901             \textcolor{keyword}{allocate}(perm1(1:n))
902         perm1 = p1
903         else
904             \textcolor{keyword}{allocate}(perm1(1:n))
905             \textcolor{keywordflow}{do} i=1,n
906                 perm1(i) = i
907 \textcolor{keyword}{            end }do
908 \textcolor{keyword}{        end }if
909         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(p2)) then
910             \textcolor{keyword}{allocate}(perm2(1:m))
911         perm2 = p2
912         else
913             \textcolor{keyword}{allocate}(perm2(1:m))
914             \textcolor{keywordflow}{do} i=1,m
915                 perm2(i) = i
916 \textcolor{keyword}{            end }do
917 \textcolor{keyword}{        end }if
918         \textcolor{comment}{! konstrukce inverznich permutaci}
919         \textcolor{keyword}{allocate}(iperm1(1:n),iperm2(1:m))
920         \textcolor{keywordflow}{do} i=1,n
921             iperm1(perm1(i))=i
922 \textcolor{keyword}{        end }do
923         \textcolor{keywordflow}{do} i=1,m
924             iperm2(perm2(i))=i
925 \textcolor{keyword}{        end }do
926 
927         \textcolor{keywordflow}{if} (ubound(b,1) /= n) then
928             \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(errcode) ) then
929             else
930                 errcode = 2
931                 stop \textcolor{stringliteral}{"LDUback: Pocet radku matice a prave strany se lisi"}
932 \textcolor{keyword}{            end }if
933 \textcolor{keyword}{        end }if
934 
935         \textcolor{keywordflow}{if} (ubound(x,1) /= n) then
936             \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(errcode) ) then
937             else
938                 errcode = 3
939                 stop \textcolor{stringliteral}{"LDUback: Pocet sloupcu matice a neznamych se lisi"}
940 \textcolor{keyword}{            end }if
941 \textcolor{keyword}{        end }if
942 
943         \textcolor{comment}{! 1. L y = b}
944         x = b
945         \textcolor{keywordflow}{if} ( ilv==1) then
946             print *, \textcolor{stringliteral}{"LDUback: zacatek"}
947             print *, \textcolor{stringliteral}{"ridici permutace"}
948             print *, perm1
949             print *, perm2
950             print *, \textcolor{stringliteral}{"Prava strana"}
951             print *,x
952 \textcolor{keyword}{        end }if
953         diag(perm2(1))=ldu%get(perm1(1),perm2(1))
954         mask = .false.
955         mask(perm2(1)) = .true.
956         \textcolor{keywordflow}{do} i = 2,n
957             ip = perm1(i)
958             ip2 = perm2(i)
959             diag(ip2)= ldu%get(ip,ip2)
960             \textcolor{keyword}{call }ldu%getrow(ip,v,ii,nelem,mask)
961             \textcolor{keywordflow}{if} (ilv==1) then
962                 print *, \textcolor{stringliteral}{"i="},i, ip, nelem, mask
963                 print *, ii(1:nelem)
964                 print *, v(1:nelem)
965 \textcolor{keyword}{            end }if
966             \textcolor{keywordflow}{do} j=1,nelem
967                 \textcolor{keywordflow}{if} ((ii(j)) == ip) then
968                     \textcolor{comment}{! jsem na diagonale}
969                 diag(ip2) = v(j)
970                 else
971                     \textcolor{keywordflow}{if} (ilv == 1) then
972                         print *, j, x(ip), v(j), x(ii(j)), ii(j)
973 \textcolor{keyword}{                    end }if
974                     x(ip) = x(ip) - v(j)*x(ii(j))
975                     \textcolor{keywordflow}{if} (ilv == 1) then
976                         print *, j, x(ip), v(j), x(ii(j)), ii(j)
977 \textcolor{keyword}{                    end }if
978 \textcolor{keyword}{                end }if
979 \textcolor{keyword}{            end }do
980             \textcolor{keywordflow}{if} (ilv == 1) then
981                 print *,perm1
982                 print *, perm2
983                 print *,ip,mask
984                 print *,ii
985                 print *,x
986 \textcolor{keyword}{            end }if
987             mask(ip2) = .true.
988 \textcolor{keyword}{        end }do
989         \textcolor{keywordflow}{if} (ilv == 1) then
990             print *, \textcolor{stringliteral}{"po primem chodu -------------------------------------"}
991             print *,x
992 \textcolor{keyword}{        end }if
993         \textcolor{comment}{! 2. D z = y}
994         x = x/diag  \textcolor{comment}{! tady zalezi na poradi, potreba prezkoumat}
995         \textcolor{keywordflow}{if} (ilv==1) then
996             print *, \textcolor{stringliteral}{"po deleni diagonalou --------------------------------"}
997             print *,x
998             print *, diag
999 \textcolor{keyword}{        end }if
1000         \textcolor{comment}{! 3. U x = z}
1001         mask = .false.
1002         mask(perm2(n)) = .true.
1003         \textcolor{keywordflow}{do} i=n-1,1,-1
1004             ip = perm1(i)
1005             ip2 =perm2(i)
1006             \textcolor{keyword}{call }ldu%getrow(ip,v,ii,nelem,mask)
1007             \textcolor{keywordflow}{do} j=1,nelem
1008                 \textcolor{keywordflow}{if} (ii(j) == ip2) then
1009                     \textcolor{comment}{! jsem na diagonale}
1010                 diag(ip) = v(j)
1011                 else
1012                     x(ip) = x(ip) - v(j)*x(ii(j))
1013 \textcolor{keyword}{                end }if
1014 \textcolor{keyword}{            end }do
1015             \textcolor{keywordflow}{if} (ilv==1) then
1016                 print *,perm1
1017                 print *,ip,mask
1018                 print *,ii
1019                 print *,x
1020 \textcolor{keyword}{            end }if
1021             mask(ip2) = .true.
1022 \textcolor{keyword}{        end }do
1023 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacesolvers_ab4c7314bf0d113f515e03150556b35bc_icgraph}
\end{center}
\end{figure}


\index{solvers@{solvers}!ldud@{ldud}}
\index{ldud@{ldud}!solvers@{solvers}}
\subsubsection[{ldud(\+A, info, pivtype, ilev, perm1, perm2)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public solvers\+::ldud (
\begin{DoxyParamCaption}
\item[{class({\bf matrix}), intent(inout)}]{A, }
\item[{type({\bf tcount}), intent(inout), optional}]{info, }
\item[{integer, intent(in), optional}]{pivtype, }
\item[{integer, intent(in), optional}]{ilev, }
\item[{integer(kind=ikind), dimension(\+:), intent(inout), optional, allocatable}]{perm1, }
\item[{integer(kind=ikind), dimension(\+:), intent(inout), optional, allocatable}]{perm2}
\end{DoxyParamCaption}
)}\label{namespacesolvers_a6c2d15a8b8a8951c08409b22918b2080}


destruktivni L\+DU rozklad 

nahradi vstupni matici jejim L\+DU rozkladem~\newline
 A = L$\ast$\+D$\ast$U~\newline
 L ... dolni trojuhelnikova matice s jednickami na diagonale~\newline
 D ... diagonalni matice~\newline
 U ... horni trojuhelnikova matice s jednickami na diagonale~\newline
 pro volbu pivota plati nasledujici pravidla~\newline
 0 ... zadna~\newline
 1 ... uplny vyber hlavniho prvku (nutne obe permutace )~\newline
 2 ... sloupcovy vyber hlavniho prvku(nutno perm1)~\newline
 3 ... radkovy vyber hlavniho prvku(nutno perm2)~\newline
 4 ... diagonalni vyber hlavniho prvku(nutno aspon jedna = obe shodne)~\newline
 5 ... diagonalni vyber hlavniho prvku pro minimal degree~\newline
 (nutno aspon jedna = obe shodne) ~\newline
 6 ... rid se predepsanou permutaci~\newline
 Pro situace 1 az 6 musi byt pritomny permutacni vektory~\newline
 Pokud nejsou pozadavky splneny -\/ zvoli se nejpodobnejsi volba~\newline
 pro podrobnost informaci plati~\newline
 0 ... tichy chod~\newline
 1 ... super podrobne~\newline



\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em a} & rozkladana matice, pote s rozkladem\\
\hline
\mbox{\tt in,out}  & {\em info} & pocty operaci\\
\hline
\mbox{\tt in}  & {\em pivtype} & typ pivotaze\\
\hline
\mbox{\tt in}  & {\em ilev} & podrobnost informaci\\
\hline
\mbox{\tt in,out}  & {\em perm1} & permutace pro i\\
\hline
\mbox{\tt in,out}  & {\em perm2} & permutace pro j \\
\hline
\end{DoxyParams}


Definition at line 377 of file solvers.\+f90.



References adddegree(), and findpivot().



Referenced by ldu(), and solver\+\_\+interfaces\+::ldu\+\_\+face().



Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=214pt]{namespacesolvers_a6c2d15a8b8a8951c08409b22918b2080_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacesolvers_a6c2d15a8b8a8951c08409b22918b2080_icgraph}
\end{center}
\end{figure}


\index{solvers@{solvers}!pcg@{pcg}}
\index{pcg@{pcg}!solvers@{solvers}}
\subsubsection[{pcg(\+A, Minv, b, x, itmax1, reps1, ilev1, itfin1, repsfin1, ll1, ll2, cond1, opcnt1, errcode1)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public solvers\+::pcg (
\begin{DoxyParamCaption}
\item[{class({\bf matrix}), intent(in)}]{A, }
\item[{class({\bf matrix}), intent(in)}]{Minv, }
\item[{real(kind=rkind), dimension(\+:), intent(in)}]{b, }
\item[{real(kind=rkind), dimension(\+:), intent(inout)}]{x, }
\item[{integer(kind=ikind), intent(in), optional}]{itmax1, }
\item[{real(kind=rkind), intent(in), optional}]{reps1, }
\item[{integer, intent(in), optional}]{ilev1, }
\item[{integer(kind=ikind), intent(out), optional}]{itfin1, }
\item[{real(kind=rkind), intent(out), optional}]{repsfin1, }
\item[{real(kind=rkind), intent(out), optional}]{ll1, }
\item[{real(kind=rkind), intent(out), optional}]{ll2, }
\item[{real(kind=rkind), intent(out), optional}]{cond1, }
\item[{type({\bf tcount}), intent(out), optional}]{opcnt1, }
\item[{integer, intent(out), optional}]{errcode1}
\end{DoxyParamCaption}
)}\label{namespacesolvers_a8c0a289ad14e4761a2c621b2914fd0aa}


metoda sdruzenych gradientu \doxyref{Metoda predpodminenych sdruzenych gradientu}{p.}{pcg} 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & matice soustavy~\newline
 musi poskytovat getn, getm, mul (nasobeni vektorem)\\
\hline
\mbox{\tt in}  & {\em minv} & matice predpodmineni -\/ ve skutecnosti operator~\newline
 musi poskytovat mul (nasobeni vektorem)\\
\hline
\mbox{\tt in}  & {\em b} & vektor prave strany\\
\hline
\mbox{\tt in,out}  & {\em x} & aproximace reseni, postupne menena\\
\hline
\mbox{\tt in}  & {\em itmax1} & maximalni povoleny pocet iteraci, default = n ( Rozmer matice)\\
\hline
\mbox{\tt in}  & {\em reps1} & pozadovana relativni zmena rezidua, default = 1e-\/6\\
\hline
\mbox{\tt in}  & {\em ilev1} & informacni podrobnost~\newline

\begin{DoxyItemize}
\item 0 ... pracuj tise
\item 1 ... minimalni informace
\item 10 ... maximalni ukecanost
\end{DoxyItemize}\\
\hline
\mbox{\tt out}  & {\em itfin1} & skutecne provedeny pocet iteraci\\
\hline
\mbox{\tt out}  & {\em repsfin1} & skutecne dosazena relativni zmena residua\\
\hline
\mbox{\tt out}  & {\em ll1} & odhad nejvetsiho vlastniho cisla\\
\hline
\mbox{\tt out}  & {\em ll2} & odhad nejmensiho vlastniho cisla\\
\hline
\mbox{\tt out}  & {\em cond1} & odhad cisla podminenosti \+: cond1 = ll1/ll2\\
\hline
\mbox{\tt out}  & {\em opcnt1} & celkovy pocet provedenych operaci a cas behu\\
\hline
\mbox{\tt out}  & {\em errcode1} & kod pripadnr chyby
\begin{DoxyItemize}
\item 0 ... OK
\item 1 ... matice neni ctvercova
\item 2 ... nesouhlasi b
\item 3 ... nesouhasi x
\item 4 ... ani jeden z vektoru nesouhlasi
\item 5 ... vycerpan povoleny pocet iteraci
\item 6 ... prestalo klesat residuum i energie 
\end{DoxyItemize}\\
\hline
\end{DoxyParams}


Definition at line 1704 of file solvers.\+f90.



References esteig(), and typy\+::r4.


\begin{DoxyCode}
1704         \textcolor{keywordtype}{use }mtx
1705         \textcolor{keywordtype}{use }typy, r4type=>r4
1706         \textcolor{keywordtype}{implicit none}
1709         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(in)} :: a
1712         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(in)} :: minv
1714         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: b
1716         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in out)} :: x
1718         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: itmax1
1720         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: reps1
1725         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: ilev1
1727         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: itfin1
1729         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: repsfin1
1731         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: ll1
1733         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: ll2
1735         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: cond1
1737         \textcolor{keywordtype}{type}(tcount), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: opcnt1
1746         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: errcode1
1747         \textcolor{keywordtype}{integer(kind=ikind)} :: itmax, cnt, n
1748         \textcolor{keywordtype}{integer} :: ilev,rcount, rcount1, errcode
1749         \textcolor{keywordtype}{real(kind=rkind)} :: reps, repsfin, r0, r1, r2,r3,r4,l1,l2,t1,t2
1750         \textcolor{keywordtype}{real(kind=rkind)} :: wrk, en, enmin, res2min
1751         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: res,p,ap,&
1752         alfa, beta, z
1753         \textcolor{keywordtype}{type}(tcount) :: opcnt
1754 
1755         \textcolor{keyword}{call }cpu\_time(t1)
1756         errcode = 0
1757         \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(errcode1)) errcode1 = 0
1758         n = a%getn()
1759         rcount = 0
1760         rcount1 = 0
1761         l1 = 1
1762         l2 = 1
1763         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ilev1)) then
1764         ilev = ilev1
1765         else
1766             ilev = 0
1767 \textcolor{keyword}{        end }if
1768 
1769         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(itmax1)) then
1770         itmax = itmax1
1771         else
1772             itmax = a%getn()
1773             \textcolor{keywordflow}{if} (ilev==10) print *,&
1774             \textcolor{stringliteral}{"nastavuji default hodnotu pro itmax na"},itmax
1775 \textcolor{keyword}{        end }if
1776         \textcolor{keyword}{allocate}(alfa(0:itmax), beta(0:itmax))
1777         \textcolor{keywordflow}{if} (a%getn() /= a%getm()) then
1778             \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1779                 errcode1 = 1
1780                 \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"CG: Matice neni ctvercova"}
1781             return
1782             else
1783                 stop \textcolor{stringliteral}{"CG: Matice neni ctvercova"}
1784 \textcolor{keyword}{            end }if
1785 \textcolor{keyword}{        end }if
1786         \textcolor{keywordflow}{if} (a%getn() /= ubound(b,1)) then
1787             \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1788                 errcode1 = 2
1789             \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"CG : nesouhlasi delka prave strany"}
1790             else
1791                 stop \textcolor{stringliteral}{"CG: Nesouhlasi delka prave strany"}
1792 \textcolor{keyword}{            end }if
1793 \textcolor{keyword}{        end }if
1794         \textcolor{keywordflow}{if} (a%getm() /= ubound(x,1)) then
1795             \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1796                 \textcolor{keywordflow}{if} (errcode1==0) then
1797                     errcode1 = 3
1798                 \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"CG: nesouhlasi delka reseni"}
1799                 else
1800                     errcode1 = 4
1801                     \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"CG: nesouhlasi delky obou vektoru"}
1802 \textcolor{keyword}{                end }if
1803             else
1804                 stop \textcolor{stringliteral}{"CG: Nesouhlasi delka vektoru neznamych"}
1805 \textcolor{keyword}{            end }if
1806 \textcolor{keyword}{        end }if
1807         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1808             \textcolor{keywordflow}{if} (errcode1>0) return
1809 \textcolor{keyword}{        end }if
1810         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(reps1) ) then
1811         reps = reps1
1812         else
1813             reps = 1.0e-6
1814             \textcolor{keywordflow}{if} (ilev==10) print *,\textcolor{stringliteral}{"nastavuji reps na defaultni hodnotu "}&
1815             , reps
1816 \textcolor{keyword}{        end }if
1817         \textcolor{comment}{! ted uz je snad vyrizeno vsechno ze vstupu}
1818         \textcolor{comment}{! jdu pocitat}
1819         cnt = 0
1820         \textcolor{comment}{!! Step 1}
1821         res = b - a%mul(x,opcnt)
1822         z = minv%mul(res)
1823         r4 = dot_product(res,res)
1824         r2 = dot_product(res,z)
1825         r0 = r2
1826         p = z
1827         opcnt%ad  = n-1
1828         opcnt%mul = n
1829         \textcolor{comment}{!! Step 2}
1830         do
1831             \textcolor{comment}{!! Step 3}
1832             ap =a%mul(p,opcnt)
1833             r1 = dot_product(p,ap)
1834             \textcolor{comment}{!!! tady zkontrolovat nulu}
1835             \textcolor{keywordflow}{if} ( r1 == 0.0) then
1836                 \textcolor{comment}{! nasypat vysledky}
1837                 \textcolor{comment}{! zatim stopka}
1838                 repsfin = 0
1839                 exit
1840 \textcolor{keyword}{            end }if
1841             wrk = r2/r1
1842             \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"alfa="},wrk
1843             alfa(cnt) = wrk
1844             \textcolor{comment}{! tenhle usek je jen kvuli vypoctu energie}
1845             en = -dot_product(x,b+res) \textcolor{comment}{! je to vychozi energie}
1846             \textcolor{comment}{!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!}
1847             \textcolor{comment}{!! Step 4}
1848             x = x + wrk*p
1849             \textcolor{comment}{!! Step 5}
1850             res = res - wrk*ap
1851             z = minv%mul(res)
1852             \textcolor{comment}{!! Step 6}
1853             r3 = r2
1854             r4 = dot_product(res,res)
1855             r2 = dot_product(res,z)
1856             wrk = r2/r3
1857             \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"beta="},wrk
1858             beta(cnt) = wrk
1859             \textcolor{comment}{!! Step 7}
1860             p = res + wrk*p
1861             opcnt%ad  = opcnt%ad  + 4*n-2 + 2*n-1
1862             opcnt%mul = opcnt%mul + 4*n   + n
1863             opcnt%div = opcnt%div + 1
1864 
1865             \textcolor{comment}{!! odhadnout vlastni cisla}
1866             \textcolor{keyword}{call }esteig(l1,l2,cnt,alfa,beta)
1867             print *, \textcolor{stringliteral}{"odhad vl. cisel:"},l1,l2
1868             \textcolor{comment}{!! hotovo}
1869 
1870             cnt = cnt + 1
1871             \textcolor{keywordflow}{if} (cnt==1) then
1872                 enmin = en
1873                 res2min = r2
1874                 \textcolor{keywordflow}{if} (r0==0.0\_rkind) then
1875                     repsfin=0
1876                     exit
1877 \textcolor{keyword}{                end }if
1878 \textcolor{keyword}{            end }if
1879             \textcolor{keywordflow}{if} (en < enmin) then
1880                 rcount = 0
1881             enmin = en
1882             else
1883                 rcount = rcount+1
1884 \textcolor{keyword}{            end }if
1885             \textcolor{keywordflow}{if} (r2 < res2min) then
1886                 res2min = r2
1887             rcount1 = 0
1888             else
1889                 rcount1 = rcount1+1
1890 \textcolor{keyword}{            end }if
1891             \textcolor{keywordflow}{if} (ilev>0)  print *, cnt,sqrt(r2), reps, en, enmin
1892             \textcolor{keywordflow}{if} (cnt == itmax) then
1893                 errcode = 5
1894                 exit
1895 \textcolor{keyword}{            end }if
1896             repsfin = sqrt(r2/r0)
1897             \textcolor{keywordflow}{if} (repsfin < reps) exit
1898             \textcolor{keywordflow}{if} ((rcount1>5) .and. (rcount > 5)) then
1899                 errcode = 6
1900                 exit
1901 \textcolor{keyword}{            end }if
1902 \textcolor{keyword}{        end }do
1903 
1904         \textcolor{keyword}{call }cpu\_time(t2)
1905         opcnt%time = t2-t1
1906         \textcolor{comment}{! vyridit konec}
1907         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(opcnt1)) opcnt1 = opcnt
1908         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) errcode1 = errcode
1909         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(itfin1)) itfin1 = cnt
1910         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(repsfin1)) repsfin1 = repsfin
1911         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ll1)) ll1 = l1
1912         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ll2)) ll2 = l2
1913         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(cond1)) cond1 = l1/l2
1914 
1915 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=349pt]{namespacesolvers_a8c0a289ad14e4761a2c621b2914fd0aa_cgraph}
\end{center}
\end{figure}


\index{solvers@{solvers}!pcgnormal@{pcgnormal}}
\index{pcgnormal@{pcgnormal}!solvers@{solvers}}
\subsubsection[{pcgnormal}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public solvers\+::pcgnormal (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{namespacesolvers_a2b54ed5ca5359186cbbe617324c6b86e}


Definition at line 1919 of file solvers.\+f90.

\index{solvers@{solvers}!sd@{sd}}
\index{sd@{sd}!solvers@{solvers}}
\subsubsection[{sd(\+A, b, x, itmax1, reps1, ilev1, itfin1, repsfin1, ll1, ll2, cond1, opcnt1, errcode1)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public solvers\+::sd (
\begin{DoxyParamCaption}
\item[{class({\bf matrix}), intent(in)}]{A, }
\item[{real(kind=rkind), dimension(\+:), intent(in)}]{b, }
\item[{real(kind=rkind), dimension(\+:), intent(inout)}]{x, }
\item[{integer(kind=ikind), intent(in), optional}]{itmax1, }
\item[{real(kind=rkind), intent(in), optional}]{reps1, }
\item[{integer, intent(in), optional}]{ilev1, }
\item[{integer(kind=ikind), intent(out), optional}]{itfin1, }
\item[{real(kind=rkind), intent(out), optional}]{repsfin1, }
\item[{real(kind=rkind), intent(out), optional}]{ll1, }
\item[{real(kind=rkind), intent(out), optional}]{ll2, }
\item[{real(kind=rkind), intent(out), optional}]{cond1, }
\item[{type({\bf tcount}), intent(out), optional}]{opcnt1, }
\item[{integer, intent(out), optional}]{errcode1}
\end{DoxyParamCaption}
)}\label{namespacesolvers_af1a15b562e2ee1cf1273637ca9edaaa4}


metoda nejvetsiho spadu ( Steepest descent) podrobnosti viz \doxyref{\char`\"{}\+Metoda nejvetsiho spadu\char`\"{}}{p.}{sd} 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & matice soustavy~\newline
 musi poskytovat getn, getm, mul (nasobeni vektorem)\\
\hline
\mbox{\tt in}  & {\em b} & vektor prave strany\\
\hline
\mbox{\tt in,out}  & {\em x} & aproximace reseni, postupne menena\\
\hline
\mbox{\tt in}  & {\em itmax1} & maximalni povoleny pocet iteraci, default = n ( Rozmer matice)\\
\hline
\mbox{\tt in}  & {\em reps1} & pozadovana relativni zmena rezidua, default = 1e-\/6\\
\hline
\mbox{\tt in}  & {\em ilev1} & informacni podrobnost~\newline

\begin{DoxyItemize}
\item 0 ... pracuj tise
\item 1 ... minimalni informace
\item 10 ... maximalni ukecanost
\end{DoxyItemize}\\
\hline
\mbox{\tt out}  & {\em itfin1} & skutecne provedeny pocet iteraci\\
\hline
\mbox{\tt out}  & {\em repsfin1} & skutecne dosazena relativni zmena residua\\
\hline
\mbox{\tt out}  & {\em ll1} & odhad nejvetsiho vlastniho cisla\\
\hline
\mbox{\tt out}  & {\em ll2} & odhad nejmensiho vlastniho cisla\\
\hline
\mbox{\tt out}  & {\em cond1} & odhad cisla podminenosti \+: cond1 = ll1/ll2\\
\hline
\mbox{\tt out}  & {\em opcnt1} & celkovy pocet provedenych operaci a cas behu\\
\hline
\mbox{\tt out}  & {\em errcode1} & kod pripadne chyby
\begin{DoxyItemize}
\item 0 ... OK
\item 1 ... matice neni ctvercova
\item 2 ... nesouhlasi b
\item 3 ... nesouhasi x
\item 4 ... ani jeden z vektoru nesouhlasi
\item 5 ... vypocet ukoncen pred dosazenim pozadovane presnosti na itmax
\item 6 ... -\/$\vert$$\vert$-\/, ale pro ukonceni poklesu energiie i residua 
\end{DoxyItemize}\\
\hline
\end{DoxyParams}


Definition at line 1037 of file solvers.\+f90.



References typy\+::update\+\_\+info().


\begin{DoxyCode}
1037         \textcolor{keywordtype}{use }mtx
1038         \textcolor{keywordtype}{use }typy
1039         \textcolor{keywordtype}{implicit none}
1042         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(in)} :: a
1044         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: b
1046         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in out)} :: x
1048         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: itmax1
1050         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: reps1
1055         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: ilev1
1057         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: itfin1
1059         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: repsfin1
1061         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: ll1
1063         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: ll2
1065         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: cond1
1067         \textcolor{keywordtype}{type}(tcount), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: opcnt1
1076         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: errcode1
1077 
1078         \textcolor{keywordtype}{integer(kind=ikind)} :: itmax, cnt, n
1079         \textcolor{keywordtype}{integer} :: ilev,rcount, rcount1, errcode
1080         \textcolor{keywordtype}{real(kind=rkind)} :: reps, repsfin, r0, r1, r2,l1,l2,t1,t2
1081         \textcolor{keywordtype}{real(kind=rkind)} :: wrk, en, enmin, res2min
1082         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: res
1083         \textcolor{keywordtype}{type}(tcount) :: opcnt
1084 
1085         \textcolor{keyword}{call }cpu\_time(t1)
1086         errcode = 0
1087         n = a%getn()
1088         rcount = 0
1089         rcount1 = 0
1090         l1 = 1
1091         l2 = 1
1092         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ilev1)) then
1093         ilev = ilev1
1094         else
1095             ilev = 0
1096 \textcolor{keyword}{        end }if
1097 
1098         \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(errcode1)) errcode1 = 0
1099         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(itmax1)) then
1100         itmax = itmax1
1101         else
1102             itmax = a%getn()
1103             \textcolor{keywordflow}{if} (ilev==10) print *,&
1104             \textcolor{stringliteral}{"nastavuji default hodnotu pro itmax na"},itmax
1105 \textcolor{keyword}{        end }if
1106         \textcolor{keywordflow}{if} (a%getn() /= a%getm()) then
1107             \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1108                 errcode1 = 1
1109                 \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"SD: Matice neni ctvercova"}
1110             return
1111             else
1112                 stop \textcolor{stringliteral}{"SD: Matice neni ctvercova"}
1113 \textcolor{keyword}{            end }if
1114 \textcolor{keyword}{        end }if
1115         \textcolor{keywordflow}{if} (a%getn() /= ubound(b,1)) then
1116             \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1117                 errcode1 = 2
1118             \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"SD : nesouhlasi delka prave strany"}
1119             else
1120                 stop \textcolor{stringliteral}{"SD: Nesouhlasi delka prave strany"}
1121 \textcolor{keyword}{            end }if
1122 \textcolor{keyword}{        end }if
1123         \textcolor{keywordflow}{if} (a%getm() /= ubound(x,1)) then
1124             \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1125                 \textcolor{keywordflow}{if} (errcode1==0) then
1126                     errcode1 = 3
1127                 \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"SD: nesouhlasi delka reseni"}
1128                 else
1129                     errcode1 = 4
1130                     \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"SD: nesouhlasi delky obou vektoru"}
1131 \textcolor{keyword}{                end }if
1132             else
1133                 stop \textcolor{stringliteral}{"SD: Nesouhlasi delka vektoru neznamych"}
1134 \textcolor{keyword}{            end }if
1135 \textcolor{keyword}{        end }if
1136         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) then
1137             \textcolor{keywordflow}{if} (errcode1>0) return
1138 \textcolor{keyword}{        end }if
1139         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(reps1) ) then
1140         reps = reps1
1141         else
1142             reps = 1.0e-6
1143             \textcolor{keywordflow}{if} (ilev==10) print *,\textcolor{stringliteral}{"nastavuji reps na defaultni hodnotu "}&
1144             , reps
1145 \textcolor{keyword}{        end }if
1146         \textcolor{comment}{! ted uz je snad vyrizeno vsechno ze vstupu}
1147         \textcolor{comment}{! jdu pocitat}
1148         cnt = 0
1149         \textcolor{keywordflow}{if} (ilev >0) print *,\textcolor{stringliteral}{"SD zacina"}
1150         do
1151             res = b - a%mul(x,opcnt)
1152             r1 = dot_product(res,a%mul(res,opcnt))
1153             r2 = dot_product(res,res)
1154             wrk = r2/r1
1155             \textcolor{comment}{! tenhle usek je jen kvuli vypoctu energie}
1156             en = -dot_product(x,b+res) \textcolor{comment}{! je to vychozi energie}
1157             \textcolor{comment}{!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!}
1158             x = x + wrk * res
1159             opcnt%ad = opcnt%ad + 4*n-2 +2*n-1
1160             opcnt%mul = opcnt%mul + 3*n + n
1161             opcnt%div = opcnt%div + 1
1162 
1163             cnt = cnt + 1
1164             \textcolor{keywordflow}{if} (cnt==1) then
1165                 enmin = en
1166                 r0 = r2
1167                 res2min = r2
1168                 \textcolor{keywordflow}{if} (r0==0.0\_rkind) then
1169                     repsfin=0
1170                     exit
1171 \textcolor{keyword}{                end }if
1172 \textcolor{keyword}{            end }if
1173             \textcolor{keywordflow}{if} (en < enmin) then
1174                 rcount = 0
1175             enmin = en
1176             else
1177                 rcount = rcount+1
1178 \textcolor{keyword}{            end }if
1179             \textcolor{keywordflow}{if} (r2 < res2min) then
1180                 res2min = r2
1181             rcount1 = 0
1182             else
1183                 rcount1 = rcount1+1
1184 \textcolor{keyword}{            end }if
1185             \textcolor{keywordflow}{if} (ilev>0)  print *, cnt,sqrt(r2), reps, en, enmin
1186             \textcolor{keywordflow}{if} (cnt == itmax) then
1187                 errcode = 5
1188                 exit
1189 \textcolor{keyword}{            end }if
1190             repsfin = sqrt(r2/r0)
1191             \textcolor{keywordflow}{if} (repsfin < reps) exit
1192             \textcolor{keywordflow}{if} ((rcount1>5) .and. (rcount > 5)) then
1193                 errcode = 6
1194                 exit
1195 \textcolor{keyword}{            end }if
1196 \textcolor{keyword}{        end }do
1197 
1198         \textcolor{keyword}{call }cpu\_time(t2)
1199         opcnt%time = t2-t1
1200         \textcolor{comment}{! vyridit konec}
1201         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(opcnt1)) \textcolor{keyword}{call }update_info(opcnt1,opcnt)
1202         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(errcode1)) errcode1 = errcode
1203         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(itfin1)) itfin1 = cnt
1204         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(repsfin1)) repsfin1 = repsfin
1205         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ll1)) ll1 = l1  \textcolor{comment}{! tohle zatim nepocita}
1206         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(ll2)) ll2 = l2
1207         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(cond1)) cond1 = l1/l2
1208         \textcolor{keywordflow}{if} (ilev>0) print *,\textcolor{stringliteral}{"SD konci"}
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=237pt]{namespacesolvers_af1a15b562e2ee1cf1273637ca9edaaa4_cgraph}
\end{center}
\end{figure}


\index{solvers@{solvers}!sdnormal@{sdnormal}}
\index{sdnormal@{sdnormal}!solvers@{solvers}}
\subsubsection[{sdnormal}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public solvers\+::sdnormal (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{namespacesolvers_aa902fa11b606f38dab65e0083f33aa2c}


Definition at line 1212 of file solvers.\+f90.

\index{solvers@{solvers}!split@{split}}
\index{split@{split}!solvers@{solvers}}
\subsubsection[{split(\+L\+D\+U, L, D, U, p1, p2)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine, public solvers\+::split (
\begin{DoxyParamCaption}
\item[{class({\bf matrix}), intent(in)}]{L\+DU, }
\item[{class({\bf matrix}), intent(out)}]{L, }
\item[{class({\bf matrix}), intent(out)}]{D, }
\item[{class({\bf matrix}), intent(out)}]{U, }
\item[{integer(kind=ikind), dimension(\+:), intent(in)}]{p1, }
\item[{integer(kind=ikind), dimension(\+:), intent(in)}]{p2}
\end{DoxyParamCaption}
)}\label{namespacesolvers_a7b05287bb232863276b29eda2694ab3a}


rozdeli matici s L\+DU rozkladem na jednotlive komponenty 

pokud jsou dodany permutace, tak plati


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em ldu} & L\+DU dekompozice\\
\hline
\mbox{\tt out}  & {\em l} & L cast rozkladu\\
\hline
\mbox{\tt out}  & {\em d} & D cast rozkladu\\
\hline
\mbox{\tt out}  & {\em u} & U cast rozkladu\\
\hline
\mbox{\tt in}  & {\em p1} & Leva permutace\\
\hline
\mbox{\tt in}  & {\em p2} & Prava permutace \\
\hline
\end{DoxyParams}


Definition at line 812 of file solvers.\+f90.


\begin{DoxyCode}
812         \textcolor{keywordtype}{use }typy
813         \textcolor{keywordtype}{use }mtx
815         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(in)} :: ldu
817         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(out)} :: l
819         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(out)} :: d
821         \textcolor{keywordtype}{class}(matrix), \textcolor{keywordtype}{intent(out)} :: u
823         \textcolor{keywordtype}{integer(Kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: p1
825         \textcolor{keywordtype}{integer(Kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: p2
826         \textcolor{keywordtype}{integer(kind=ikind)} :: n,m,i,j,i1,j1
827 
828         \textcolor{comment}{!print *,"split zacina"}
829         \textcolor{keyword}{call }l%clone(ldu)
830         \textcolor{keyword}{call }d%clone(ldu)
831         \textcolor{keyword}{call }u%clone(ldu)
832 
833         n=ldu%getn()
834         m=ldu%getm()
835         \textcolor{keywordflow}{do} i=1,min(n,m)
836             \textcolor{keyword}{call }l%set(1.0\_rkind,p1(i),p2(i))
837             \textcolor{keyword}{call }u%set(1.0\_rkind,p1(i),p2(i))
838             \textcolor{keyword}{call }d%set(ldu%get(p1(i),p2(i)),p2(i),p1(i))
839             \textcolor{keywordflow}{do} j=i+1,m
840                 i1 = p1(i)
841                 j1 = p2(j)
842                 \textcolor{keyword}{call }u%set(ldu%get(i1,j1),i1,j1)
843 \textcolor{keyword}{            end }do
844             \textcolor{keywordflow}{do} j=i+1,n
845                 i1 = p1(j)
846                 j1 = p2(i)
847                 \textcolor{keyword}{call }l%set(ldu%get(i1,j1),i1,j1)
848 \textcolor{keyword}{            end }do
849 \textcolor{keyword}{        end }do
\end{DoxyCode}
\index{solvers@{solvers}!vycdet@{vycdet}}
\index{vycdet@{vycdet}!solvers@{solvers}}
\subsubsection[{vycdet(x, a, b, n)}]{\setlength{\rightskip}{0pt plus 5cm}real(kind=rkind) function, private solvers\+::vycdet (
\begin{DoxyParamCaption}
\item[{real(kind=rkind), intent(in)}]{x, }
\item[{real(kind=rkind), dimension(0\+:), intent(in)}]{a, }
\item[{real(kind=rkind), dimension(0\+:), intent(in)}]{b, }
\item[{integer(kind=ikind), intent(in)}]{n}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{namespacesolvers_a2d1058e241b99a7efd5929528e145765}


Definition at line 1922 of file solvers.\+f90.



Referenced by esteig().


\begin{DoxyCode}
1922         \textcolor{keywordtype}{use }typy
1923         \textcolor{keywordtype}{implicit none}
1924         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)} :: x
1925         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(0:)}, \textcolor{keywordtype}{intent(in)} :: a
1926         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(0:)}, \textcolor{keywordtype}{intent(in)} :: b
1927         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: n
1928         \textcolor{keywordtype}{real(kind=rkind)} :: y, f1,f2,f3
1929         \textcolor{keywordtype}{integer(kind=ikind)} :: i
1930 
1931         f1 = 1/a(0)-x
1932         \textcolor{keywordflow}{if} (n==0) then
1933             y = f1
1934             return
1935 \textcolor{keyword}{        end }if
1936         f2 = f1*(1/a(1)+b(0)/a(0)-x)-b(0)/a(0)/a(0)
1937         \textcolor{keywordflow}{if} (n==1) then
1938             y = f2
1939             return
1940 \textcolor{keyword}{        end }if
1941         \textcolor{keywordflow}{do} i=2,n
1942             f3 = (1/a(i)+b(i-1)/a(i-1)-x)*f2-b(i-1)/a(i-1)/a(i-1)*f1
1943             f1 = f2
1944             f2 = f3
1945 \textcolor{keyword}{        end }do
1946         y = f3
1947 
1948 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacesolvers_a2d1058e241b99a7efd5929528e145765_icgraph}
\end{center}
\end{figure}


