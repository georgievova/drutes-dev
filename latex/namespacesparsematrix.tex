\section{sparsematrix Module Reference}
\label{namespacesparsematrix}\index{sparsematrix@{sparsematrix}}
\subsection*{Data Types}
\begin{DoxyCompactItemize}
\item 
type {\bf elemt}
\begin{DoxyCompactList}\small\item\em typ pro prvek ridke matice \end{DoxyCompactList}\item 
type {\bf smtx}
\begin{DoxyCompactList}\small\item\em ridka matice \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
integer(kind=ikind) function {\bf felem} (a, i, j)
\begin{DoxyCompactList}\small\item\em najde prvek v ridke strukture \end{DoxyCompactList}\item 
real(kind=rkind) function {\bf getsp} (a, i, j)
\begin{DoxyCompactList}\small\item\em ziska prvek z ridke matice \end{DoxyCompactList}\item 
subroutine {\bf setsp} (r, a, i, j)
\begin{DoxyCompactList}\small\item\em nastavi prvek matice, pokud neni tak vlozi \end{DoxyCompactList}\item 
subroutine {\bf insertsp} (a, r, i, j)
\begin{DoxyCompactList}\small\item\em prida neexistujici prvek do matice \end{DoxyCompactList}\item 
subroutine {\bf removesp} (a, i, j, index)
\begin{DoxyCompactList}\small\item\em smazne existujici prvek z ridke matici \end{DoxyCompactList}\item 
subroutine {\bf initsp} (a, n, m)
\begin{DoxyCompactList}\small\item\em inicializace a vymazani matice \end{DoxyCompactList}\item 
subroutine {\bf sparseprint} (a, ncol, width, caption)
\begin{DoxyCompactList}\small\item\em vytiskne ridkou matici \end{DoxyCompactList}\item 
subroutine {\bf sparsedump} (a)
\begin{DoxyCompactList}\small\item\em ridky dump \end{DoxyCompactList}\item 
integer(kind=ikind) function {\bf sparsenz} (a)
\begin{DoxyCompactList}\small\item\em vrati pocet nenul v matici \end{DoxyCompactList}\item 
subroutine {\bf getcolsparse} (a, j, v, ii, nelem, mask)
\item 
subroutine {\bf getrowsparse} (a, i, v, jj, nelem, mask)
\end{DoxyCompactItemize}


\subsection{Function/\+Subroutine Documentation}
\index{sparsematrix@{sparsematrix}!felem@{felem}}
\index{felem@{felem}!sparsematrix@{sparsematrix}}
\subsubsection[{felem(a, i, j)}]{\setlength{\rightskip}{0pt plus 5cm}integer(kind=ikind) function sparsematrix\+::felem (
\begin{DoxyParamCaption}
\item[{class({\bf smtx}), intent(in)}]{a, }
\item[{integer(kind=ikind), intent(in)}]{i, }
\item[{integer(kind=ikind), intent(in)}]{j}
\end{DoxyParamCaption}
)}\label{namespacesparsematrix_a280a3143a770320ed52ab89009dcce73}


najde prvek v ridke strukture 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & matice\\
\hline
\mbox{\tt in}  & {\em i} & souradnice\\
\hline
\mbox{\tt in}  & {\em j} & souradnice \\
\hline
\end{DoxyParams}


Definition at line 67 of file sparsematrix.\+f90.


\begin{DoxyCode}
67         \textcolor{keywordtype}{use }typy
68         \textcolor{keywordtype}{implicit none}
70         \textcolor{keywordtype}{class}(smtx), \textcolor{keywordtype}{intent(in)} :: a
72         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: i
74         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: j
75         \textcolor{keywordtype}{integer(kind=ikind)} :: res
76         \textcolor{keywordtype}{integer(kind=ikind)} :: k
77 
78         res = -1
79         \textcolor{keywordflow}{if} (a%nz == 0) return
80         k = a%rowstart(i)
81         \textcolor{keywordflow}{do} \textcolor{keywordflow}{while} (k > 0)
82             \textcolor{keywordflow}{if} (a%v(k)%col == j) then
83                 res = k
84                 return
85 \textcolor{keyword}{            end }if
86             k = a%v(k)%nextinrow
87 \textcolor{keyword}{        end }do
\end{DoxyCode}
\index{sparsematrix@{sparsematrix}!getcolsparse@{getcolsparse}}
\index{getcolsparse@{getcolsparse}!sparsematrix@{sparsematrix}}
\subsubsection[{getcolsparse(a, j, v, ii, nelem, mask)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine sparsematrix\+::getcolsparse (
\begin{DoxyParamCaption}
\item[{class({\bf smtx}), intent(in)}]{a, }
\item[{integer(kind=ikind), intent(in)}]{j, }
\item[{real(kind=rkind), dimension(\+:), intent(inout), allocatable}]{v, }
\item[{integer(kind=ikind), dimension(\+:), intent(inout), allocatable}]{ii, }
\item[{integer(kind=ikind), intent(out)}]{nelem, }
\item[{logical, dimension(\+:), intent(in), optional}]{mask}
\end{DoxyParamCaption}
)}\label{namespacesparsematrix_abce4e7b2943d457b6c5ff07172cf45ad}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & matice\\
\hline
\mbox{\tt in}  & {\em j} & identifikace sloupce\\
\hline
\mbox{\tt in,out}  & {\em v} & hodnoty prvku\\
\hline
\mbox{\tt in,out}  & {\em ii} & radkove indexy\\
\hline
\mbox{\tt out}  & {\em nelem} & pocet prvku vybraneho sloupce\\
\hline
\mbox{\tt in}  & {\em mask} & seznam povolenych indexu \\
\hline
\end{DoxyParams}


Definition at line 354 of file sparsematrix.\+f90.


\begin{DoxyCode}
354         \textcolor{keywordtype}{use }typy
355         \textcolor{keywordtype}{implicit none}
357         \textcolor{keywordtype}{class}(smtx), \textcolor{keywordtype}{intent(in)} :: a
359         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: j
361         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{intent(inout)} :: v
363         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{intent(inout)} :: ii
365         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(out)} :: nelem
367         \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{optional}, \textcolor{keywordtype}{intent(in)} :: mask
368         \textcolor{keywordtype}{integer(kind=ikind)} :: i,ic
369         \textcolor{keywordtype}{real(kind=rkind)} :: w
370         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: iiw
371 
372         \textcolor{comment}{!! spocitame delku}
373         \textcolor{comment}{!print *, "jsem v getcol sparse"}
374         i = a%colstart(j)
375         \textcolor{keywordflow}{if} (i== -1) then
376             \textcolor{comment}{!! je to prazdny sloupec}
377             nelem = 0
378             return
379         else
380             nelem = 0
381             do
382                 ic = i
383                 i = a%v(i)%nextincol
384                 \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(mask) ) then
385                     \textcolor{keywordflow}{if} ( mask(a%v(ic)%row) ) then
386                         nelem=nelem+1
387                         \textcolor{comment}{!print *,ic, a%v(ic)%row,mask(a%v(ic)%row),i}
388 \textcolor{keyword}{                    end }if
389                 else
390                     nelem = nelem + 1
391 \textcolor{keyword}{                end }if
392                 \textcolor{keywordflow}{if} (i == -1) exit
393 \textcolor{keyword}{            end }do
394 \textcolor{keyword}{        end }if
395         \textcolor{comment}{!print *,"nelem=",nelem}
396         \textcolor{comment}{!! v nelem je pocet prvku sloupce}
397         \textcolor{comment}{!! prekontrolovat a pripadne pripravit prostor}
398         \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(v) ) then
399             \textcolor{keywordflow}{if} ( ubound(v,1) < nelem ) then
400                 \textcolor{keyword}{deallocate}(v)
401                 \textcolor{keyword}{allocate}(v(1:nelem))
402 \textcolor{keyword}{            end }if
403         else
404             \textcolor{keyword}{allocate}(v(1:nelem))
405 \textcolor{keyword}{        end }if
406         \textcolor{comment}{!print *,"v hotovo"}
407         \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(ii) ) then
408             \textcolor{keywordflow}{if} ( ubound(ii,1) < nelem ) then
409                 \textcolor{keyword}{deallocate}(ii)
410                 \textcolor{keyword}{allocate}(ii(1:nelem))
411 \textcolor{keyword}{            end }if
412         else
413             \textcolor{comment}{!print *,"nekompromisni alokace ii"}
414             \textcolor{comment}{!print *,"nelem=",nelem}
415             \textcolor{keyword}{allocate}(ii(1:nelem))
416             \textcolor{comment}{!print *, "hotovo"}
417             \textcolor{comment}{!!ii = iiw}
418 \textcolor{keyword}{        end }if
419         \textcolor{comment}{!print *, "realokovano"}
420         i = a%colstart(j)
421         ic = 0
422         \textcolor{comment}{!print *,"i=",i," ic=", ic}
423         do
424             \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(mask)) then
425                 \textcolor{keywordflow}{if} (mask(a%v(i)%row)) then
426                     \textcolor{comment}{!print *, "pridavam"}
427                     \textcolor{comment}{!print *,i, a%v(i)%row,mask(a%v(i)%row),&}
428                     \textcolor{comment}{!    a%v(i)%nextincol}
429                     ic = ic + 1
430                     v(ic)  = a%v(i)%vl
431                     ii(ic) = a%v(i)%row
432 \textcolor{keyword}{                end }if
433             else
434                 ic = ic + 1
435                 v(ic)  = a%v(i)%vl
436                 ii(ic) = a%v(i)%row
437 \textcolor{keyword}{            end }if
438             i = a%v(i)%nextincol
439             \textcolor{comment}{!print *,"i=",i," ic=", ic}
440             \textcolor{keywordflow}{if} ( i==-1) exit
441 \textcolor{keyword}{        end }do
442         \textcolor{keywordflow}{if} (ic /= nelem) then
443             print *, \textcolor{stringliteral}{"scol:konecne ic "},ic,\textcolor{stringliteral}{"nelem="},nelem
444             stop
445 \textcolor{keyword}{        end }if
\end{DoxyCode}
\index{sparsematrix@{sparsematrix}!getrowsparse@{getrowsparse}}
\index{getrowsparse@{getrowsparse}!sparsematrix@{sparsematrix}}
\subsubsection[{getrowsparse(a, i, v, jj, nelem, mask)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine sparsematrix\+::getrowsparse (
\begin{DoxyParamCaption}
\item[{class({\bf smtx}), intent(in)}]{a, }
\item[{integer(kind=ikind), intent(in)}]{i, }
\item[{real(kind=rkind), dimension(\+:), intent(inout), allocatable}]{v, }
\item[{integer(kind=ikind), dimension(\+:), intent(inout), allocatable}]{jj, }
\item[{integer(kind=ikind), intent(out)}]{nelem, }
\item[{logical, dimension(\+:), intent(in), optional}]{mask}
\end{DoxyParamCaption}
)}\label{namespacesparsematrix_a7cbc3156515ef767ed0088b15f60fa20}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & matice\\
\hline
\mbox{\tt in}  & {\em i} & identifikace sloupce\\
\hline
\mbox{\tt in,out}  & {\em v} & hodnoty prvku\\
\hline
\mbox{\tt in,out}  & {\em jj} & radkove indexy\\
\hline
\mbox{\tt out}  & {\em nelem} & pocet prvku vybraneho sloupce\\
\hline
\mbox{\tt in}  & {\em mask} & seznam povolenych indexu \\
\hline
\end{DoxyParams}


Definition at line 449 of file sparsematrix.\+f90.


\begin{DoxyCode}
449         \textcolor{keywordtype}{use }typy
450         \textcolor{keywordtype}{implicit none}
452         \textcolor{keywordtype}{class}(smtx), \textcolor{keywordtype}{intent(in)} :: a
454         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: i
456         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{intent(inout)} :: v
458         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{intent(inout)} :: jj
460         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(out)} :: nelem
462         \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{optional}, \textcolor{keywordtype}{intent(in)} :: mask
463         \textcolor{keywordtype}{integer(kind=ikind)} :: j,ic
464         \textcolor{keywordtype}{real(kind=rkind)} :: w
465 
466         \textcolor{comment}{!! spocitame delku}
467         \textcolor{comment}{!!print *, "jsem v getrow sparse"}
468         j = a%rowstart(i)
469         \textcolor{keywordflow}{if} (j == -1) then
470             \textcolor{comment}{!! je to prazdny sloupec}
471             nelem = 0
472             return
473         else
474             nelem = 0
475             do
476                 ic = j
477                 j = a%v(j)%nextinrow
478                 \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(mask) ) then
479                     \textcolor{keywordflow}{if} ( mask(a%v(ic)%col) ) nelem=nelem+1
480                 else
481                     nelem = nelem + 1
482 \textcolor{keyword}{                end }if
483                 \textcolor{keywordflow}{if} (j == -1) exit
484 \textcolor{keyword}{            end }do
485 \textcolor{keyword}{        end }if
486         \textcolor{comment}{!!print *,"nelem=",nelem}
487         \textcolor{comment}{!! v nelem je pocet prvku sloupce}
488         \textcolor{comment}{!! prekontrolovat a pripadne pripravit prostor}
489         \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(v) ) then
490             \textcolor{comment}{!!print *,"kontroluji v"}
491             \textcolor{keywordflow}{if} ( ubound(v,1) < nelem ) then
492                 \textcolor{keyword}{deallocate}(v)
493                 \textcolor{keyword}{allocate}(v(1:nelem))
494 \textcolor{keyword}{            end }if
495         else
496             \textcolor{comment}{!!print *, "nekompromisni alokace v"}
497             \textcolor{keyword}{allocate}(v(1:nelem))
498 \textcolor{keyword}{        end }if
499         \textcolor{comment}{!!print *,"v hotovo"}
500         \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(jj) ) then
501             \textcolor{keywordflow}{if} ( ubound(jj,1) < nelem ) then
502                 \textcolor{keyword}{deallocate}(jj)
503                 \textcolor{keyword}{allocate}(jj(1:nelem))
504 \textcolor{keyword}{            end }if
505         else
506             \textcolor{keyword}{allocate}(jj(1:nelem))
507 \textcolor{keyword}{        end }if
508         \textcolor{comment}{!!print *, "realokovano"}
509         j = a%rowstart(i)
510         ic = 0
511         \textcolor{comment}{!!print *,"j=",j," ic=", ic}
512         do
513             \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(mask)) then
514                 \textcolor{keywordflow}{if} (mask(a%v(j)%col)) then
515                     ic = ic + 1
516                     v(ic)  = a%v(j)%vl
517                     jj(ic) = a%v(j)%col
518 \textcolor{keyword}{                end }if
519             else
520                 ic = ic + 1
521                 v(ic)  = a%v(j)%vl
522                 jj(ic) = a%v(j)%col
523 \textcolor{keyword}{            end }if
524             j      = a%v(j)%nextinrow
525             \textcolor{comment}{!!print *,"j=",j," ic=", ic}
526             \textcolor{keywordflow}{if} ( j==-1) exit
527 \textcolor{keyword}{        end }do
528         \textcolor{comment}{!!print *," konecne ic=",ic}
529         \textcolor{comment}{!!print *,v,jj}
\end{DoxyCode}
\index{sparsematrix@{sparsematrix}!getsp@{getsp}}
\index{getsp@{getsp}!sparsematrix@{sparsematrix}}
\subsubsection[{getsp(a, i, j)}]{\setlength{\rightskip}{0pt plus 5cm}real(kind=rkind) function sparsematrix\+::getsp (
\begin{DoxyParamCaption}
\item[{class({\bf smtx}), intent(in)}]{a, }
\item[{integer(kind=ikind), intent(in)}]{i, }
\item[{integer(kind=ikind), intent(in)}]{j}
\end{DoxyParamCaption}
)}\label{namespacesparsematrix_aa97ca3abb01e95bb24307cf18475a52b}


ziska prvek z ridke matice 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & matice\\
\hline
\mbox{\tt in}  & {\em i} & souradnice\\
\hline
\mbox{\tt in}  & {\em j} & souradnice \\
\hline
\end{DoxyParams}


Definition at line 93 of file sparsematrix.\+f90.


\begin{DoxyCode}
93         \textcolor{keywordtype}{use }typy
95         \textcolor{keywordtype}{class}(smtx), \textcolor{keywordtype}{intent(in)} :: a
97         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: i,j
98         \textcolor{keywordtype}{integer(kind=ikind)} :: index
99         \textcolor{keywordtype}{real(kind=rkind)} :: r
100         r = 0
101         index = a%findelem(i,j)
102         \textcolor{keywordflow}{if} (index > 0) r = a%v(index)%vl
\end{DoxyCode}
\index{sparsematrix@{sparsematrix}!initsp@{initsp}}
\index{initsp@{initsp}!sparsematrix@{sparsematrix}}
\subsubsection[{initsp(a, n, m)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine sparsematrix\+::initsp (
\begin{DoxyParamCaption}
\item[{class({\bf smtx}), intent(inout)}]{a, }
\item[{integer(kind=ikind), intent(in)}]{n, }
\item[{integer(kind=ikind), intent(in)}]{m}
\end{DoxyParamCaption}
)}\label{namespacesparsematrix_a1c4118dc4971cc238fb7eb912e9a23cd}


inicializace a vymazani matice 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em a} & matice\\
\hline
\mbox{\tt in}  & {\em n} & rozmery\\
\hline
\mbox{\tt in}  & {\em m} & rozmery \\
\hline
\end{DoxyParams}


Definition at line 236 of file sparsematrix.\+f90.


\begin{DoxyCode}
236         \textcolor{keywordtype}{use }typy
237         \textcolor{keywordtype}{implicit none}
239         \textcolor{keywordtype}{class}(smtx), \textcolor{keywordtype}{intent(in out)}  :: a
241         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: n,m
242         \textcolor{keyword}{call }a%resize(n,m)
243         a%nz = 0
244         a%aloc = 0
245         \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(a%v)) \textcolor{keyword}{deallocate}(a%v)
246         \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(a%rowstart)) \textcolor{keyword}{deallocate}(a%rowstart)
247         \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(a%colstart)) \textcolor{keyword}{deallocate}(a%colstart)
\end{DoxyCode}
\index{sparsematrix@{sparsematrix}!insertsp@{insertsp}}
\index{insertsp@{insertsp}!sparsematrix@{sparsematrix}}
\subsubsection[{insertsp(a, r, i, j)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine sparsematrix\+::insertsp (
\begin{DoxyParamCaption}
\item[{class({\bf smtx}), intent(inout)}]{a, }
\item[{real(kind=rkind), intent(in)}]{r, }
\item[{integer(kind=ikind), intent(in)}]{i, }
\item[{integer(kind=ikind), intent(in)}]{j}
\end{DoxyParamCaption}
)}\label{namespacesparsematrix_aa45844a2fd20a6a4ee5145c9b16c39cd}


prida neexistujici prvek do matice 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em a} & matice\\
\hline
\mbox{\tt in}  & {\em r} & hodnota\\
\hline
\mbox{\tt in}  & {\em i} & souradnice\\
\hline
\mbox{\tt in}  & {\em j} & souradnice \\
\hline
\end{DoxyParams}


Definition at line 133 of file sparsematrix.\+f90.


\begin{DoxyCode}
133         \textcolor{keywordtype}{use }typy
134         \textcolor{keywordtype}{implicit none}
136         \textcolor{keywordtype}{class}(smtx), \textcolor{keywordtype}{intent(in out)} :: a
138         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)} :: r
140         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: i,j
141 
142         \textcolor{keywordtype}{type}(elemt), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: tmp
143         \textcolor{keywordtype}{integer(kind=ikind)} :: k, w1
144 
145         \textcolor{keywordflow}{if} (a%aloc == 0 ) then
146             \textcolor{comment}{! prvotni alokace}
147             a%aloc=2*a%getn()
148             \textcolor{keyword}{allocate}(a%v(1:a%aloc))
149             \textcolor{keyword}{allocate}(a%colstart(1:a%getm()))
150             \textcolor{keyword}{allocate}(a%rowstart(1:a%getn()))
151             a%nz = 0
152             \textcolor{keywordflow}{do} k=1,a%aloc
153                 a%v(k) = elemt(0.0,0,0,k+1,k+1)
154 \textcolor{keyword}{            end }do
155             a%v(a%aloc) = elemt(0.0,0,0,-1,-1)
156             a%colstart = -1
157             a%rowstart = -1
158             a%firstfree = 1
159 \textcolor{keyword}{        end }if
160         \textcolor{comment}{! neco uz je}
161         \textcolor{keywordflow}{if} ( a%firstfree == -1) then
162             \textcolor{comment}{! neni misto, musim ho udelat}
163             \textcolor{keywordflow}{if} (a%nz /= a%aloc) stop \textcolor{stringliteral}{"insert: nekonzistentni data v matici"}
164             a%aloc = max(a%aloc+10,a%aloc + a%aloc)
165             \textcolor{comment}{!print *,"insert2a0", a%aloc}
166             \textcolor{keyword}{allocate}(tmp(1:a%aloc)) \textcolor{comment}{! selhava ve 32 bitech pri optimalizaci}
167             \textcolor{comment}{!print *,"insert2a1"}
168             tmp(1:ubound(a%v,1)) = a%v
169             \textcolor{comment}{!print *,"insert2a2"}
170             \textcolor{keyword}{call }move\_alloc(tmp,a%v)
171             \textcolor{comment}{!print *, "insert2a3"}
172             \textcolor{comment}{! dodat to do volnyho mista}
173             \textcolor{keywordflow}{do} k=a%nz+1,a%aloc
174                 a%v(k) = elemt(0.0,0,0,k+1,k+1)
175 \textcolor{keyword}{            end }do
176             a%v(a%aloc) = elemt(0.0,0,0,-1,-1)
177             a%firstfree = a%nz+1
178 \textcolor{keyword}{        end }if
179         w1 = a%firstfree                 \textcolor{comment}{! vyberu to z volnyho mista}
180         a%firstfree = a%v(w1)%nextincol  \textcolor{comment}{! a oznacim novy volny misto}
181         a%v(w1) = elemt(r,i,j,a%rowstart(i),a%colstart(j))
182         a%rowstart(i) = w1
183         a%colstart(j) = w1
184         a%nz = a%nz + 1
\end{DoxyCode}
\index{sparsematrix@{sparsematrix}!removesp@{removesp}}
\index{removesp@{removesp}!sparsematrix@{sparsematrix}}
\subsubsection[{removesp(a, i, j, index)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine sparsematrix\+::removesp (
\begin{DoxyParamCaption}
\item[{class({\bf smtx}), intent(inout)}]{a, }
\item[{integer(kind=ikind), intent(in)}]{i, }
\item[{integer(kind=ikind), intent(in)}]{j, }
\item[{integer(kind=ikind), intent(in)}]{index}
\end{DoxyParamCaption}
)}\label{namespacesparsematrix_a76e7375c2d6aa3f8541c5459b166c4ad}


smazne existujici prvek z ridke matici 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em a} & matice\\
\hline
\mbox{\tt in}  & {\em i} & souradnice mazaneho prvku\\
\hline
\mbox{\tt in}  & {\em j} & souradnice mazaneho prvku\\
\hline
\mbox{\tt in}  & {\em index} & pozice mazaneho prvku \\
\hline
\end{DoxyParams}


Definition at line 189 of file sparsematrix.\+f90.


\begin{DoxyCode}
189         \textcolor{keywordtype}{use }typy
190         \textcolor{keywordtype}{implicit none}
192         \textcolor{keywordtype}{class}(smtx), \textcolor{keywordtype}{intent(inout)} :: a
194         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: i
196         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: j
198         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: index
199 
200         \textcolor{keywordtype}{integer(kind=ikind)} :: k
201 
202         \textcolor{comment}{!kontrola, ze to sedi}
203         \textcolor{keywordflow}{if} (a%v(index)%row /= i .or. a%v(index)%col /= j) &
204             stop \textcolor{stringliteral}{"remove: nekonzistentni data"}
205         \textcolor{comment}{!vlastni smazani}
206         \textcolor{comment}{! napred vynechat mazany prvek ze seznamu}
207         \textcolor{comment}{! napred v radku}
208         \textcolor{comment}{!call pockej( "jsem v mazani")}
209         k = a%rowstart(i)
210         \textcolor{keywordflow}{if} ( k == index) then
211             a%rowstart(i) = a%v(index)%nextinrow
212         else
213             \textcolor{keywordflow}{do} \textcolor{keywordflow}{while} (a%v(k)%nextinrow /= index)
214                 k = a%v(k)%nextinrow
215 \textcolor{keyword}{            end }do
216             a%v(k)%nextinrow = a%v(index)%nextinrow
217 \textcolor{keyword}{        end }if
218         \textcolor{comment}{! potom sloupec}
219         k = a%colstart(j)
220         \textcolor{keywordflow}{if} ( k == index) then
221             a%colstart(j) = a%v(index)%nextincol
222         else
223             \textcolor{keywordflow}{do} \textcolor{keywordflow}{while} (a%v(k)%nextincol /= index)
224                 k = a%v(k)%nextincol
225 \textcolor{keyword}{            end }do
226             a%v(k)%nextincol = a%v(index)%nextincol
227 \textcolor{keyword}{        end }if
228         \textcolor{comment}{! pridame do seznamu volneho mista}
229         a%v(index) = elemt(0.0,0,0,a%firstfree,a%firstfree)
230         a%firstfree = index
231         a%nz = a%nz - 1
\end{DoxyCode}
\index{sparsematrix@{sparsematrix}!setsp@{setsp}}
\index{setsp@{setsp}!sparsematrix@{sparsematrix}}
\subsubsection[{setsp(r, a, i, j)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine sparsematrix\+::setsp (
\begin{DoxyParamCaption}
\item[{real(kind=rkind), intent(in)}]{r, }
\item[{class({\bf smtx}), intent(inout)}]{a, }
\item[{integer(kind=ikind), intent(in)}]{i, }
\item[{integer(kind=ikind), intent(in)}]{j}
\end{DoxyParamCaption}
)}\label{namespacesparsematrix_af6a868bce31ff2e854f453a174221462}


nastavi prvek matice, pokud neni tak vlozi 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em r} & hodnota\\
\hline
\mbox{\tt in,out}  & {\em a} & matice\\
\hline
\mbox{\tt in}  & {\em i} & souradnice\\
\hline
\mbox{\tt in}  & {\em j} & souradnice \\
\hline
\end{DoxyParams}


Definition at line 107 of file sparsematrix.\+f90.


\begin{DoxyCode}
107         \textcolor{keywordtype}{implicit none}
109         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{intent(in)} :: r
111         \textcolor{keywordtype}{class}(smtx), \textcolor{keywordtype}{intent(in out)}  :: a
113         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)} :: i,j
114         \textcolor{keywordtype}{integer(kind=ikind)} :: index
115 
116         index = a%findelem(i,j)
117         \textcolor{keywordflow}{if} ( r == 0) then
118             \textcolor{comment}{! jde vlastne o mazani}
119             \textcolor{keywordflow}{if} ( index > 0 ) then
120                 \textcolor{keyword}{call }a%remove(i,j,index)
121 \textcolor{keyword}{            end }if
122         else
123             \textcolor{keywordflow}{if} ( index > 0 ) then
124                 a%v(index)%vl = r
125             else
126                 \textcolor{keyword}{call }a%insert(r,i,j)
127 \textcolor{keyword}{            end }if
128 \textcolor{keyword}{        end }if
\end{DoxyCode}
\index{sparsematrix@{sparsematrix}!sparsedump@{sparsedump}}
\index{sparsedump@{sparsedump}!sparsematrix@{sparsematrix}}
\subsubsection[{sparsedump(a)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine sparsematrix\+::sparsedump (
\begin{DoxyParamCaption}
\item[{class({\bf smtx}), intent(in)}]{a}
\end{DoxyParamCaption}
)}\label{namespacesparsematrix_a604157438f11d732208040cd89991744}


ridky dump 



Definition at line 317 of file sparsematrix.\+f90.


\begin{DoxyCode}
317         \textcolor{keywordtype}{implicit none}
318         \textcolor{keywordtype}{class}(smtx), \textcolor{keywordtype}{intent(in)} :: a
319         \textcolor{keywordtype}{integer(kind=ikind)} :: i
320 
321         print *,\textcolor{stringliteral}{"ridky dump"}
322         print *, \textcolor{stringliteral}{"pocet radku:"}, a%getn(), \textcolor{stringliteral}{" pocet sloupcu:"},a%getm(),&
323             \textcolor{stringliteral}{" alokovano:"},a%aloc,\textcolor{stringliteral}{" pocet nenul:"}, a%nz
324         \textcolor{keywordflow}{if} (a%nz > 0) then
325             print *,\textcolor{stringliteral}{"elementy matice:"}
326             \textcolor{keywordflow}{do} i=1,a%aloc
327                 print *, \textcolor{stringliteral}{"index="},i
328                 print *, \textcolor{stringliteral}{"value:"},a%v(i)
329 \textcolor{keyword}{            end }do
330             print *, \textcolor{stringliteral}{"zacatky radku:"}
331             \textcolor{keywordflow}{do} i=1,a%getn()
332                 print *, i, a%rowstart(i)
333 \textcolor{keyword}{            end }do
334             print *, \textcolor{stringliteral}{"zacatky sloupcu"}
335             \textcolor{keywordflow}{do} i=1,a%getm()
336                 print *, i, a%colstart(i)
337 \textcolor{keyword}{            end }do
338 \textcolor{keyword}{        end }if
\end{DoxyCode}
\index{sparsematrix@{sparsematrix}!sparsenz@{sparsenz}}
\index{sparsenz@{sparsenz}!sparsematrix@{sparsematrix}}
\subsubsection[{sparsenz(a)}]{\setlength{\rightskip}{0pt plus 5cm}integer(kind=ikind) function sparsematrix\+::sparsenz (
\begin{DoxyParamCaption}
\item[{class({\bf smtx}), intent(in)}]{a}
\end{DoxyParamCaption}
)}\label{namespacesparsematrix_a55da78acbd825498ddaedc29c0bb4950}


vrati pocet nenul v matici 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & matice \\
\hline
\end{DoxyParams}


Definition at line 343 of file sparsematrix.\+f90.


\begin{DoxyCode}
343         \textcolor{keywordtype}{use }typy
344         \textcolor{keywordtype}{implicit none}
346         \textcolor{keywordtype}{class}(smtx), \textcolor{keywordtype}{intent(in)} :: a
347         \textcolor{keywordtype}{integer(kind=ikind)} :: res
348         res = a%nz
\end{DoxyCode}
\index{sparsematrix@{sparsematrix}!sparseprint@{sparseprint}}
\index{sparseprint@{sparseprint}!sparsematrix@{sparsematrix}}
\subsubsection[{sparseprint(a, ncol, width, caption)}]{\setlength{\rightskip}{0pt plus 5cm}subroutine sparsematrix\+::sparseprint (
\begin{DoxyParamCaption}
\item[{class({\bf smtx}), intent(in)}]{a, }
\item[{integer(kind=ikind), intent(in), optional}]{ncol, }
\item[{integer(kind=ikind), intent(in), optional}]{width, }
\item[{character(len=$\ast$), intent(in), optional}]{caption}
\end{DoxyParamCaption}
)}\label{namespacesparsematrix_a6a4c4a4f1a1597bfdc9da2f9d9dd88e5}


vytiskne ridkou matici 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em a} & matice\\
\hline
\mbox{\tt in}  & {\em ncol} & pocet sloupci tisku\\
\hline
\mbox{\tt in}  & {\em width} & sirka cisla\\
\hline
\mbox{\tt in}  & {\em caption} & nadpis \\
\hline
\end{DoxyParams}


Definition at line 254 of file sparsematrix.\+f90.


\begin{DoxyCode}
254         \textcolor{keywordtype}{use }typy
255         \textcolor{keywordtype}{implicit none}
257         \textcolor{keywordtype}{class}(smtx), \textcolor{keywordtype}{intent(in)} :: a
259         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: ncol
261         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{optional} :: width
263         \textcolor{keywordtype}{character(len=*)}, \textcolor{keywordtype}{intent(in)},    \textcolor{keywordtype}{optional} :: caption
264         \textcolor{keywordtype}{character(len=100)} :: cpt,fmts
265         \textcolor{keywordtype}{integer(kind=ikind)} :: nc
266         \textcolor{keywordtype}{integer(kind=ikind)} :: wd
267         \textcolor{keywordtype}{integer(kind=ikind)} :: i,j
268         \textcolor{keywordtype}{real(kind=rkind)} :: wrk
269         \textcolor{keywordtype}{integer(kind=ikind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: jj
270         \textcolor{keywordtype}{real(kind=rkind)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: v
271         \textcolor{keywordtype}{integer(kind=ikind)} :: nelem
272 
273         \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(ncol) ) then
274             nc = ncol
275         else
276             nc = 5
277 \textcolor{keyword}{        end }if
278 
279         \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(width) ) then
280             wd = width
281         else
282             wd = 15
283 \textcolor{keyword}{        end }if
284 
285         \textcolor{keywordflow}{if} ( \textcolor{keyword}{present}(caption) ) then
286             cpt = adjustl(caption)
287         else
288             cpt =\textcolor{stringliteral}{"ridka matice"}
289 \textcolor{keyword}{        end }if
290 
291         print *, trim(cpt)
292         \textcolor{keywordflow}{if} (a%aloc == 0) then
293             print *,\textcolor{stringliteral}{"prazdna matice"}
294         else
295             \textcolor{comment}{!print *, "printsmtx 1"}
296             \textcolor{keywordflow}{do} i=1,a%getn()
297                 \textcolor{keyword}{call }a%getrow(i,v,jj,nelem)
298                 \textcolor{comment}{!print *,"printsmtx 2"}
299                 \textcolor{keywordflow}{if} ( nelem == 0) then
300                     print *, \textcolor{stringliteral}{"radek "},i,\textcolor{stringliteral}{" je prazdny"}
301                 else
302                     print *, \textcolor{stringliteral}{"radek "},i,\textcolor{stringliteral}{" ma "},nelem,\textcolor{stringliteral}{" prvku"}
303                     \textcolor{keywordflow}{do} j = 1,nelem
304                         print *,v(j),jj(j)
305 \textcolor{keyword}{                    end }do
306 \textcolor{keyword}{                end }if
307 \textcolor{keyword}{            end }do
308 \textcolor{keyword}{        end }if
309         print *, \textcolor{stringliteral}{" pocet radku="},a%getn(), \textcolor{stringliteral}{" pocet sloupcu="}, a%getm(), &
310             \textcolor{stringliteral}{" pocet nenulovych prvku="}, a%nz
311 
\end{DoxyCode}
